<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æœ´å®çš„ä¸€çº¿æ”»åŸç‹®</title>
  <subtitle>åå¹´ç£¨ä¸€å‰‘ï¼Œä¸€æ­¥ä¸€æ­¥è„šè¸å®åœ°çš„è€•ç§</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.grdtechs.com/"/>
  <updated>2016-11-23T06:28:51.134Z</updated>
  <id>http://www.grdtechs.com/</id>
  
  <author>
    <name>Lee Hong</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>goç¼–è¯‘ç”Ÿæˆæ›´å°çš„æ‰§è¡Œç¨‹åº</title>
    <link href="http://www.grdtechs.com/2016/10/23/go-build-small-exec/"/>
    <id>http://www.grdtechs.com/2016/10/23/go-build-small-exec/</id>
    <published>2016-10-23T14:00:32.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å°½ç®¡go1.7.3ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºå·²ç»å¾ˆå°äº†,ä½†æ˜¯é€šè¿‡ç¼–è¯‘å‚æ•°æ§åˆ¶è¿˜èƒ½ç¼–è¯‘å‡ºæ›´å°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ€»ç»“å¦‚ä¸‹,<br><a id="more"></a></p>
<h2 id="u52A0-ldflags_u53C2_u6570"><a href="#u52A0-ldflags_u53C2_u6570" class="headerlink" title="åŠ -ldflagså‚æ•°"></a>åŠ -ldflagså‚æ•°</h2><p>åœ¨ç¨‹åºç¼–è¯‘çš„æ—¶å€™å¯ä»¥åŠ ä¸Š<code>-ldflags &quot;-s -w&quot;</code> å‚æ•°æ¥ä¼˜åŒ–ç¼–è¯‘ç¨‹åº, å…¶å®é€šè¿‡å»é™¤éƒ¨åˆ†è¿æ¥å’Œè°ƒè¯•ç­‰ä¿¡æ¯æ¥ä½¿å¾—ç¼–è¯‘ä¹‹åçš„æ‰§è¡Œç¨‹åºæ›´å°,å…·ä½“å‚æ•°å¦‚ä¸‹:</p>
<ul>
<li><code>-a</code> å¼ºåˆ¶ç¼–è¯‘æ‰€æœ‰ä¾èµ–åŒ…</li>
<li><code>-s</code> å»æ‰ç¬¦å·è¡¨ä¿¡æ¯, panicæ—¶å€™çš„stack traceå°±æ²¡æœ‰ä»»ä½•æ–‡ä»¶å/è¡Œå·ä¿¡æ¯äº†.</li>
<li><code>-w</code> å»æ‰DWARFè°ƒè¯•ä¿¡æ¯ï¼Œå¾—åˆ°çš„ç¨‹åºå°±ä¸èƒ½ç”¨gdbè°ƒè¯•äº†</li>
</ul>
<p>å¦‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯å¾—åˆ°ä¼˜åŒ–ç¼–è¯‘è¿‡çš„<code>test</code>å¯æ‰§è¡Œç¨‹åº:4.8M</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go build -ldflags -w test.go</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸å»ºè®®så’ŒwåŒæ—¶ä½¿ç”¨ã€‚</p>
</blockquote>
<h2 id="u4F7F_u7528upx"><a href="#u4F7F_u7528upx" class="headerlink" title="ä½¿ç”¨upx"></a>ä½¿ç”¨upx</h2><p>ä¸Šé¢golang build æ—¶åŠ ä¸Š<code>-ldflags</code>å‚æ•°å¾—åˆ°äº†æ¯”è¾ƒå°çš„å¯æ‰§è¡Œç¨‹åºï¼Œ ä½†æ˜¯è¿˜å¯ä»¥é€šè¿‡<code>upx</code>è¿™ä¸ªå¼€æºï¼Œç»¿è‰²ï¼Œå¥½ç”¨çš„å‹ç¼©å·¥å…·è¿›è¡Œè¿›ä¸€æ­¥å‹ç¼©ï¼Œé¦–å…ˆå…¶ä¸‹è½½åœ°å€:<a href="http://upx.sourceforge.net/#downloadupx" target="_blank" rel="external">http://upx.sourceforge.net/#downloadupx</a></p>
<p>linux ç³»ç»Ÿé€‰æ‹©ä¸‹è½½:<code>upx-3.91-amd64_linux.tar.bz2</code> å³å¯, ç„¶å <code>tar -xvf upx-3.91-amd64_linux.tar.bz2</code> è¿›å…¥åˆ°è§£å‹æ–‡ä»¶å¤¹ä¸­å°†å¯æ‰§è¡Œæ–‡ä»¶<code>upx</code> æ‹·è´åˆ°<code>/usr/bin</code>å°±å¯ä»¥å…¨å±€æ‰§è¡Œäº†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mv upx /usr/bin</span><br><span class="line">âœ  <span class="built_in">test</span> git:(master) âœ— upx -<span class="number">9</span> -k <span class="built_in">test</span> </span><br><span class="line">                       Ultimate Packer <span class="keyword">for</span> eXecutables</span><br><span class="line">                          Copyright (C) <span class="number">1996</span> - <span class="number">2013</span></span><br><span class="line">UPX <span class="number">3.91</span>        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Sep <span class="number">30</span>th <span class="number">2013</span></span><br><span class="line"></span><br><span class="line">        File size         Ratio      Format      Name</span><br><span class="line">   --------------------   ------   -----------   -----------</span><br><span class="line">   <span class="number">5024059</span> -&gt;   <span class="number">1552060</span>   <span class="number">30.89</span>%  linux/ElfAMD   <span class="built_in">test</span> </span><br><span class="line"></span><br><span class="line">Packed <span class="number">1</span> file.</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°é€šè¿‡<code>upx</code>è¿›ä¸€æ­¥å‹ç¼©ä¹‹åå¾—åˆ°çš„ç¨‹åºå¤§çº¦åªæœ‰1.5Mäº†ï¼Œ å‹ç¼©æ¯”ç‡è¾¾åˆ°äº†<code>30.89%</code>.<br>å…¶ä¸­<code>-k</code>å‚æ•°è¡¨ç¤ºä¿ç•™å¤‡ä»½æ–‡ä»¶ï¼Œ <code>-9</code>ä»£è¡¨æœ€ä¼˜å‹ç¼©ï¼Œ<code>upx</code>æ€»å…±æœ‰9æ¡£å‹ç¼©,ä»<code>1</code>åˆ°<code>9</code> å…¶ä¸­ <code>-1</code>å‹ç¼©é€Ÿåº¦æœ€å¿«.</p>
<p>å†æ¥çœ‹çœ‹ä¸‹é¢ç¼–è¯‘ä¹‹åçš„æ•ˆæœ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go build test.go ---&gt; å¾—åˆ°çš„ <span class="built_in">test</span>  å¤§çº¦<span class="number">6.5</span>MB </span><br><span class="line">$ go build -ldflags -w ---&gt; å¾—åˆ°çš„ <span class="built_in">test</span> å¤§çº¦<span class="number">4.8</span>MB</span><br><span class="line">$ upx -<span class="number">9</span> <span class="built_in">test</span>  ---&gt; å¾—åˆ°çš„ <span class="built_in">test</span> å¤§çº¦ <span class="number">1.5</span>MB</span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å°½ç®¡go1.7.3ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºå·²ç»å¾ˆå°äº†,ä½†æ˜¯é€šè¿‡ç¼–è¯‘å‚æ•°æ§åˆ¶è¿˜èƒ½ç¼–è¯‘å‡ºæ›´å°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ€»ç»“å¦‚ä¸‹,&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>mac vim7.3 å‡çº§åˆ°vim8.0</title>
    <link href="http://www.grdtechs.com/2016/10/16/mac-update-vim8-0/"/>
    <id>http://www.grdtechs.com/2016/10/16/mac-update-vim8-0/</id>
    <published>2016-10-16T23:08:56.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å°†macè‡ªå¸¦çš„vim7.3 å‡çº§åˆ°vim8.0<br><a id="more"></a></p>
<h2 id="u5347_u7EA7vim8-0"><a href="#u5347_u7EA7vim8-0" class="headerlink" title="å‡çº§vim8.0"></a>å‡çº§vim8.0</h2><ul>
<li><p>å‡çº§ç»ˆç«¯ç”¨å¾—vim </p>
<blockquote>
<p>brew install vim â€“with-lua â€“with-override-system-vi</p>
</blockquote>
</li>
<li><p>å‡çº§GUIç‰ˆæœ¬çš„vim</p>
<blockquote>
<p>brew install macvim â€“with-lua â€“with-override-system-vim</p>
</blockquote>
</li>
</ul>
<h2 id="brew_install__u4E0B_u8F7D_u6162"><a href="#brew_install__u4E0B_u8F7D_u6162" class="headerlink" title="brew install ä¸‹è½½æ…¢"></a>brew install ä¸‹è½½æ…¢</h2><p>ç”¨<code>brew install</code>å‘ç°ä¸‹è½½vim8.0å¾ˆæ…¢ï¼Œ è§£å†³æ–¹æ¡ˆæ˜¯å…ˆå»æµè§ˆå™¨æˆ–ç”¨<code>wget</code>ç­‰å…¶å®ƒæ–¹å¼ä¸‹è½½å¥½è¦å®‰è£…çš„åŒ…ï¼Œç„¶åæ›¿æ¢æ‰<code>brew cache</code>ä¸‹çš„åŒ…å³å¯ã€‚å…·ä½“æ“ä½œï¼š</p>
<ul>
<li>æ‰¾<code>brew cache</code> ç›®å½•<blockquote>
<p>brew cache<br>/Users/lihong/Library/Cache/Homebrew</p>
</blockquote>
</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ä¸Šè¿°ç›®å½•ä¸­å·²ç»æœ‰ä¸€ä¸ª<code>vim-8.00041.tar.gz.incomplete</code> æ–‡ä»¶äº†ï¼Œ å°†è‡ªå·±ä¸‹è½½å¥½çš„å®‰è£…åŒ…ä¹Ÿä¿®æ”¹ä¸ºå’Œè¿™ä¸ªæœªå®Œæˆæ–‡ä»¶çš„æ–‡ä»¶åä¸€æ ·ï¼Œå¦‚ä¿®æ”¹ä¸º<code>vim-8.00041.tar.gz</code>. ç„¶å,</p>
<blockquote>
<p>brew install vim â€“with-lua â€“with-override-system-vi</p>
</blockquote>
<ul>
<li><p>mac vim8.0 å…·ä½“å®‰è£…ä¿¡æ¯å¦‚ä¸‹: </p>
<ul>
<li><p>install </p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">âœ  ~ brew install vim --with-lua --with-override-system-vi</span><br><span class="line">==&gt; Using the sandbox</span><br><span class="line">==&gt; Downloading https://github.com/vim/vim/archive/v8.<span class="number">0.0041</span>.tar.gz</span><br><span class="line">==&gt; Downloading from https://codeload.github.com/vim/vim/tar.gz/v8.<span class="number">0.0041</span></span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">==&gt; ./configure --prefix=/usr/<span class="built_in">local</span> --mandir=/usr/<span class="built_in">local</span>/Cellar/vim/<span class="number">8.0</span>.<span class="number">0041</span>/share/man --enable-multibyte --with-tlib=ncurses --enable-cscope --with-compiledby=Homebrew --enable-luainterp --enable-perlinterp --enable-pythoninterp --enable-</span><br><span class="line">==&gt; make</span><br><span class="line">==&gt; make install prefix=/usr/<span class="built_in">local</span>/Cellar/vim/<span class="number">8.0</span>.<span class="number">0041</span> STRIP=/usr/bin/<span class="literal">true</span></span><br><span class="line">ğŸº  /usr/<span class="built_in">local</span>/Cellar/vim/<span class="number">8.0</span>.<span class="number">0041</span>: <span class="number">1</span>,<span class="number">706</span> files, <span class="number">23.3</span>M, built <span class="keyword">in</span> <span class="number">5</span> minutes <span class="number">16</span> seconds</span><br></pre></td></tr></table></figure>
</li>
<li><p>:version</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">:version</span><br><span class="line">VIM - Vi IMproved <span class="number">8.0</span> (<span class="number">2016</span> Sep <span class="number">12</span>, compiled Oct <span class="number">16</span> <span class="number">2016</span> <span class="number">23</span>:<span class="number">10</span>:<span class="number">47</span>)</span><br><span class="line">MacOS X (unix) version</span><br><span class="line">Included patches: <span class="number">1</span>-<span class="number">41</span></span><br><span class="line">Compiled by Homebrew</span><br><span class="line">Huge version without GUI.  Features included (+) or not (-):</span><br><span class="line">+acl             -clientserver    +cursorbind      +ex_extra        -gettext         +libcall         +mouse           +mouse_xterm     +persistent_undo +ruby            +tag_old_static  -toolbar         +wildmenu        -xterm_save</span><br><span class="line">+arabic          +clipboard       +cursorshape     +extra_search    -hangul_input    +linebreak       -mouseshape      +multi_byte      +postscript      +scrollbind      -tag_any_white   +user_commands   +windows</span><br><span class="line">+autocmd         +cmdline_compl   +dialog_con      +farsi           +iconv           +lispindent      +mouse_dec       +multi_lang      +printer         +signs           -tcl             +vertsplit       +writebackup</span><br><span class="line">-balloon_<span class="built_in">eval</span>    +cmdline_hist    +diff            +file_<span class="keyword">in</span>_path    +insert_expand   +listcmds        -mouse_gpm       -mzscheme        +profile         +smartindent     +termguicolors   +virtualedit     -X11</span><br><span class="line">-browse          +cmdline_info    +digraphs        +find_<span class="keyword">in</span>_path    +job             +localmap        -mouse_jsbterm   +netbeans_intg   +python          +startuptime     +terminfo        +visual          -xfontset</span><br><span class="line">++<span class="built_in">builtin</span>_terms  +comments        -dnd             +<span class="built_in">float</span>           +jumplist        +lua             +mouse_netterm   +num64           -python3         +statusline      +termresponse    +visualextra     -xim</span><br><span class="line">+byte_offset     +conceal         -ebcdic          +folding         +keymap          +menu            +mouse_sgr       +packages        +quickfix        -sun_workshop    +textobjects     +viminfo         -xpm</span><br><span class="line">+channel         +cryptv          +emacs_tags      -footer          +lambda          +mksession       -mouse_sysmouse  +path_extra      +reltime         +syntax          +timers          +vreplace        -xsmp</span><br><span class="line">+cindent         +cscope          +<span class="built_in">eval</span>            +fork()          +langmap         +modify_fname    +mouse_urxvt     +perl            +rightleft       +tag_binary      +title           +wildignore      -xterm_clipboard</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å°†macè‡ªå¸¦çš„vim7.3 å‡çº§åˆ°vim8.0&lt;br&gt;
    
    </summary>
    
      <category term="DevOps" scheme="http://www.grdtechs.com/categories/DevOps/"/>
    
    
      <category term="vim8.0" scheme="http://www.grdtechs.com/tags/vim8-0/"/>
    
  </entry>
  
  <entry>
    <title>ä¼˜é›…çš„å…³é—­ticker</title>
    <link href="http://www.grdtechs.com/2016/10/16/close-ticker-correctly/"/>
    <id>http://www.grdtechs.com/2016/10/16/close-ticker-correctly/</id>
    <published>2016-10-16T14:27:39.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨<code>ticker</code>å’Œ<code>goroutine</code>ç»„åˆä½¿ç”¨ä¸­å½“è°ƒç”¨<code>ticker.Stop()</code>å…³é—­<code>ticker</code>ä¹‹åï¼Œç›¸åº”çš„<code>goroutine</code>ä¸­çš„<code>ticker.C</code>å¹¶æ²¡æœ‰åœæ‰ï¼Œä¸‹é¢æ€»ç»“ä¸€ç§ä¼˜é›…çš„æ–¹å¼å…³é—­<code>ticker</code>.<br><a id="more"></a></p>
<h2 id="u4F18_u96C5_u7684_u5173_u95EDticker"><a href="#u4F18_u96C5_u7684_u5173_u95EDticker" class="headerlink" title="ä¼˜é›…çš„å…³é—­ticker"></a>ä¼˜é›…çš„å…³é—­<code>ticker</code></h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	Demo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Demo() &#123;</span><br><span class="line">	done := startTicker(PrintInfo)</span><br><span class="line">	time.Sleep(time.Duration(<span class="number">12</span>) * time.Second)</span><br><span class="line">	<span class="built_in">close</span>(done)</span><br><span class="line">	time.Sleep(time.Duration(<span class="number">1</span>) * time.Minute)</span><br><span class="line">	fmt.Println(<span class="string">"main finished"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> startTicker(f <span class="keyword">func</span>()) <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125; &#123;</span><br><span class="line">	done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="keyword">func</span>() &#123;</span><br><span class="line">		ticker := time.NewTicker(<span class="number">5</span> * time.Second)</span><br><span class="line">		<span class="comment">//	ticker := time.NewTicker(5 * time.Minute)</span></span><br><span class="line">		<span class="keyword">defer</span> ticker.Stop()</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-ticker.C:</span><br><span class="line">				f()</span><br><span class="line">			<span class="keyword">case</span> &lt;-done:</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">return</span> done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> PrintInfo() &#123;</span><br><span class="line">	fmt.Println(<span class="string">"hello"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç é€šè¿‡<code>startTicker</code>åˆ›å»ºä¸€ä¸ª<code>ticker</code>, å½“æƒ³è¦å…³é—­è¿™ä¸ª<code>ticker</code>å¹¶åŒæ—¶é€€å‡ºå¯¹åº”<code>goroutine</code>ä¸­çš„<code>for</code>æ—¶ï¼Œå¯ä»¥ç›´æ¥<code>close()</code>ï¼Œå‘é€<code>done</code>ä¿¡å·ç›´æ¥è¿”å›é€€å‡º<code>startTicker</code>å³å¯.</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨&lt;code&gt;ticker&lt;/code&gt;å’Œ&lt;code&gt;goroutine&lt;/code&gt;ç»„åˆä½¿ç”¨ä¸­å½“è°ƒç”¨&lt;code&gt;ticker.Stop()&lt;/code&gt;å…³é—­&lt;code&gt;ticker&lt;/code&gt;ä¹‹åï¼Œç›¸åº”çš„&lt;code&gt;goroutine&lt;/code&gt;ä¸­çš„&lt;code&gt;ticker.C&lt;/code&gt;å¹¶æ²¡æœ‰åœæ‰ï¼Œä¸‹é¢æ€»ç»“ä¸€ç§ä¼˜é›…çš„æ–¹å¼å…³é—­&lt;code&gt;ticker&lt;/code&gt;.&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="ticker" scheme="http://www.grdtechs.com/tags/ticker/"/>
    
  </entry>
  
  <entry>
    <title>Golangå‘é€postè¡¨å•è¯·æ±‚</title>
    <link href="http://www.grdtechs.com/2016/09/07/go-postform/"/>
    <id>http://www.grdtechs.com/2016/09/07/go-postform/</id>
    <published>2016-09-07T16:00:32.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>golangè¿™è¾¹å°†<code>map</code>ç»“æ„åºåˆ—åŒ–é€šå¸¸é‡‡ç”¨<code>json.Marshal</code>å’Œ<code>json.Unmarshal</code>æ¥åšï¼Œä½†æ˜¯åœ¨php serverç«¯è¿˜éœ€è¦åš<code>json</code>ååºåˆ—åŒ–è§£ææ‰èƒ½ç”¨ï¼Œ ç”¨golangæ¨¡æ‹Ÿè¡¨å•æäº¤, php serverç«¯åˆ™éå¸¸æ–¹ä¾¿æå–ç›¸åº”çš„æ•°æ®å­—æ®µ.<br><a id="more"></a></p>
<h2 id="u65B9_u6CD5"><a href="#u65B9_u6CD5" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>æ–¹æ³•æ˜¯åˆ©ç”¨golang<code>net/http</code>åŒ…æä¾›çš„<code>PostForm</code>æäº¤postè¡¨å•æäº¤ã€‚<code>ParseForm</code>è§£æ<code>URL</code>ä¸­çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¹¶å°†è§£æç»“æœæ›´æ–°åˆ°<code>r.Form</code>å­—æ®µã€‚å¯¹äº<code>POST</code>æˆ–<code>PUT</code>è¯·æ±‚ï¼Œ<code>ParseForm</code>è¿˜ä¼šå°†<code>body</code>å½“ä½œè¡¨å•è§£æï¼Œå¹¶å°†ç»“æœæ—¢æ›´æ–°åˆ°<code>r.PostForm</code>ä¹Ÿæ›´æ–°åˆ°<code>r.Form</code>ã€‚è§£æç»“æœä¸­ï¼Œ<code>POST</code>æˆ–<code>PUT</code>è¯·æ±‚ä¸»ä½“è¦ä¼˜å…ˆäº<code>URL</code>æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåŒåå˜é‡ï¼Œä¸»ä½“çš„å€¼åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²çš„å€¼å‰é¢ï¼‰ã€‚å¦‚æœè¯·æ±‚çš„ä¸»ä½“çš„å¤§å°æ²¡æœ‰è¢«<code>MaxBytesReader</code>å‡½æ•°è®¾å®šé™åˆ¶ï¼Œå…¶å¤§å°é»˜è®¤é™åˆ¶ä¸ºå¼€å¤´10MBã€‚</p>
<h2 id="http-Client_7B_7D-PostForm"><a href="#http-Client_7B_7D-PostForm" class="headerlink" title="http.Client{}.PostForm"></a>http.Client{}.PostForm</h2><p>åˆ©ç”¨<code>http.Client{}.PostForm</code>æäº¤postè¡¨å•ã€‚</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"net/http"</span></span><br><span class="line">client := &amp;http.Client&#123;&#125;</span><br><span class="line">res, err := client.PostForm(<span class="string">"http://127.0.0.1:8091/postpage"</span>, url.Values&#123;</span><br><span class="line">	<span class="string">"key"</span>:   &#123;<span class="string">"this is client key"</span>&#125;,</span><br><span class="line">	<span class="string">"value"</span>: &#123;<span class="string">"this is client value"</span>&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="http-PostForm"><a href="#http-PostForm" class="headerlink" title="http.PostForm"></a>http.PostForm</h2><p>ç›´æ¥ç”¨<code>http.PostForm</code>æäº¤postè¡¨å•ã€‚</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"net/http"</span></span><br><span class="line"><span class="comment">//data := make(url.Values)</span></span><br><span class="line"><span class="comment">//data["key"] = []string&#123;"this is key"&#125;</span></span><br><span class="line"><span class="comment">//data["value"] = []string&#123;"this is value"&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æŠŠpostè¡¨å•å‘é€ç»™ç›®æ ‡æœåŠ¡å™¨</span></span><br><span class="line">res, err := http.PostForm(<span class="string">"http://127.0.0.1:8091/postpage"</span>, url.Values&#123;</span><br><span class="line">	<span class="string">"key"</span>:   &#123;<span class="string">"this is url key"</span>&#125;,</span><br><span class="line">	<span class="string">"value"</span>: &#123;<span class="string">"this is url value"</span>&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="u5BF9_u8868_u5355_u6570_u636E_u7684_u63D0_u53D6"><a href="#u5BF9_u8868_u5355_u6570_u636E_u7684_u63D0_u53D6" class="headerlink" title="å¯¹è¡¨å•æ•°æ®çš„æå–"></a>å¯¹è¡¨å•æ•°æ®çš„æå–</h2><p>serverç«¯å¯¹è¡¨å•æ•°æ®çš„æå–<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¥å—postè¯·æ±‚ï¼Œ ç„¶åæ‰“å°è¡¨å•ä¸­keyå’Œvalueå­—æ®µçš„å€¼</span></span><br><span class="line"><span class="keyword">if</span> r.Method == <span class="string">"POST"</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		key   <span class="typename">string</span> = r.PostFormValue(<span class="string">"key"</span>)</span><br><span class="line">		value <span class="typename">string</span> = r.PostFormValue(<span class="string">"value"</span>)</span><br><span class="line">	)</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/researchlab/golearning/tree/master/postform" target="_blank" rel="external">githubç¤ºä¾‹ä»£ç </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;golangè¿™è¾¹å°†&lt;code&gt;map&lt;/code&gt;ç»“æ„åºåˆ—åŒ–é€šå¸¸é‡‡ç”¨&lt;code&gt;json.Marshal&lt;/code&gt;å’Œ&lt;code&gt;json.Unmarshal&lt;/code&gt;æ¥åšï¼Œä½†æ˜¯åœ¨php serverç«¯è¿˜éœ€è¦åš&lt;code&gt;json&lt;/code&gt;ååºåˆ—åŒ–è§£ææ‰èƒ½ç”¨ï¼Œ ç”¨golangæ¨¡æ‹Ÿè¡¨å•æäº¤, php serverç«¯åˆ™éå¸¸æ–¹ä¾¿æå–ç›¸åº”çš„æ•°æ®å­—æ®µ.&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="form" scheme="http://www.grdtechs.com/tags/form/"/>
    
      <category term="post" scheme="http://www.grdtechs.com/tags/post/"/>
    
  </entry>
  
  <entry>
    <title>php7 å®‰è£…redisæ‰©å±•</title>
    <link href="http://www.grdtechs.com/2016/08/02/php7-redis-install/"/>
    <id>http://www.grdtechs.com/2016/08/02/php7-redis-install/</id>
    <published>2016-08-02T18:56:05.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨<code>Ubuntu16.04</code>ä¸Šï¼Œ å®‰è£…<code>php7</code>çš„<code>redis</code>æ‰©å±•, è®°å½•å®‰è£…è¿‡ç¨‹ã€‚<br><a id="more"></a></p>
<h3 id="u5B89_u88C5phpredis"><a href="#u5B89_u88C5phpredis" class="headerlink" title="å®‰è£…phpredis"></a>å®‰è£…phpredis</h3><p><code>Redis</code>å·²ç»æœ‰äº†<code>PHP7</code>ç‰ˆæœ¬ï¼Œå¯ä»¥ä»<code>github</code> ä¸Šè·å–é¡¹ç›®å…‹éš†ï¼Œç„¶åæ‰‹åŠ¨åˆ‡æ¢åˆ° <code>php7</code> åˆ†æ”¯å³å¯å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/phpredis/phpredis.git </span><br><span class="line">$ <span class="built_in">cd</span> phpredis/ </span><br><span class="line">$ git checkout php7 </span><br><span class="line">$ phpize </span><br><span class="line">$ ./configure </span><br><span class="line">$ make </span><br><span class="line">$ makeinstall</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰å®‰è£…php7.0-dev, åˆ™æ²¡æœ‰å®‰è£… <code>phpize</code> , å¯ä»¥ç›´æ¥<code>sudo apt install php7.0-dev</code> å®‰è£…å³å¯ã€‚ </p>
<h2 id="u542F_u52A8_redis__u6269_u5C55"><a href="#u542F_u52A8_redis__u6269_u5C55" class="headerlink" title="å¯åŠ¨ redis æ‰©å±•"></a>å¯åŠ¨ redis æ‰©å±•</h2><p>å…‰å®‰è£…äº†è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¼–è¾‘PHPçš„é…ç½®æ–‡ä»¶æ¥ä½¿æ‰©å±•è¢«åŠ è½½æ‰è¡Œï¼Œ æ‰“å¼€é…ç½®æ–‡ä»¶<code>vim /etc/php/7.0/fpm/php .ini</code>, åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹è¯­å¥ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extension=redis.so</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åé‡å¯phpæœåŠ¡,<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/php7.<span class="number">0</span>-fpm restart</span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨&lt;code&gt;Ubuntu16.04&lt;/code&gt;ä¸Šï¼Œ å®‰è£…&lt;code&gt;php7&lt;/code&gt;çš„&lt;code&gt;redis&lt;/code&gt;æ‰©å±•, è®°å½•å®‰è£…è¿‡ç¨‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="php" scheme="http://www.grdtechs.com/categories/php/"/>
    
    
      <category term="php_redis" scheme="http://www.grdtechs.com/tags/php-redis/"/>
    
      <category term="phpize" scheme="http://www.grdtechs.com/tags/phpize/"/>
    
  </entry>
  
  <entry>
    <title>phpä¸­mvcæ¨¡å¼ä½¿ç”¨æ€»ç»“(ä¸€)</title>
    <link href="http://www.grdtechs.com/2016/07/30/php-mvc-1/"/>
    <id>http://www.grdtechs.com/2016/07/30/php-mvc-1/</id>
    <published>2016-07-30T16:34:45.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å°½ç®¡MVC(model view controller pattern)æ¨¡å¼åœ¨<code>PHP</code>webå¼€å‘ä¸­å¾ˆå—æ¬¢è¿ï¼Œä½†æ˜¯ç½‘ä¸Šå¾ˆéš¾æ‰¾åˆ°ä¸€å¥—ä»£ç ç®€å•åˆèƒ½æ¸…æ¥šé˜è¿°<code>PHP MVC</code>æ¨¡å¼çš„æ¡ˆä¾‹ï¼Œæœ¬æ–‡å¸Œæœ›é€šè¿‡ç†è®ºå’Œä»£ç å®è·µç®€å•é˜è¿°<code>PHP MVC</code>æ¨¡å¼ã€‚</p>
<a id="more"></a>
<p><code>MVC</code>æ¨¡å¼åœ¨åº”ç”¨ä¸­åˆ†ä¸º<code>Model</code>, <code>View</code> å’Œ <code>Controller</code>ä¸‰æ¨¡å—:</p>
<p><code>Model</code>è´Ÿè´£å¤„ç†æ•°æ®; ä¸»è¦è´Ÿè´£æ•°æ®æœ‰å…³çš„ä¸šåŠ¡å¤„ç†åŠå­˜å‚¨è¯»å–å·¥ä½œã€‚</p>
<p><code>View</code>è´Ÿè´£å°†<code>Model</code>å±‚çš„æ•°æ®æŒ‰ä¸€å®šçš„æ ¼å¼æ ·å¼å±•ç°ç»™ç”¨æˆ·ã€‚</p>
<p><code>Controller</code>è´Ÿè´£å°†<code>Model</code>å±‚å’Œ<code>View</code>å±‚è”ç³»èµ·æ¥ï¼Œ<code>Controller</code>å±‚å“åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚ä¸šåŠ¡åˆ†å‘ç»™<code>Model</code>å±‚ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œç„¶åå°†å¤„ç†æ•°æ®å†è¿”å›ç»™<code>View</code>å±‚å±•ç¤ºã€‚ </p>
<p><code>MVC</code>ä¸‰è€…ä¹‹é—´çš„å…³ç³»å¦‚å›¾æ‰€ç¤º:</p>
<center><br><img src="/imgs/mvc-collaboration.png" alt="MVC pattern Diagram"><br></center>

<p>æœ¬æ–‡è®¾è®¡çš„<code>MVC</code>demoç›®å½•å¦‚ä¸‹</p>
<center><br><img src="/imgs/mvc-structure.png" alt="mvc structure"><br></center>

<h2 id="Controller__u5C42"><a href="#Controller__u5C42" class="headerlink" title="Controller å±‚"></a>Controller å±‚</h2><p><code>Controller</code>å±‚å¯æ˜¯<code>MVC</code>çš„å…¥å£ï¼Œæ¥æ”¶ä¸€ä¸ªç”¨æˆ·è¯·æ±‚ï¼Œè§£æè¯·æ±‚å‘é€ç»™<code>Model</code>å±‚ï¼Œè°ƒç”¨<code>Model</code>å±‚å¤„ç†ä¸šåŠ¡ï¼Œæ¥æ”¶<code>Model</code>å±‚è¿”å›çš„æ•°æ®ç»“æœï¼Œå¹¶å°†æ•°æ®å‘é€ç»™å±•ç¤ºå±‚ã€‚<code>Controller</code>å±‚æ˜¯<code>Model</code>å±‚å’Œ<code>View</code>å±‚ä¹‹é—´çš„è¿æ¥çº½å¸¦;å°çš„æ¡†æ¶ä¸­<code>Model</code>å±‚å’Œ<code>View</code>å±‚æ˜¯åŒ…å«åœ¨<code>Controller</code>å±‚ä¸­ã€‚åº”ç”¨ç¨‹åºä¸­ä¸€èˆ¬ä¼šä»¥<code>index.php</code>ä½œä¸ºç¨‹åºçš„å…¥å£ï¼Œ<code>index.php</code>ä¼šå°†ç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚ç›´æ¥è½¬å‘åˆ°<code>Controller</code>å±‚,ç”±<code>Controller</code>å±‚è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php file </span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"controller/Controller.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$controller</span> = <span class="keyword">new</span> Controller();</span><br><span class="line"><span class="variable">$controller</span>-&gt;invoke();</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ¬ä¾‹ä¸­<code>Controller</code>å±‚åªæœ‰ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªæ„é€ å‡½æ•°ã€‚æ„é€ å‡½æ•°ç¤ºä¾‹åŒ–ä¸€ä¸ª<code>Model</code>ç±»çš„å®ä¾‹;å½“<code>Controller</code>å¯¹æ¥æ”¶çš„<code>req</code>è§£æä¹‹åï¼Œéœ€è¦å†³å®šè°ƒç”¨<code>Model</code>å±‚ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘è¿›è¡Œå¤„ç†ï¼Œç„¶åå°†<code>Model</code>å±‚è¿”å›çš„å¤„ç†æ•°æ®åˆ†å‘ç»™<code>view</code>å±‚å±•ç¤ºã€‚éœ€è¦çŸ¥é“çš„æ˜¯<code>Controller</code>å±‚ä¸æ˜¯çŸ¥é“<code>data</code>å¦‚ä½•å¤„ç†çš„ï¼Œä¹Ÿä¸çŸ¥é“é¡µé¢æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//controller/Controller.php file</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"model/Model.php"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$model</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="variable">$this</span>-&gt;model = <span class="keyword">new</span> Model();	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">isset</span>(!_GET[<span class="string">'book'</span>]))&#123;</span><br><span class="line">			<span class="variable">$books</span> = <span class="variable">$this</span>-&gt;model-&gt;getBookList();</span><br><span class="line">			<span class="keyword">include</span> <span class="string">'view/booklist.php'</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// show the requested book</span></span><br><span class="line">			<span class="variable">$book</span> = <span class="variable">$this</span>-&gt;model-&gt;getBook(<span class="variable">$_GET</span>[<span class="string">'book'</span>]);</span><br><span class="line">			<span class="keyword">include</span> <span class="string">'view/viewbook.php'</span>;</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>MVC</code>æ—¶åºå›¾</p>
<center><br><img src="/imgs/mvc-sequence1.png" alt="MVC Sequence Diagram"><br></center>

<h2 id="Model__u548C_Entity__u7C7B"><a href="#Model__u548C_Entity__u7C7B" class="headerlink" title="Model å’Œ Entity ç±»"></a>Model å’Œ Entity ç±»</h2><p><code>Model</code>å±‚è¡¨ç¤ºåº”ç”¨ç¨‹åºä¸­çš„æ•°æ®å’Œé€»è¾‘ï¼Œé€šå¸¸ç§°ä¹‹ä¸ºä¸šåŠ¡é€»è¾‘; é€šå¸¸è¡¨ç¤ºä¸ºå¦‚ä¸‹:</p>
<ul>
<li><p>å­˜å‚¨ï¼Œåˆ é™¤ï¼Œ æ›´æ–°åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚é€šå¸¸åŒ…æ‹¬æ•°æ®åº“æ–¹é¢çš„æ“ä½œ, ä¹Ÿå¯ä»¥æŒ‰ç…§ä¸€å®šçš„åè®®æ ¼å¼å°è£…æ•°æ®ç„¶åå†é€šè¿‡è°ƒç”¨ç¬¬ä¸‰æ–¹webæœåŠ¡æˆ–APIsè¿›è¡Œç›¸åº”çš„æ•°æ®å¤„ç†ã€‚</p>
</li>
<li><p>å°è£…åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘;å®ç°åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€‚é€šå¸¸äººä»¬ä¼šé”™è¯¯çš„åº”ç”¨ç¨‹åºçš„ä¸€äº›ä¸šåŠ¡é€»è¾‘å®ç°å†™å…¥åˆ°<code>Controller</code>å±‚æˆ–<code>View</code>å±‚ä¸­ï¼Œ è¿™æ˜¯ä¸€ç§é”™è¯¯çš„æˆ–è€…è¯´ä¸è§„èŒƒçš„åšæ³•ã€‚ </p>
</li>
</ul>
<p>æœ¬ä¾‹ä¸­ï¼Œ<code>Model</code>å±‚ä¸»è¦ç”±<code>Model</code>ç±»å’Œ<code>Book</code>ç±»ç»„æˆã€‚<code>Book</code>ç±»æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œåº”è¯¥æš´éœ²ç»™<code>View</code>å±‚ã€‚åœ¨ä¸€ä¸ªå¥½çš„<code>MVC</code>æ¨¡å¼è®¾è®¡ä¸­ï¼Œ<code>Model</code>å±‚ä¸­åªæœ‰<code>Entity</code>ç±»åº”è¯¥æš´éœ²æ¥å£ä¾›<code>View</code>å±‚è°ƒç”¨ã€‚è¿™æ ·åšçš„å”¯ä¸€ç›®çš„å°±æ˜¯ä¿æŒæ•°æ®,å› ä¸º<code>Entity</code>ç±»ä¸­çš„å¯¹è±¡å¯ä»¥é€šè¿‡<code>xml</code>æˆ–<code>json</code>æ•°æ®å—æ›¿æ¢ã€‚åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œ<code>Model</code>å±‚è¿”å›äº†ä¸€ä¸ªå…·ä½“çš„<code>book</code>å®ä¾‹ä¿¡æ¯ï¼Œæˆ–è€…ä¸€ä¸ª<code>books</code>list:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//model/Model.php file</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"model/Book.php"</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBookList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//here goes some hardcoded values to simulate the database</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">			<span class="string">"Jungle Book"</span>=&gt; <span class="keyword">new</span> Book(<span class="string">"Jungle Book"</span>, <span class="string">"R.Kipling"</span>, <span class="string">"A classic book."</span>),</span><br><span class="line">			<span class="string">"Moonwalker"</span>=&gt; <span class="keyword">new</span> Book(<span class="string">"Moonwalker"</span>, <span class="string">"J.Walker"</span>,<span class="string">""</span>),</span><br><span class="line">			<span class="string">"PHP for Dummies"</span>=&gt; <span class="keyword">new</span> Book(<span class="string">"PHP for Dummies"</span>, <span class="string">"Some Smart Guy"</span>,<span class="string">""</span>)</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBook</span><span class="params">(<span class="variable">$title</span>)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// we use the previous function to get all the books and then we return the requested one.</span></span><br><span class="line">		<span class="comment">// in a real life scenario this will be done through a db select command.</span></span><br><span class="line">		<span class="variable">$allBooks</span> = <span class="variable">$this</span>-&gt;getBookList();</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$allBooks</span>[<span class="variable">$title</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œ<code>Model</code>å±‚è´Ÿè´£å°†æ‰€æœ‰çš„å®ä½“å’Œç±»ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œ<code>Model</code>å±‚ä¸­çš„ç±»å°è£…æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//model/Book.php file</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$title</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$author</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$description</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(<span class="variable">$title</span>, <span class="variable">$author</span>, <span class="variable">$description</span>)</span></span>&#123;</span><br><span class="line">		<span class="variable">$this</span>-&gt;title = <span class="variable">$title</span>;</span><br><span class="line">		<span class="variable">$this</span>-&gt;author = <span class="variable">$author</span>;</span><br><span class="line">		<span class="variable">$this</span>-&gt;description = <span class="variable">$description</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="View_u5C42"><a href="#View_u5C42" class="headerlink" title="Viewå±‚"></a>Viewå±‚</h2><p><code>View</code>å±‚è´Ÿè´£å°†<code>Model</code>å±‚è¿”å›çš„æ•°æ®æŒ‰ç…§ä¸€å®šæ ·å¼æ ¼å¼åŒ–å‘ˆç°ç»™ç”¨æˆ·ã€‚<code>Model</code>å±‚è¿”å›çš„æ•°æ®å¯ä»¥æ˜¯ç®€å•çš„å¯¹è±¡ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯xml, jsonç­‰å¤æ‚çš„æ•°æ®ç±»å‹ã€‚</p>
<p><code>View</code>å±‚å¯¹äºç±»ä¼¼çš„å±•ç¤ºé€»è¾‘åº”æå–ä¸ºæ¨¡æ¿ï¼Œä¾¿äºå¤ç”¨<code>View</code>å±‚ä»£ç çš„åŒæ—¶æœ‰åˆ©äºç»´æŠ¤ ã€‚<code>Controller</code>å±‚é€šå¸¸é€šè¿‡<code>Entity</code>ç±»ä¸­çš„ä¸»<code>Entity</code>å®ä¾‹å¯¹è±¡å°†<code>Model</code>å±‚è¿”å›çš„æ•°æ®è½¬å‘ç»™<code>View</code>å±‚ä¸­ç‰¹å®šçš„å±•ç¤ºå…ƒç´ ã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­<code>View</code>å±‚åŒ…å«å±•ç¤ºå•ä¸ª<code>book</code>ä¿¡æ¯å’Œå±•ç¤ºæ‰€æœ‰<code>book</code>ä¿¡æ¯ä¸¤ä¸ªæ–‡ä»¶</p>
<h3 id="viewbook-php"><a href="#viewbook-php" class="headerlink" title="viewbook.php"></a>viewbook.php</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	<span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Title:'</span> . <span class="variable">$book</span>-&gt;title . <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Author:'</span> . <span class="variable">$book</span>-&gt;author . <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Description:'</span> . <span class="variable">$book</span>-&gt;description . <span class="string">'&lt;br/&gt;'</span>;</span><br><span class="line">	<span class="preprocessor">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="booklist-php"><a href="#booklist-php" class="headerlink" title="booklist.php"></a>booklist.php</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">table</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">tbody</span>&gt;</span><span class="tag">&lt;<span class="title">tr</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>Title<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>Author<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;<span class="title">td</span>&gt;</span>Description<span class="tag">&lt;/<span class="title">td</span>&gt;</span><span class="tag">&lt;/<span class="title">tr</span>&gt;</span><span class="tag">&lt;/<span class="title">tbody</span>&gt;</span>	</span><br><span class="line">		<span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$books</span> <span class="keyword">as</span> <span class="variable">$title</span> =&gt; <span class="variable">$book</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'&lt;tr&gt;&lt;td&gt;&lt;a href="index.php?book="'</span> . <span class="variable">$book</span>-&gt;title .<span class="string">'"&gt;'</span>.<span class="variable">$book</span>-&gt;title .<span class="string">'&lt;/a&gt;&lt;/td&gt;&lt;td&gt;'</span>.<span class="variable">$book</span>-&gt;author.<span class="string">'&lt;/td&gt;&lt;td&gt;'</span>.<span class="variable">$book</span>-&gt;description.<span class="string">'&lt;/td&gt;&lt;/tr&gt;'</span>;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="preprocessor">?&gt;</span></span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤æœ¬demoåˆ†æå®ç°å®Œæ¯•ï¼Œ<a href="https://github.com/researchlab/CodeSnippets/tree/master/php_wrk/simple_mvc" target="_blank" rel="external">githubç¤ºä¾‹ä»£ç </a></p>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><code>Model</code>å±‚å’Œ<code>View</code>å±‚åˆ†å¼€ä½¿å¾—æ„å»ºåº”ç”¨ç¨‹åºæ›´åŠ å®¹æ˜“</li>
<li><code>Model</code>å±‚å’Œ<code>View</code>å±‚å¯ä»¥æ ¹æ®é¡¹ç›®éœ€è¦å…¶ä¸­ä¸€å±‚æ„æˆ<code>MV</code>æˆ–<code>CV</code>æ¨¡å¼</li>
<li>å¯ä»¥å¯¹<code>MVC</code>æ¨¡å¼ä¸­æ¯ä¸ªå±‚è¿›è¡Œå•ç‹¬çš„æµ‹è¯•å’Œè°ƒè¯•</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å°½ç®¡MVC(model view controller pattern)æ¨¡å¼åœ¨&lt;code&gt;PHP&lt;/code&gt;webå¼€å‘ä¸­å¾ˆå—æ¬¢è¿ï¼Œä½†æ˜¯ç½‘ä¸Šå¾ˆéš¾æ‰¾åˆ°ä¸€å¥—ä»£ç ç®€å•åˆèƒ½æ¸…æ¥šé˜è¿°&lt;code&gt;PHP MVC&lt;/code&gt;æ¨¡å¼çš„æ¡ˆä¾‹ï¼Œæœ¬æ–‡å¸Œæœ›é€šè¿‡ç†è®ºå’Œä»£ç å®è·µç®€å•é˜è¿°&lt;code&gt;PHP MVC&lt;/code&gt;æ¨¡å¼ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="php" scheme="http://www.grdtechs.com/categories/php/"/>
    
    
      <category term="mvc" scheme="http://www.grdtechs.com/tags/mvc/"/>
    
      <category term="php" scheme="http://www.grdtechs.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨åˆ·æ–°åinputè¾“å…¥æ¡†ä¾æ—§ä¿ç•™åŸå€¼ä¸è¢«æ¸…ç©º</title>
    <link href="http://www.grdtechs.com/2016/07/10/browse-refresh-saveinputolderval/"/>
    <id>http://www.grdtechs.com/2016/07/10/browse-refresh-saveinputolderval/</id>
    <published>2016-07-10T18:22:43.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>htmlé¡µé¢ä¸­çš„inputæ¡†å¦‚æœåœ¨æµè§ˆå™¨åˆ·æ–°å‰æœ‰å€¼ï¼Œæ€ä¹ˆåœ¨åˆ·æ–°åä¾ç„¶ä¿ç•™è¿™ä¸ªå€¼ä¸è¢«æ¸…ç©ºå‘¢ï¼Ÿä¸‹é¢ç”¨<code>setCookie</code>çš„æ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜.<br><a id="more"></a><br>é¦–é€‰åˆ¤æ–­inputæ¡†ä¸­æœ‰å€¼æ—¶,<code>setcookie</code>, æ¯æ¬¡åˆ·æ–°æµè§ˆå™¨æ—¶ï¼Œè¯»å–<code>Cookie</code>å€¼,å¦‚æœå­˜åœ¨<code>Cookie</code>å€¼ï¼Œåˆ™ç”¨æ­¤å€¼åˆå§‹åŒ–inputå€¼ã€‚</p>
<h2 id="u7EAFjs_u5B9E_u73B0"><a href="#u7EAFjs_u5B9E_u73B0" class="headerlink" title="çº¯jså®ç°"></a>çº¯jså®ç°</h2><h3 id="u8BBE_u7F6ECookie"><a href="#u8BBE_u7F6ECookie" class="headerlink" title="è®¾ç½®Cookie"></a>è®¾ç½®Cookie</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">* @cname  cookie name </span><br><span class="line">* @cvalue cookie value </span><br><span class="line">* @ exdays cookie expires(å¤©)</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">cname,cvalue,exdays</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!(<span class="built_in">document</span>.cookie || navigator.cookieEnabled))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'æµè§ˆå™¨ cookie æœªæ‰“å¼€!'</span>);</span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">	d.setTime(d.getTime()+(exdays*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span>));</span><br><span class="line">	<span class="keyword">var</span> expires = <span class="string">"expires="</span>+d.toGMTString();</span><br><span class="line">	<span class="built_in">document</span>.cookie = cname+<span class="string">"="</span>+cvalue+<span class="string">"; "</span>+expires;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u83B7_u53D6Cookie"><a href="#u83B7_u53D6Cookie" class="headerlink" title="è·å–Cookie"></a>è·å–Cookie</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCookie</span>(<span class="params">cname</span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> name = cname + <span class="string">"="</span>;</span><br><span class="line">	<span class="keyword">var</span> ca = <span class="built_in">document</span>.cookie.split(<span class="string">';'</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;ca.length; i++) </span><br><span class="line">	  &#123;</span><br><span class="line">	  <span class="keyword">var</span> c = ca[i].trim();</span><br><span class="line">	  <span class="keyword">if</span> (c.indexOf(name)==<span class="number">0</span>) <span class="keyword">return</span> c.substring(name.length,c.length);</span><br><span class="line">	  &#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®<code>cname</code> è·å–ç›¸åº”çš„cookieå€¼ï¼Œ cookieä¸å­˜åœ¨å°±è¿”å›ç©ºå­—ç¬¦ä¸².</p>
<h3 id="checkCookie"><a href="#checkCookie" class="headerlink" title="checkCookie"></a>checkCookie</h3><p>å¯ä»¥å°†åˆ¤æ–­Cookieæ˜¯å¦å­˜åœ¨çš„ä¸‹ä¸€æ­¥å¤„ç†é€»è¾‘å°è£…åˆ°<code>checkCookie</code>æ–¹æ³•ä¸­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkCookie</span>(<span class="params"></span>)</span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> user=getCookie(<span class="string">"username"</span>);</span><br><span class="line">	<span class="keyword">if</span> (user!=<span class="string">""</span>)</span><br><span class="line">	  &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'user'</span>, user);	</span><br><span class="line">	  &#125;</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">	  &#123;</span><br><span class="line">	  <span class="keyword">if</span> (user!=<span class="string">""</span> &amp;&amp; user!=<span class="literal">null</span>)</span><br><span class="line">	    &#123;</span><br><span class="line">	    setCookie(<span class="string">"username"</span>,user,<span class="number">3000</span>);</span><br><span class="line">	    &#125;</span><br><span class="line">	  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u53E6_u4E00_u79CD_u65B9_u5F0F_u662F_u501F_u52A9jQuery_u5B9E_u73B0"><a href="#u53E6_u4E00_u79CD_u65B9_u5F0F_u662F_u501F_u52A9jQuery_u5B9E_u73B0" class="headerlink" title="å¦ä¸€ç§æ–¹å¼æ˜¯å€ŸåŠ©jQueryå®ç°"></a>å¦ä¸€ç§æ–¹å¼æ˜¯å€ŸåŠ©jQueryå®ç°</h2><p>é¦–é€‰å¼•å…¥jqueryç›¸åº”çš„åº“</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://apps.bdimg.com/libs/jquery.cookie/1.4.1/jquery.cookie.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="u521B_u5EFACookie"><a href="#u521B_u5EFACookie" class="headerlink" title="åˆ›å»ºCookie"></a>åˆ›å»ºCookie</h2><p>å¦‚åˆ›å»ºä¸€ä¸ªåä¸ºâ€œexampleâ€ï¼Œå€¼ä¸ºâ€œfooâ€çš„cookieï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.cookie(<span class="string">"example"</span>, <span class="string">"foo"</span>);</span><br></pre></td></tr></table></figure></p>
<p>è¦è®¾ç½®cookieçš„æœ‰æ•ˆæœŸï¼Œå¯ä»¥è®¾ç½®expireså€¼ï¼Œå¦‚è®¾ç½®cookieçš„è¿‡æœŸæ—¶é—´ä¸º10å¤©ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.cookie(<span class="string">"example"</span>, <span class="string">"foo"</span>,&#123;expires:<span class="number">10</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®cookieä¸€å°æ—¶åè¿‡æœŸï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cookietime = <span class="keyword">new</span> <span class="built_in">Date</span>(); </span><br><span class="line">cookietime.setTime(date.getTime() + (<span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>));<span class="comment">//coockieä¿å­˜ä¸€å°æ—¶ </span></span><br><span class="line">$.cookie(<span class="string">"example"</span>, <span class="string">"foo"</span>,&#123;expires:cookietime&#125;);</span><br></pre></td></tr></table></figure>
<p>è¦è®¾ç½®cookieçš„ä¿å­˜è·¯å¾„ï¼Œå¯ä»¥è®¾ç½®pathå€¼ï¼Œå¦‚è®¾ç½®è·¯å¾„ä¸ºæ ¹ç›®å½•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.cookie(<span class="string">"example"</span>, <span class="string">"foo"</span>,&#123;path:<span class="string">"/"</span>&#125;);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦è®¾ç½®è·¯å¾„ä¸º/adminï¼Œåˆ™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.cookie(<span class="string">"example"</span>, <span class="string">"foo"</span>,&#123;path:<span class="string">"/admin"</span>&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="u83B7_u53D6cookie_u503C"><a href="#u83B7_u53D6cookie_u503C" class="headerlink" title="è·å–cookieå€¼"></a>è·å–cookieå€¼</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.cookie(<span class="string">"example"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="u5220_u9664Cookie"><a href="#u5220_u9664Cookie" class="headerlink" title="åˆ é™¤Cookie"></a>åˆ é™¤Cookie</h2><p>ä½¿ç”¨jQueryåˆ é™¤cookieï¼Œåªéœ€è¦å°†cookieçš„å€¼ä¸ºnullï¼Œæ³¨æ„å¦‚æœè®¾ç½®å€¼ä¸ºç©ºçš„å­—ç¬¦ä¸²æ—¶ï¼Œå¹¶ä¸èƒ½åˆ é™¤cookieï¼Œåªæ˜¯å°†cookieå€¼æ¸…ç©ºè€Œå·²ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.cookie(<span class="string">"example"</span>,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.cookie(<span class="string">'the_cookie'</span>, <span class="string">''</span>, &#123; expires: -<span class="number">1</span> &#125;); <span class="comment">// åˆ é™¤ cookie</span></span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/researchlab/CodeSnippets" target="_blank" rel="external">githubæºç demo</a></p>
<ul>
<li>js-setcookie.html</li>
<li>jquery-setcookie.html</li>
</ul>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>cookieæ˜¯åŸºäºåŸŸåæ¥å‚¨å­˜çš„, cookieå…·æœ‰ä¸åŒåŸŸåä¸‹å‚¨å­˜ä¸å¯å…±äº«çš„ç‰¹æ€§ã€‚ è¿™ä¹Ÿæ˜¯cookieæ”¯æŒè®¾ç½®<code>path</code>å’Œ<code>domain</code>çš„ä½œç”¨ä¹‹ä¸€ã€‚<br>æ‰€ä»¥è¦æµ‹è¯•cookieæ˜¯å¦ç”Ÿæ•ˆï¼Œéœ€è¦æ”¾åˆ°æµ‹è¯•æœåŠ¡å™¨ä¸Šæˆ–è€…æœ¬åœ°localhostæœåŠ¡å™¨ä¸Šæ‰ä¼šç”Ÿæ•ˆã€‚<strong><font color="red">å•çº¯çš„æœ¬åœ°ä¸€ä¸ªhtmlé¡µé¢æ‰“å¼€æ˜¯æ— æ•ˆçš„ã€‚</font></strong></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;htmlé¡µé¢ä¸­çš„inputæ¡†å¦‚æœåœ¨æµè§ˆå™¨åˆ·æ–°å‰æœ‰å€¼ï¼Œæ€ä¹ˆåœ¨åˆ·æ–°åä¾ç„¶ä¿ç•™è¿™ä¸ªå€¼ä¸è¢«æ¸…ç©ºå‘¢ï¼Ÿä¸‹é¢ç”¨&lt;code&gt;setCookie&lt;/code&gt;çš„æ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜.&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.grdtechs.com/categories/javascript/"/>
    
    
      <category term="getcookie" scheme="http://www.grdtechs.com/tags/getcookie/"/>
    
      <category term="setcookie" scheme="http://www.grdtechs.com/tags/setcookie/"/>
    
  </entry>
  
  <entry>
    <title>go http client/server è®¾ç½®cookieå°ç»“</title>
    <link href="http://www.grdtechs.com/2016/07/10/go-setcookie/"/>
    <id>http://www.grdtechs.com/2016/07/10/go-setcookie/</id>
    <published>2016-07-10T16:51:56.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>Go</code>webå¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦è®¾ç½®è·å–cookies, ä¸ç®¡æ˜¯ä»clientç«¯è®¾ç½®è·å–è¿˜æ˜¯serverè®¾ç½®è·å–ï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼Œä¸‹é¢å°±æ€»ç»“ä¸€ä¸‹å¸¸ç”¨çš„æ–¹æ³•ã€‚<br><a id="more"></a></p>
<h2 id="golang_u4E2Dcookie__u8BE6_u7EC6_u5B9A_u4E49"><a href="#golang_u4E2Dcookie__u8BE6_u7EC6_u5B9A_u4E49" class="headerlink" title="golangä¸­cookie è¯¦ç»†å®šä¹‰"></a>golangä¸­cookie è¯¦ç»†å®šä¹‰</h2><p>golang å®˜æ–¹æ–‡æ¡£ä¸­å¯¹<code>Cookie</code>ç»“æ„çš„å®šä¹‰<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Cookie <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name       <span class="typename">string</span></span><br><span class="line">    Value      <span class="typename">string</span></span><br><span class="line">    Path       <span class="typename">string</span></span><br><span class="line">    Domain     <span class="typename">string</span></span><br><span class="line">    Expires    time.Time</span><br><span class="line">    RawExpires <span class="typename">string</span></span><br><span class="line">    <span class="comment">// MaxAge=0è¡¨ç¤ºæœªè®¾ç½®Max-Ageå±æ€§</span></span><br><span class="line">    <span class="comment">// MaxAge&lt;0è¡¨ç¤ºç«‹åˆ»åˆ é™¤è¯¥cookieï¼Œç­‰ä»·äº"Max-Age: 0"</span></span><br><span class="line">    <span class="comment">// MaxAge&gt;0è¡¨ç¤ºå­˜åœ¨Max-Ageå±æ€§ï¼Œå•ä½æ˜¯ç§’</span></span><br><span class="line">    MaxAge   <span class="typename">int</span></span><br><span class="line">    Secure   <span class="typename">bool</span></span><br><span class="line">    HttpOnly <span class="typename">bool</span></span><br><span class="line">    Raw      <span class="typename">string</span></span><br><span class="line">    Unparsed []<span class="typename">string</span> <span class="comment">// æœªè§£æçš„â€œå±æ€§-å€¼â€å¯¹çš„åŸå§‹æ–‡æœ¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>Cookie</code>ä»£è¡¨ä¸€ä¸ªå‡ºç°åœ¨<code>HTTPå›å¤çš„å¤´åŸŸ</code>ä¸­<code>Set-Cookieå¤´çš„å€¼é‡Œ</code>æˆ–è€…<code>HTTPè¯·æ±‚çš„å¤´åŸŸ</code>ä¸­Cookieå¤´çš„å€¼é‡Œçš„HTTP cookieã€‚</p>
<ul>
<li><p><code>Expires</code> â€“ è¿‡æœŸæ—¶é—´ã€‚æŒ‡å®šcookieçš„ç”Ÿå‘½æœŸã€‚å…·ä½“æ˜¯å€¼æ˜¯è¿‡æœŸæ—¥æœŸã€‚å¦‚æœæƒ³è®©cookieçš„å­˜åœ¨æœŸé™è¶…è¿‡å½“å‰æµè§ˆå™¨ä¼šè¯æ—¶é—´ï¼Œå°±å¿…é¡»ä½¿ç”¨è¿™ä¸ªå±æ€§ã€‚å½“è¿‡äº†åˆ°æœŸæ—¥æœŸæ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥åˆ é™¤cookieæ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ã€‚</p>
</li>
<li><p><code>Path</code> â€“ è·¯å¾„ã€‚æŒ‡å®šä¸cookieå…³è”çš„WEBé¡µã€‚å€¼å¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªè·¯å¾„ã€‚å¦‚æœ/head/index.html å»ºç«‹äº†ä¸€ä¸ªcookieï¼Œé‚£ä¹ˆåœ¨/head/ç›®å½•é‡Œçš„æ‰€æœ‰é¡µé¢ï¼Œä»¥åŠè¯¥ç›®å½•ä¸‹é¢ä»»ä½•å­ç›®å½•é‡Œçš„é¡µé¢éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªcookieã€‚è¿™å°±æ˜¯è¯´ï¼Œåœ¨/head/stories/articles é‡Œçš„ä»»ä½•é¡µé¢éƒ½å¯ä»¥è®¿é—®/head/index.htmlå»ºç«‹çš„cookieã€‚ä½†æ˜¯ï¼Œå¦‚æœ/zdnn/ éœ€è¦è®¿é—®/head/index.htmlè®¾ç½®çš„cookesï¼Œè¯¥æ€ä¹ˆåŠ?è¿™æ—¶ï¼Œæˆ‘ä»¬è¦æŠŠcookiesçš„pathå±æ€§è®¾ç½®æˆâ€œ/â€ã€‚åœ¨æŒ‡å®šè·¯å¾„çš„æ—¶å€™ï¼Œå‡¡æ˜¯æ¥è‡ªåŒä¸€æœåŠ¡å™¨ï¼ŒURLé‡Œæœ‰ç›¸åŒè·¯å¾„çš„æ‰€æœ‰WEBé¡µé¢éƒ½å¯ä»¥å…±äº«cookiesã€‚ç°åœ¨çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼šå¦‚æœæƒ³è®© /head/filters/ å’Œ/head/stories/å…±äº«cookiesï¼Œå°±è¦æŠŠpathè®¾æˆâ€œ/headâ€ã€‚</p>
</li>
<li><p><code>Domain</code> â€“ åŸŸã€‚æŒ‡å®šå…³è”çš„WEBæœåŠ¡å™¨æˆ–åŸŸã€‚å€¼æ˜¯åŸŸåï¼Œæ¯”å¦‚goaler.comã€‚è¿™æ˜¯å¯¹pathè·¯å¾„å±æ€§çš„ä¸€ä¸ªå»¶ä¼¸ã€‚å¦‚æœæˆ‘ä»¬æƒ³è®©dev.mycompany.com èƒ½å¤Ÿè®¿é—®bbs.mycompany.comè®¾ç½®çš„cookiesï¼Œè¯¥æ€ä¹ˆåŠ? æˆ‘ä»¬å¯ä»¥æŠŠdomainå±æ€§è®¾ç½®æˆâ€œmycompany.comâ€ï¼Œå¹¶æŠŠpathå±æ€§è®¾ç½®æˆâ€œ/â€ã€‚FYIï¼šä¸èƒ½æŠŠcookiesåŸŸå±æ€§è®¾ç½®æˆä¸è®¾ç½®å®ƒçš„æœåŠ¡å™¨çš„æ‰€åœ¨åŸŸä¸åŒçš„å€¼ã€‚</p>
</li>
<li><p><code>Secure</code> â€“ å®‰å…¨ã€‚æŒ‡å®šcookieçš„å€¼é€šè¿‡ç½‘ç»œå¦‚ä½•åœ¨ç”¨æˆ·å’ŒWEBæœåŠ¡å™¨ä¹‹é—´ä¼ é€’ã€‚è¿™ä¸ªå±æ€§çš„å€¼æˆ–è€…æ˜¯â€œsecureâ€ï¼Œæˆ–è€…ä¸ºç©ºã€‚ç¼ºçœæƒ…å†µä¸‹ï¼Œè¯¥å±æ€§ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸å®‰å…¨çš„HTTPè¿æ¥ä¼ é€’æ•°æ®ã€‚å¦‚æœä¸€ä¸ª cookie æ ‡è®°ä¸ºsecureï¼Œé‚£ä¹ˆï¼Œå®ƒä¸WEBæœåŠ¡å™¨ä¹‹é—´å°±é€šè¿‡HTTPSæˆ–è€…å…¶å®ƒå®‰å…¨åè®®ä¼ é€’æ•°æ®ã€‚ä¸è¿‡ï¼Œè®¾ç½®äº†secureå±æ€§ä¸ä»£è¡¨å…¶ä»–äººä¸èƒ½çœ‹åˆ°ä½ æœºå™¨æœ¬åœ°ä¿å­˜çš„cookieã€‚æ¢å¥è¯è¯´ï¼ŒæŠŠcookieè®¾ç½®ä¸ºsecureï¼Œåªä¿è¯cookieä¸WEBæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹åŠ å¯†ï¼Œè€Œä¿å­˜åœ¨æœ¬åœ°çš„cookieæ–‡ä»¶å¹¶ä¸åŠ å¯†ã€‚å¦‚æœæƒ³è®©æœ¬åœ°cookieä¹ŸåŠ å¯†ï¼Œå¾—è‡ªå·±åŠ å¯†æ•°æ®ã€‚å½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºåˆ›å»ºçš„ Cookie ä¼šè¢«ä»¥å®‰å…¨çš„å½¢å¼å‘æœåŠ¡å™¨ä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯åªèƒ½åœ¨ HTTPS è¿æ¥ä¸­è¢«æµè§ˆå™¨ä¼ é€’åˆ°æœåŠ¡å™¨ç«¯è¿›è¡Œä¼šè¯éªŒè¯ï¼Œå¦‚æœæ˜¯ HTTP è¿æ¥åˆ™ä¸ä¼šä¼ é€’è¯¥ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸ä¼šè¢«çªƒå–åˆ°Cookie çš„å…·ä½“å†…å®¹ã€‚</p>
</li>
<li><p><code>HttpOnly</code>å±æ€§,å¦‚æœåœ¨Cookieä¸­è®¾ç½®äº†â€HttpOnlyâ€å±æ€§ï¼Œé‚£ä¹ˆé€šè¿‡ç¨‹åº(JSè„šæœ¬ã€Appletç­‰)å°†æ— æ³•è¯»å–åˆ°Cookieä¿¡æ¯ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é˜²æ­¢XSSæ”»å‡»ã€‚</p>
</li>
<li><p><code>secure</code>å±æ€§æ˜¯é˜²æ­¢ä¿¡æ¯åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­è¢«ç›‘å¬æ•è·åä¿¡æ¯æ³„æ¼ï¼Œ<code>HttpOnly</code>å±æ€§çš„ç›®çš„æ˜¯é˜²æ­¢ç¨‹åºè·å–cookieåè¿›è¡Œæ”»å‡»ã€‚</p>
</li>
</ul>
<p><strong> å‚è€ƒæ›´å¤š </strong></p>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/Cookie" target="_blank" rel="external">ä¸­æ–‡ç»´åŸº - Cookie</a></li>
<li><a href="https://en.wikipedia.org/wiki/HTTP_cookie#Session_management" target="_blank" rel="external">è‹±æ–‡ç»´åŸº - Http-Cookie</a></li>
</ul>
<h2 id="client__u7AEF_u8BBE_u7F6Ecookie"><a href="#client__u7AEF_u8BBE_u7F6Ecookie" class="headerlink" title="client ç«¯è®¾ç½®cookie"></a>client ç«¯è®¾ç½®cookie</h2><p>å®¢æˆ·ç«¯è®¾ç½®cookie,å¾ˆç®€å•<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client  set cookie</span></span><br><span class="line">cookie := http.Cookie&#123;Name: <span class="string">"clientcookieid"</span>, Value: <span class="string">"121"</span>, Expires: time.Now().Add(<span class="number">111</span> * time.Second)&#125;</span><br><span class="line">req.AddCookie(&amp;cookie)</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">req.AddCookie(&amp;http.Cookie&#123;</span><br><span class="line">	Name:    <span class="string">"clientcookieid2"</span>,</span><br><span class="line">	Value:   <span class="string">"id2"</span>,</span><br><span class="line">	Expires: time.Now().Add(<span class="number">111</span> * time.Second),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="server_u7AEF_u63A5_u6536cookie"><a href="#server_u7AEF_u63A5_u6536cookie" class="headerlink" title="serverç«¯æ¥æ”¶cookie"></a>serverç«¯æ¥æ”¶cookie</h2><p>åç«¯æ¥æ”¶cookieæœ‰ä¸¤ç§æ–¹å¼,å¦‚æœæ˜¯æŒ‡å®šcookieçš„åå­—ï¼Œåªè¦å–å¾—1ä¸ªæˆ–å°‘æ•°å‡ ä¸ªcookie, å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼è·å–<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client_cookie, _ := r.Cookie(<span class="string">"clientcookieid"</span>)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"%+v\n"</span>, client_cookie)</span><br><span class="line">fmt.Println(client_cookie.Name, clinet_cookie.Value) <span class="comment">// é€šè¿‡ç‚¹è¿ç®—ç¬¦è·å–client_cookieçš„å±æ€§</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæŒ‡å®šäº†å¤šä¸ªcookieå€¼å¯¹ï¼Œåˆ™å¯ä»¥é€šè¿‡è¿­ä»£çš„æ–¹å¼è®¿é—®<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> r.Cookies() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"%+v\n"</span>, v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="server_u7AEF_u8BBE_u7F6Ecookie"><a href="#server_u7AEF_u8BBE_u7F6Ecookie" class="headerlink" title="serverç«¯è®¾ç½®cookie"></a>serverç«¯è®¾ç½®cookie</h2><p>serverç«¯è®¾ç½®cookie å’Œclientç«¯è®¾ç½®cookieç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ serverç«¯ç”¨çš„æ˜¯<code>http.SetCookie</code>, è€Œclientç«¯ç”¨çš„æ˜¯<code>req.AddCookie</code><br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http.SetCookie(w, &amp;http.Cookie&#123;</span><br><span class="line">	Name:    <span class="string">"servercookie"</span>,</span><br><span class="line">	Value:   <span class="string">"servercookievalue"</span>,</span><br><span class="line">	Expires: time.Now().Add(<span class="number">111</span> * time.Second),</span><br><span class="line">&#125;)</span><br><span class="line">http.SetCookie(w, &amp;http.Cookie&#123;</span><br><span class="line">	Name:    <span class="string">"servercookie2"</span>,</span><br><span class="line">	Value:   <span class="string">"servercookievalue2"</span>,</span><br><span class="line">	Expires: time.Now().Add(<span class="number">111</span> * time.Second),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="client__u7AEF_u63A5_u6536cookie"><a href="#client__u7AEF_u63A5_u6536cookie" class="headerlink" title="client ç«¯æ¥æ”¶cookie"></a>client ç«¯æ¥æ”¶cookie</h2><p>golang clientç«¯æ¥æ”¶cookie åªèƒ½é€šè¿‡è¿­ä»£çš„æ–¹å¼è·å–<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> resp.Cookies() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"%+v\n"</span>, v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/researchlab/golearning/tree/master/setcookie" target="_blank" rel="external">å®Œæ•´ç¤ºä¾‹ä»£ç </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Go&lt;/code&gt;webå¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦è®¾ç½®è·å–cookies, ä¸ç®¡æ˜¯ä»clientç«¯è®¾ç½®è·å–è¿˜æ˜¯serverè®¾ç½®è·å–ï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼Œä¸‹é¢å°±æ€»ç»“ä¸€ä¸‹å¸¸ç”¨çš„æ–¹æ³•ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
      <category term="net/http" scheme="http://www.grdtechs.com/tags/net-http/"/>
    
      <category term="setcookie" scheme="http://www.grdtechs.com/tags/setcookie/"/>
    
  </entry>
  
  <entry>
    <title>html ç¾åŒ–è¾“å‡º json å­—ç¬¦ä¸²</title>
    <link href="http://www.grdtechs.com/2016/06/17/jsonfmt/"/>
    <id>http://www.grdtechs.com/2016/06/17/jsonfmt/</id>
    <published>2016-06-17T10:55:21.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>json</code>å­—ç¬¦ä¸²åœ¨htmlç”¨jsç¾åŒ–è¾“å‡ºä½¿ç”¨æ€»ç»“ã€‚<br><a id="more"></a></p>
<h2 id="JSON-stringify_28_29_u51FD_u6570_u539F_u578B"><a href="#JSON-stringify_28_29_u51FD_u6570_u539F_u578B" class="headerlink" title="JSON.stringify()å‡½æ•°åŸå‹"></a>JSON.stringify()å‡½æ•°åŸå‹</h2><p><strong>è¯­æ³•ï¼š</strong><br>ã€€ã€€<code>JSON.stringify(value [, replacer] [, space])</code></p>
<p><code>value</code>ï¼šæ˜¯å¿…é€‰å­—æ®µã€‚å°±æ˜¯ä½ è¾“å…¥çš„å¯¹è±¡ï¼Œæ¯”å¦‚æ•°ç»„ï¼Œç±»ç­‰ã€‚<br><code>replacer</code>ï¼šè¿™ä¸ªæ˜¯å¯é€‰çš„ã€‚å®ƒåˆåˆ†ä¸º2ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æ•°ç»„ï¼Œç¬¬äºŒç§æ˜¯æ–¹æ³•ã€‚<br>ã€€ã€€æƒ…å†µä¸€ï¼š<code>replacer</code>ä¸ºæ•°ç»„æ—¶ï¼Œé€šè¿‡åé¢çš„å®éªŒå¯ä»¥çŸ¥é“ï¼Œå®ƒæ˜¯å’Œç¬¬ä¸€ä¸ªå‚æ•°<code>value</code>æœ‰å…³ç³»çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç³»åˆ—åŒ–åçš„ç»“æœæ˜¯é€šè¿‡é”®å€¼å¯¹æ¥è¿›è¡Œè¡¨ç¤ºçš„ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°çš„å€¼åœ¨ç¬¬ä¸€ä¸ªå­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä»¥ç¬¬äºŒä¸ªå‚æ•°çš„å€¼åš<code>key</code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ä¸º<code>value</code>è¿›è¡Œè¡¨ç¤ºï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±å¿½ç•¥ã€‚</p>
<p>ã€€ã€€æƒ…å†µäºŒï¼š<code>replacer</code>ä¸ºæ–¹æ³•æ—¶ï¼Œé‚£å¾ˆç®€å•ï¼Œå°±æ˜¯è¯´æŠŠç³»åˆ—åŒ–åçš„æ¯ä¸€ä¸ªå¯¹è±¡ï¼ˆè®°ä½æ˜¯æ¯ä¸€ä¸ªï¼‰ä¼ è¿›æ–¹æ³•é‡Œé¢è¿›è¡Œå¤„ç†ã€‚ </p>
<p><code>space</code>ï¼šå°±æ˜¯ç”¨ä»€ä¹ˆæ¥åšåˆ†éš”ç¬¦çš„ã€‚<br>ã€€ã€€1ï¼‰å¦‚æœçœç•¥çš„è¯ï¼Œé‚£ä¹ˆæ˜¾ç¤ºå‡ºæ¥çš„å€¼å°±æ²¡æœ‰åˆ†éš”ç¬¦ï¼Œç›´æ¥è¾“å‡ºæ¥ ã€‚<br>ã€€ã€€2ï¼‰å¦‚æœæ˜¯ä¸€ä¸ªæ•°å­—çš„è¯ï¼Œé‚£ä¹ˆå®ƒå°±å®šä¹‰ç¼©è¿›å‡ ä¸ªå­—ç¬¦ï¼Œå½“ç„¶å¦‚æœå¤§äº10 ï¼Œåˆ™é»˜è®¤ä¸º10ï¼Œå› ä¸ºæœ€å¤§å€¼ä¸º10ã€‚<br>ã€€ã€€3ï¼‰å¦‚æœæ˜¯ä¸€äº›è½¬ä¹‰å­—ç¬¦ï¼Œæ¯”å¦‚<code>\t</code>ï¼Œè¡¨ç¤ºå›è½¦ï¼Œé‚£ä¹ˆå®ƒæ¯è¡Œä¸€ä¸ªå›è½¦ã€‚<br>ã€€ã€€4ï¼‰å¦‚æœä»…ä»…æ˜¯å­—ç¬¦ä¸²ï¼Œå°±åœ¨æ¯è¡Œè¾“å‡ºå€¼çš„æ—¶å€™æŠŠè¿™äº›å­—ç¬¦ä¸²é™„åŠ ä¸Šå»ã€‚å½“ç„¶ï¼Œæœ€å¤§é•¿åº¦ä¹Ÿæ˜¯10ä¸ªå­—ç¬¦ã€‚ </p>
<h2 id="JSON-stringify_28_29__u5B9E_u4F8B"><a href="#JSON-stringify_28_29__u5B9E_u4F8B" class="headerlink" title="JSON.stringify() å®ä¾‹"></a>JSON.stringify() å®ä¾‹</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>htmlç¾åŒ–è¾“å‡ºjsonå­—ç¬¦ä¸²<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">'text/css'</span>&gt;</span><span class="css"></span><br><span class="line"><span class="tag">pre</span> <span class="rules">&#123;<span class="rule"><span class="attribute">outline</span>:<span class="value"> <span class="number">1px</span> solid <span class="hexcolor">#ccc</span></span></span>; <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">5px</span></span></span>; <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">5px</span></span></span>; &#125;</span></span><br><span class="line"><span class="class">.string</span> <span class="rules">&#123; <span class="rule"><span class="attribute">color</span>:<span class="value"> green</span></span>; &#125;</span></span><br><span class="line"><span class="class">.number</span> <span class="rules">&#123; <span class="rule"><span class="attribute">color</span>:<span class="value"> darkorange</span></span>; &#125;</span></span><br><span class="line"><span class="class">.boolean</span> <span class="rules">&#123; <span class="rule"><span class="attribute">color</span>:<span class="value"> blue</span></span>; &#125;</span></span><br><span class="line"><span class="class">.null</span> <span class="rules">&#123; <span class="rule"><span class="attribute">color</span>:<span class="value"> magenta</span></span>; &#125;</span></span><br><span class="line"><span class="class">.key</span> <span class="rules">&#123; <span class="rule"><span class="attribute">color</span>:<span class="value"> red</span></span>; &#125;</span></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">pre</span> <span class="attribute">id</span>=<span class="value">"output"</span>&gt;</span><span class="tag">&lt;/<span class="title">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">pre</span> <span class="attribute">id</span>=<span class="value">"output2"</span>&gt;</span><span class="tag">&lt;/<span class="title">pre</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;a:<span class="number">1</span>, <span class="string">'b'</span>:<span class="string">'foo'</span>, c:[<span class="literal">false</span>,<span class="literal">null</span>, &#123;d:&#123;e:<span class="number">1.3e5</span>&#125;&#125;]&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æœ€ç®€å•çš„è¾“å‡º</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="built_in">JSON</span>.stringify(obj, <span class="literal">undefined</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'output'</span>).innerHTML = str;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å¸¦é«˜äº®çš„è¾“å‡º</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">highLight</span>(<span class="params">json</span>)</span>&#123;</span><br><span class="line">			 json = json.replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>).replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>).replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>);</span><br><span class="line">			  <span class="keyword">return</span> json.replace(<span class="regexp">/("(\\u[a-zA-Z0-9]&#123;4&#125;|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">match</span>) </span>&#123;</span><br><span class="line">				     <span class="keyword">var</span> cls = <span class="string">'number'</span>;</span><br><span class="line">				     <span class="keyword">if</span> (<span class="regexp">/^"/</span>.test(match)) &#123;</span><br><span class="line">				         <span class="keyword">if</span> (<span class="regexp">/:$/</span>.test(match)) &#123;</span><br><span class="line">				             cls = <span class="string">'key'</span>;</span><br><span class="line">				         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				             cls = <span class="string">'string'</span>;</span><br><span class="line">				         &#125;</span><br><span class="line">				     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/true|false/</span>.test(match)) &#123;</span><br><span class="line">				         cls = <span class="string">'boolean'</span>;</span><br><span class="line">				     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/null/</span>.test(match)) &#123;</span><br><span class="line">				         cls = <span class="string">'null'</span>;</span><br><span class="line">				     &#125;</span><br><span class="line">				     <span class="keyword">return</span> <span class="string">'&lt;span class="'</span> + cls + <span class="string">'"&gt;'</span> + match + <span class="string">'&lt;/span&gt;'</span>;</span><br><span class="line">				 &#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> person = &#123;</span><br><span class="line">			 name: <span class="string">"Hello Kitty"</span>,</span><br><span class="line">			 sex: <span class="string">"ç”·"</span>,</span><br><span class="line">			 age: <span class="number">20</span>,</span><br><span class="line">			 child: [</span><br><span class="line">			 	&#123;</span><br><span class="line">			 		name: <span class="string">"Hello"</span>,</span><br><span class="line">					sex: <span class="string">"ç”·"</span>,</span><br><span class="line">					age: <span class="number">10</span>,</span><br><span class="line">					toy:[<span class="string">'a'</span>,<span class="string">'b'</span>]</span><br><span class="line">			 	&#125;,</span><br><span class="line">			 	&#123;</span><br><span class="line">			 		name: <span class="string">"Kitty"</span>,</span><br><span class="line">					sex: <span class="string">"å¥³"</span>,</span><br><span class="line">					age: <span class="number">8</span>,</span><br><span class="line">					toy:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">			 	&#125;</span><br><span class="line">			 ]</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> str = <span class="built_in">JSON</span>.stringify(person, <span class="literal">undefined</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="comment">//document.getElementById('output2').innerHTML = syntaxHighlight(str);</span></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'output2'</span>).innerHTML = highLight(str);</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ç¤ºä¾‹çš„æ•ˆæœå¦‚å›¾:</p>
<center><img src="/imgs/jsonfmt.png" alt="jsonformat"></center>

<p><a href="https://github.com/researchlab/CodeSnippets/blob/master/json.html" target="_blank" rel="external">è¯¦è§githubç¤ºä¾‹ä»£ç </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;&lt;code&gt;json&lt;/code&gt;å­—ç¬¦ä¸²åœ¨htmlç”¨jsç¾åŒ–è¾“å‡ºä½¿ç”¨æ€»ç»“ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="javascript" scheme="http://www.grdtechs.com/categories/javascript/"/>
    
    
      <category term="html" scheme="http://www.grdtechs.com/tags/html/"/>
    
      <category term="json" scheme="http://www.grdtechs.com/tags/json/"/>
    
  </entry>
  
  <entry>
    <title>golang æ ¼å¼åŒ–æ—¶é—´æ€»ç»“</title>
    <link href="http://www.grdtechs.com/2016/06/14/go-time-summary/"/>
    <id>http://www.grdtechs.com/2016/06/14/go-time-summary/</id>
    <published>2016-06-14T14:05:28.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>golang</code> ä¸­ç»å¸¸éœ€è¦æ ¼å¼åŒ–æ—¶é—´å’Œæ—¥æœŸæ¥æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚,ä¸‹é¢æ€»ç»“æ ¼å¼åŒ–æ—¶é—´æ—¥æœŸä¸­é‡åˆ°çš„é—®é¢˜ã€‚<br><a id="more"></a></p>
<h2 id="golang_time_u5305__u65F6_u95F4_u65E5_u671F_u683C_u5F0F_u5316_u5B9A_u4E49"><a href="#golang_time_u5305__u65F6_u95F4_u65E5_u671F_u683C_u5F0F_u5316_u5B9A_u4E49" class="headerlink" title="golang timeåŒ… æ—¶é—´æ—¥æœŸæ ¼å¼åŒ–å®šä¹‰"></a>golang timeåŒ… æ—¶é—´æ—¥æœŸæ ¼å¼åŒ–å®šä¹‰</h2><p>go çš„time package æä¾›äº†time.Formatå‡½æ•°ï¼Œç”¨æ¥å¯¹æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–è¾“å‡º;ç±»ä¼¼çš„è¿˜æœ‰time.Parseç”¨æ¥è§£æå­—ç¬¦ä¸²ç±»å‹çš„æ—¶é—´åˆ°time.Timeã€‚è¿™æ˜¯ä¸¤ä¸ªäº’é€†çš„å‡½æ•°ã€‚</p>
<p><strong> ä¸‹é¢çœ‹<code>golang</code>ä¸­<code>time</code>åŒ…å¯¹äºæ—¶é—´çš„è¯¦ç»†å®šä¹‰ </strong></p>
<ul>
<li>æœˆä»½ 1,01,Jan,January</li>
<li>æ—¥ã€€ 2,02,_2</li>
<li>æ—¶ã€€ 3,03,15,PM,pm,AM,am</li>
<li>åˆ†ã€€ 4,04</li>
<li>ç§’ã€€ 5,05</li>
<li>å¹´ã€€ 06,2006</li>
<li>æ—¶åŒº -07,-0700,Z0700,Z07:00,-07:00,MST</li>
<li>å‘¨å‡  Mon,Monday</li>
</ul>
<p><strong> æ¯”å¦‚å°æ—¶çš„è¡¨ç¤º(åŸå®šä¹‰æ˜¯ä¸‹åˆ3æ—¶ï¼Œä¹Ÿå°±æ˜¯15æ—¶) </strong></p>
<ul>
<li>3 ç”¨12å°æ—¶åˆ¶è¡¨ç¤ºï¼Œå»æ‰å‰å¯¼0</li>
<li>03 ç”¨12å°æ—¶åˆ¶è¡¨ç¤ºï¼Œä¿ç•™å‰å¯¼0</li>
<li>15 ç”¨24å°æ—¶åˆ¶è¡¨ç¤ºï¼Œä¿ç•™å‰å¯¼0</li>
<li>03pm ç”¨24å°æ—¶åˆ¶am/pmè¡¨ç¤ºä¸Šä¸‹åˆè¡¨ç¤ºï¼Œä¿ç•™å‰å¯¼0</li>
<li>3pm ç”¨24å°æ—¶åˆ¶am/pmè¡¨ç¤ºä¸Šä¸‹åˆè¡¨ç¤ºï¼Œå»æ‰å‰å¯¼0</li>
</ul>
<p><strong> åˆæ¯”å¦‚æœˆä»½ </strong></p>
<ul>
<li>1 æ•°å­—è¡¨ç¤ºæœˆä»½ï¼Œå»æ‰å‰å¯¼0</li>
<li>01 æ•°å­—è¡¨ç¤ºæœˆä»½ï¼Œä¿ç•™å‰å¯¼0</li>
<li>Jan ç¼©å†™å•è¯è¡¨ç¤ºæœˆä»½</li>
<li>January å…¨å•è¯è¡¨ç¤ºæœˆä»½</li>
</ul>
<h2 id="u65F6_u95F4_u65E5_u671F_u683C_u5F0F_u5316"><a href="#u65F6_u95F4_u65E5_u671F_u683C_u5F0F_u5316" class="headerlink" title="æ—¶é—´æ—¥æœŸæ ¼å¼åŒ–"></a>æ—¶é—´æ—¥æœŸæ ¼å¼åŒ–</h2><ul>
<li>æœ¬åœ°å½“æœŸæ—¶é—´</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(time.Now()) <span class="comment">//2016-07-14 14:27:28.214512532 +0800 CST</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´æ ¼å¼åŒ–</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(time.Now().Format(<span class="string">"3:04:05.000 PM Mon Jan"</span>))            <span class="comment">// 2:27:05.702 PM Thu Jul</span></span><br><span class="line">fmt.Println(time.Now().Format(<span class="string">"2006-01-_2 3:04:05.000 PM Mon Jan"</span>)) <span class="comment">// 2016-07-14 2:54:11.442 PM Thu Jul</span></span><br><span class="line">fmt.Println(time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>))  <span class="comment">// 2016-07-14 14:54:11.442239513 +0800 CST</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æœ¬åœ°å½“å‰æ—¶é—´æˆ³(10ä½)</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(time.Now().Unix()) <span class="comment">//1468479251</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æœ¬åœ°å½“å‰æ—¶é—´æˆ³(19ä½)</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(time.Now().UnixNano()) <span class="comment">//1468480006774460462</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´æˆ³è½¬æ—¶é—´ </li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(time.Unix(<span class="number">1389058332</span>, <span class="number">0</span>).Format(<span class="string">"2006-01-02 15:04:05"</span>)) <span class="comment">//2014-01-07 09:32:12</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´è½¬æ—¶é—´æˆ³</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(time.Date(<span class="number">2014</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">50</span>, <span class="number">4</span>, <span class="number">0</span>, time.Local).Unix())</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´è½¬æ¢ä¸ºUTCæ—¶é—´å’Œæœ¬åœ°æ—¶é—´( UTC:é›¶æ—¶åŒº +0000ï¼Œ China: ä¸œå…«åŒº +0800)</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">dateStr := <span class="string">"2016-07-14 14:24:51"</span> </span><br><span class="line">timestamp1, _ := time.Parse(<span class="string">"2006-01-02 15:04:05"</span>, dateStr)</span><br><span class="line">timestamp2, _ := time.ParseInLocation(<span class="string">"2006-01-02 15:04:05"</span>, dateStr, time.Local)</span><br><span class="line">fmt.Println(timestamp1, timestamp2)               <span class="comment">//2016-07-14 14:24:51 +0000 UTC 2016-07-14 14:24:51 +0800 CST </span></span><br><span class="line">fmt.Println(timestamp1.Unix(), timestamp2.Unix()) <span class="comment">//1468506291 1468477491 </span></span><br><span class="line"></span><br><span class="line">now := time.Now()                </span><br><span class="line">year, mon, day := now.UTC().Date()</span><br><span class="line">hour, min, sec := now.UTC().Clock()</span><br><span class="line">zone, _ := now.UTC().Zone()     </span><br><span class="line">fmt.Printf(<span class="string">"UTC æ—¶é—´æ˜¯ %d-%d-%d %02d:%02d:%02d %s\n"</span>,         </span><br><span class="line">    year, mon, day, hour, min, sec, zone) <span class="comment">// UTC æ—¶é—´æ˜¯ 2016-7-14 07:06:46 UTC</span></span><br><span class="line">                                                           </span><br><span class="line">year, mon, day = now.Date()</span><br><span class="line">hour, min, sec = now.Clock()</span><br><span class="line">zone, _ = now.Zone()</span><br><span class="line">fmt.Printf(<span class="string">"æœ¬åœ°æ—¶é—´æ˜¯ %d-%d-%d %02d:%02d:%02d %s\n"</span>,</span><br><span class="line">    year, mon, day, hour, min, sec, zone) <span class="comment">// æœ¬åœ°æ—¶é—´æ˜¯ 2016-7-14 15:06:46 CST</span></span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;&lt;code&gt;golang&lt;/code&gt; ä¸­ç»å¸¸éœ€è¦æ ¼å¼åŒ–æ—¶é—´å’Œæ—¥æœŸæ¥æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚,ä¸‹é¢æ€»ç»“æ ¼å¼åŒ–æ—¶é—´æ—¥æœŸä¸­é‡åˆ°çš„é—®é¢˜ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
      <category term="time" scheme="http://www.grdtechs.com/tags/time/"/>
    
  </entry>
  
  <entry>
    <title>Go Vendoring Tools ä½¿ç”¨æ€»ç»“</title>
    <link href="http://www.grdtechs.com/2016/05/24/comparison-of-Go-Vendoring-Tools/"/>
    <id>http://www.grdtechs.com/2016/05/24/comparison-of-Go-Vendoring-Tools/</id>
    <published>2016-05-24T14:03:36.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>golang1.5ç‰ˆæœ¬å¼€å§‹æ”¯æŒç¬¬ä¸‰æ–¹åŒ…åˆ°ä¾èµ–ç®¡ç†,å½“å¤šä¸ªé¡¹ç›®åœ¨åŒä¸€ä¸ª<code>GOPATH</code>ä¸‹ï¼Œæ¯ä¸ªé¡¹ç›®åŒ…å«åˆ°ç¬¬ä¸‰æ–¹åŒ…é€šè¿‡<code>go get</code>å‘½ä»¤éƒ½ä¼š<code>get</code>åˆ°<code>GOPATH</code>ä¸‹åˆ°<code>src</code>ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯å„ä¸ªé¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™å°±å¯¼è‡´ç¬¬ä¸‰æ–¹åŒ…çš„ä¸åŒç‰ˆæœ¬ä¸èƒ½åŒæ—¶è¢«<code>GOPATH</code>ä¸‹åˆ°å¤šä¸ªé¡¹ç›®ä½¿ç”¨ï¼Œä»<code>golang</code>éœ€è¦è®¾ç½®<code>GOPATH</code>æ¥çœ‹,<code>golang</code>å…¶å®æŠŠæ¯ä¸ªé¡¹ç›®å½“ä½œä¸€ä¸ªä¸ªç‹¬ç«‹çš„ç¬¬ä¸‰åŒ…æ¥çœ‹å¾…ã€‚<br><a id="more"></a><br>å…³äº<code>golang</code>åŒ…ç®¡ç†å·¥å…·çš„topic, åœ¨<code>golang</code>çš„å®˜æ–¹wikiè¦æœ‰ä¸€ç¯‡æ€»ç»“å¯¹æ¯”çš„æ–‡ç« :<a href="https://github.com/golang/go/wiki/PackageManagementTools" target="_blank" rel="external">PackageManagementTools</a>ã€‚ä¸‹é¢ä¸»è¦å°±é¡¹ç›®ä¸­ç”¨è¿‡çš„<code>godep</code>,<code>govendor</code>,<code>glide</code>åšä¸€ä¸ªç®€è¦çš„å¯¹æ¯”åˆ†æã€‚</p>
<h2 id="godep"><a href="#godep" class="headerlink" title="godep"></a>godep</h2><p><a href="https://github.com/tools/godep" target="_blank" rel="external">godep</a> helps build packages reproducibly by fixing their dependencies.</p>
<p><strong>å‰ç½®æ¡ä»¶</strong></p>
<ul>
<li>é¡¹ç›®å¤„åœ¨<code>GOPATH</code>ä¸‹</li>
<li>é¡¹ç›®èƒ½è¢«<code>go install</code>é€šè¿‡</li>
<li>é¡¹ç›®èƒ½è¢«<code>go test</code>é€šè¿‡</li>
</ul>
<p><strong>åŒ…åˆå§‹åŒ–ç®¡ç†</strong><br>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ<code>godep save</code>å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ godep save</span><br></pre></td></tr></table></figure></p>
<p>ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶å¤¹: </p>
<p><code>Godeps</code>ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">âœ  Godeps tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ Godeps.json</span><br><span class="line">â””â”€â”€ Readme</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> directories, <span class="number">2</span> files</span><br><span class="line">âœ  Godeps cat Godeps.json </span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"ImportPath"</span>: <span class="string">"yaml"</span>,</span><br><span class="line">	<span class="string">"GoVersion"</span>: <span class="string">"go1.6"</span>,</span><br><span class="line">	<span class="string">"GodepVersion"</span>: <span class="string">"v70"</span>,</span><br><span class="line">	<span class="string">"Packages"</span>: [</span><br><span class="line">		<span class="string">"./..."</span></span><br><span class="line">	],</span><br><span class="line">	<span class="string">"Deps"</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"ImportPath"</span>: <span class="string">"gopkg.in/yaml.v2"</span>,</span><br><span class="line">			<span class="string">"Rev"</span>: <span class="string">"a83829b6f1293c91addabc89d0571c246397bbf4"</span></span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>vendor</code>ç›®å½•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">âœ  vendor tree</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ gopkg.in</span><br><span class="line">    â””â”€â”€ yaml.v2</span><br><span class="line">        â”œâ”€â”€ apic.go</span><br><span class="line">        â”œâ”€â”€ decode.go</span><br><span class="line">        â”œâ”€â”€ emitterc.go</span><br><span class="line">        â”œâ”€â”€ encode.go</span><br><span class="line">        â”œâ”€â”€ LICENSE</span><br><span class="line">        â”œâ”€â”€ LICENSE.libyaml</span><br><span class="line">        â”œâ”€â”€ parserc.go</span><br><span class="line">        â”œâ”€â”€ readerc.go</span><br><span class="line">        â”œâ”€â”€ README.md</span><br><span class="line">        â”œâ”€â”€ resolve.go</span><br><span class="line">        â”œâ”€â”€ scannerc.go</span><br><span class="line">        â”œâ”€â”€ sorter.go</span><br><span class="line">        â”œâ”€â”€ writerc.go</span><br><span class="line">        â”œâ”€â”€ yaml.go</span><br><span class="line">        â”œâ”€â”€ yamlh.go</span><br><span class="line">        â””â”€â”€ yamlprivateh.go</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> directories, <span class="number">16</span> files</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>godep</code>æŠŠç¬¬ä¸‰åŒ…çš„ç‰ˆæœ¬ä¾èµ–ä¿¡æ¯è®°å½•åœ¨<code>Godeps.json</code>ä¸‹ï¼Œå¹¶ä¸”æŠŠç¬¬ä¸‰åŒ…å®Œæ•´æ‹·è´ä¸€ä»½åˆ°<code>vendor</code>ä¸‹é¢ã€‚é€šè¿‡å¯¹<code>Godeps.json</code>æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬ç®¡ç†å³å¯ä»¥ç®¡ç†æ•´ä¸ªé¡¹ç›®çš„ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–ä¿¡æ¯ã€‚</p>
<p><strong>æ·»åŠ æ–°åŒ…</strong><br>æ–¹æ³•ä¸€ï¼š</p>
<p>go get æŠŠæ–°å¢çš„ç¬¬ä¸‰æ–¹åŒ…getåˆ°<code>GOPATH</code>çš„<code>src</code>ç›®å½•ä¸‹ï¼Œç„¶åå†æ‰§è¡Œ<code>godep save</code></p>
<p>æ–¹æ³•äºŒï¼š</p>
<p>godep get <url> åŒæ ·æ˜¯æŠŠç¬¬ä¸‰æ–¹åŒ…getåˆ°<code>GOPATH</code>çš„<code>src</code>ä¸‹ï¼Œç„¶åå†æ‰§è¡Œ<code>godep save</code></url></p>
<p>å¯ä»¥çœ‹åˆ°<code>godep</code>åªæ˜¯æŠŠç¬¬ä¸‰æ–¹åŒ…è¿›è¡Œå•ç‹¬åˆ°ä¾èµ–ç®¡ç†ï¼Œè€Œæ–°å¢åˆ°ç¬¬ä¸‰åŒ…è¿˜æ˜¯ä¼šè¢«getåˆ°<code>GOPATH</code>ä¸­, å¦‚æœå¤šä¸ªé¡¹ç›®ç”¨åŒä¸€ä¸ªç¬¬ä¸‰åŒ…çš„ä¸åŒç‰ˆæœ¬æ—¶ï¼Œæ˜¾ç„¶ä¸èƒ½æ»¡è¶³ã€‚</p>
<p><strong>æ›´æ–°åŒ…</strong><br><code>godep</code>é€šè¿‡<code>godep update</code> æ›´æ–°åˆ¶å®šçš„ç¬¬ä¸‰åŒ…ä»¥åŠ<code>golang</code>çš„ç‰ˆæœ¬ã€‚</p>
<h2 id="govendor"><a href="#govendor" class="headerlink" title="govendor"></a>govendor</h2><p><a href="https://github.com/kardianos/govendor" target="_blank" rel="external">govendor</a> Uses the go1.5+ vendor folder. Multiple workflows supported, single tool.</p>
<p><strong>Quick Start</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Setup your project.</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"my project in GOPATH"</span></span><br><span class="line">govendor init</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add existing GOPATH files to vendor.</span></span><br><span class="line">govendor add +external</span><br><span class="line"></span><br><span class="line"><span class="comment"># View your work.</span></span><br><span class="line">govendor list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Look at what is using a package</span></span><br><span class="line">govendor list -v fmt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify a specific version or revision to fetch</span></span><br><span class="line">govendor fetch golang.org/x/net/context@a4bbce9fcae005b22ae5443f6af064d80a6f5a55</span><br><span class="line">govendor fetch golang.org/x/net/context@v1   <span class="comment"># Get latest v1.*.* tag or branch.</span></span><br><span class="line">govendor fetch golang.org/x/net/context@=v1  <span class="comment"># Get the tag or branch named "v1".</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Update a package to latest, given any prior version constraint</span></span><br><span class="line">govendor fetch golang.org/x/net/context</span><br></pre></td></tr></table></figure>
<p><strong>Sub-commands</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">init     Create the <span class="string">"vendor"</span> folder and the <span class="string">"vendor.json"</span> file.</span><br><span class="line">    list     List and filter existing dependencies and packages.</span><br><span class="line">    add      Add packages from <span class="variable">$GOPATH</span>.</span><br><span class="line">    update   Update packages from <span class="variable">$GOPATH</span>.</span><br><span class="line">    remove   Remove packages from the vendor folder.</span><br><span class="line">    status   Lists any packages missing, out-of-date, or modified locally.</span><br><span class="line">    fetch    Add new or update vendor folder packages from remote repository.</span><br><span class="line">    sync     Pull packages into vendor folder from remote repository with revisions</span><br><span class="line">                 from vendor.json file.</span><br><span class="line">    migrate  Move packages from a legacy tool to the vendor folder with metadata.</span><br><span class="line">    get      Like <span class="string">"go get"</span> but copies dependencies into a <span class="string">"vendor"</span> folder.</span><br><span class="line">    license  List discovered licenses <span class="keyword">for</span> the given status or import paths.</span><br><span class="line">    shell    Run a <span class="string">"shell"</span> to make multiple sub-commands more efficent <span class="keyword">for</span> large</span><br><span class="line">                 projects.</span><br><span class="line"></span><br><span class="line">    go tool commands that are wrapped:</span><br><span class="line">      `+&lt;status&gt;` package selection may be used with them</span><br><span class="line">    fmt, build, install, clean, <span class="built_in">test</span>, vet, generate</span><br></pre></td></tr></table></figure>
<p><strong>Status</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+<span class="built_in">local</span>    (l) packages <span class="keyword">in</span> your project</span><br><span class="line">    +external (e) referenced packages <span class="keyword">in</span> GOPATH but not <span class="keyword">in</span> current project</span><br><span class="line">    +vendor   (v) packages <span class="keyword">in</span> the vendor folder</span><br><span class="line">    +std      (s) packages <span class="keyword">in</span> the standard library</span><br><span class="line"></span><br><span class="line">    +unused   (u) packages <span class="keyword">in</span> the vendor folder, but unused</span><br><span class="line">    +missing  (m) referenced packages but not found</span><br><span class="line"></span><br><span class="line">    +program  (p) package is a main package</span><br><span class="line"></span><br><span class="line">    +outside  +external +missing</span><br><span class="line">    +all      +all packages</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>govendor init</code>ä¹‹åä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>vendor</code>æ–‡ä»¶å¤¹ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">âœ  yaml tree <span class="operator">-d</span></span><br><span class="line">.</span><br><span class="line">â””â”€â”€ vendor</span><br><span class="line">    â”œâ”€â”€ github.com</span><br><span class="line">    â”‚Â Â  â””â”€â”€ cihub</span><br><span class="line">    â”‚Â Â      â””â”€â”€ seelog</span><br><span class="line">    â””â”€â”€ gopkg.in</span><br><span class="line">        â””â”€â”€ yaml.v2</span><br><span class="line"></span><br><span class="line"><span class="number">6</span> directories</span><br><span class="line">âœ  yaml cat vendor/vendor.json </span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"comment"</span>: <span class="string">""</span>,</span><br><span class="line">	<span class="string">"ignore"</span>: <span class="string">"test"</span>,</span><br><span class="line">	<span class="string">"package"</span>: [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"checksumSHA1"</span>: <span class="string">"Nc93Ubautl47L3RP6x4lTY+ud68="</span>,</span><br><span class="line">			<span class="string">"path"</span>: <span class="string">"github.com/cihub/seelog"</span>,</span><br><span class="line">			<span class="string">"revision"</span>: <span class="string">"cedd97ac8c6c2ec413a97864185f9510fb1775cc"</span>,</span><br><span class="line">			<span class="string">"revisionTime"</span>: <span class="string">"2016-05-20T13:10:56Z"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"checksumSHA1"</span>: <span class="string">"+OgOXBoiQ+X+C2dsAeiOHwBIEH0="</span>,</span><br><span class="line">			<span class="string">"path"</span>: <span class="string">"gopkg.in/yaml.v2"</span>,</span><br><span class="line">			<span class="string">"revision"</span>: <span class="string">"a83829b6f1293c91addabc89d0571c246397bbf4"</span>,</span><br><span class="line">			<span class="string">"revisionTime"</span>: <span class="string">"2016-03-01T20:40:22Z"</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">"rootPath"</span>: <span class="string">"yaml"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨<code>govendor fetch &lt;url1&gt; &lt;url2&gt;</code>æ–°å¢çš„ç¬¬ä¸‰æ–¹åŒ…ç›´æ¥è¢«getåˆ°æ ¹ç›®å½•çš„<code>vendor</code>æ–‡ä»¶å¤¹ä¸‹,ä¸ä¼šä¸å…¶å®ƒçš„é¡¹ç›®æ··ç”¨ç¬¬ä¸‰æ–¹åŒ…ï¼Œå®Œç¾é¿å…å¤šä¸ªé¡¹ç›®åŒç”¨åŒä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ…çš„ä¸åŒç‰ˆæœ¬é—®é¢˜ã€‚</p>
<p>åªéœ€è¦å¯¹<code>vendor/vendor.json</code>è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå³å¯å¯¹ç¬¬ä¸‰åŒ…ä¾èµ–å…³ç³»è¿›è¡Œæ§åˆ¶ã€‚</p>
<h2 id="glide"><a href="#glide" class="headerlink" title="glide"></a>glide</h2><p><a href="https://github.com/Masterminds/glide" target="_blank" rel="external">Glide</a> Vendor Package Management for Golang.</p>
<p><strong>Usage</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">âœ  yaml glide --help</span><br><span class="line">USAGE:</span><br><span class="line">   glide [global options] <span class="built_in">command</span> [<span class="built_in">command</span> options] [arguments...]</span><br><span class="line"></span><br><span class="line">	create, init	Initialize a new project, creating a glide.yaml file</span><br><span class="line">    get			Install one or more packages into `vendor/` and add dependency to glide.yaml.</span><br><span class="line">    remove, rm		Remove a package from the glide.yaml file, and regenerate the lock file.</span><br><span class="line">    import		Import files from other dependency management systems.</span><br><span class="line">    name		Print the name of this project.</span><br><span class="line">    novendor, nv	List all non-vendor paths <span class="keyword">in</span> a directory.</span><br><span class="line">    rebuild		Rebuild (<span class="string">'go build'</span>) the dependencies</span><br><span class="line">    install, i		Install a project<span class="string">'s dependencies</span><br><span class="line">    update, up		Update a project'</span>s dependencies</span><br><span class="line">    tree		Tree prints the dependencies of this project as a tree.</span><br><span class="line">    list		List prints all dependencies that the present code references.</span><br><span class="line">    info		Info prints information about this project</span><br><span class="line">    about		Learn about Glide</span><br><span class="line"></span><br><span class="line">GLOBAL OPTIONS:</span><br><span class="line">   --yaml, -y <span class="string">"glide.yaml"</span>	Set a YAML configuration file.</span><br><span class="line">   --quiet, -q			Quiet (no info or debug messages)</span><br><span class="line">   --debug			Print Debug messages (verbose)</span><br><span class="line">   --home <span class="string">"/home/dev/.glide"</span>	The location of Glide files [<span class="variable">$GLIDE_HOME</span>]</span><br><span class="line">   --no-color			Turn off colored output <span class="keyword">for</span> <span class="built_in">log</span> messages</span><br><span class="line">   --help, -h			show <span class="built_in">help</span></span><br><span class="line">   --version, -v		<span class="built_in">print</span> the version</span><br></pre></td></tr></table></figure>
<p><code>glide</code>    é€šè¿‡<code>glide create</code>æˆ–<code>glide init</code>å‘½ä»¤åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†ï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>glide.yaml</code>ï¼Œè¿™ä¸ªæ–‡ä»¶è®°å½•ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ”¯æŒç¼–è¾‘ä¿®æ”¹ã€‚<br><code>glide</code>é€šè¿‡<code>glide install</code>, ä¼šæŠŠæ‰€æœ‰ç¼ºå°‘çš„ç¬¬ä¸‰æ–¹åŒ…éƒ½ä¸‹è½½åˆ°<code>vendor</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶ä¸”ä¼šåœ¨<code>glide.yaml</code>ä¸­æ·»åŠ æ‰€æœ‰ä¾èµ–çš„ç¬¬ä¸‰æ–¹åŒ…åç§°ï¼Œåœ¨<code>glide.lock</code>æ–‡ä»¶ä¸­è®°å½•å…·ä½“çš„ç‰ˆæœ¬ç®¡ç†ä¿¡æ¯ã€‚</p>
<p><strong>glide install</strong></p>
<p>When you want to install the specific versions from the glide.lock file use glide install.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ glide install</span><br></pre></td></tr></table></figure>
<p>This will read the <code>glide.lock</code> file and install the commit id specific versions there.</p>
<p>When the glide.lock file doesnâ€™t tie to the <code>glide.yaml</code> file, such as there being a change, it will provide a warning. Running glide up will recreate the <code>glide.lock</code> file when updating the dependency tree.</p>
<p>If no glide.lock file is present glide install will perform an update and generate a lock file.</p>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><code>godep</code>,<code>govendor</code>,<code>glide</code> éƒ½å¯ä»¥å¾ˆå¥½çš„è¿›è¡ŒåŒ…ç®¡ç†ã€‚<code>govendor</code>,<code>glide</code>æä¾›çš„å¯æ“ä½œå‘½ä»¤æ›´ä¸°å¯Œã€‚</li>
<li><code>godep</code> ä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆ<code>Godeps</code>å’Œ<code>vendor</code>ä¸¤ä¸ªæ–‡ä»¶å¤¹; <code>govendor</code>æŠŠæ‰€æœ‰ä¿¡æ¯éƒ½ç”Ÿæˆåœ¨<code>vendor</code>ç›®å½•ä¸‹; <code>glide</code> ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ<code>glide.yaml</code>, <code>glide.lock</code>æ–‡ä»¶åŠ<code>vendor</code>ç›®å½•; ä»<code>ç®€æ´åº¦</code>å’Œ<code>å°½é‡ä¸æ±¡æŸ“é¡¹ç›®</code>æ¥çœ‹ï¼Œ<code>govendor</code>æœ€ä¼˜ï¼Œ<code>glide</code>æ¬¡ä¹‹ã€‚</li>
<li><p><code>godep</code>, <code>govendor</code>, <code>glide</code> éƒ½æä¾›get ç¬¬ä¸‰æ–¹åŒ…çš„å‘½ä»¤ï¼Œä½†æ˜¯ <code>glide</code>çš„<code>glide install</code> æœ€ä¸ºæ–¹ä¾¿ï¼Œ å¹¶ä¸”ç›´æ¥æŠŠç¬¬ä¸‰æ–¹åŒ…getåˆ°æœ¬é¡¹ç›®çš„vendorç›®å½•ä¸‹ï¼Œå¹¶ä¸”<code>glide</code>æä¾›çš„<code>ä¾¿æ·</code>å‘½ä»¤ä¹Ÿä¸°å¯Œã€‚</p>
</li>
<li><p><strong> åœ¨ç”Ÿäº§é¡¹ç›®ä¸­æ¨èä½¿ç”¨<code>govendor</code>, æ›´ç®€æ´; åœ¨è¯•éªŒé¡¹ç›®ä¸­æ¨èè¯•ç”¨<code>glide</code>, æ›´æ–¹ä¾¿ã€‚</strong></p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;golang1.5ç‰ˆæœ¬å¼€å§‹æ”¯æŒç¬¬ä¸‰æ–¹åŒ…åˆ°ä¾èµ–ç®¡ç†,å½“å¤šä¸ªé¡¹ç›®åœ¨åŒä¸€ä¸ª&lt;code&gt;GOPATH&lt;/code&gt;ä¸‹ï¼Œæ¯ä¸ªé¡¹ç›®åŒ…å«åˆ°ç¬¬ä¸‰æ–¹åŒ…é€šè¿‡&lt;code&gt;go get&lt;/code&gt;å‘½ä»¤éƒ½ä¼š&lt;code&gt;get&lt;/code&gt;åˆ°&lt;code&gt;GOPATH&lt;/code&gt;ä¸‹åˆ°&lt;code&gt;src&lt;/code&gt;ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯å„ä¸ªé¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™å°±å¯¼è‡´ç¬¬ä¸‰æ–¹åŒ…çš„ä¸åŒç‰ˆæœ¬ä¸èƒ½åŒæ—¶è¢«&lt;code&gt;GOPATH&lt;/code&gt;ä¸‹åˆ°å¤šä¸ªé¡¹ç›®ä½¿ç”¨ï¼Œä»&lt;code&gt;golang&lt;/code&gt;éœ€è¦è®¾ç½®&lt;code&gt;GOPATH&lt;/code&gt;æ¥çœ‹,&lt;code&gt;golang&lt;/code&gt;å…¶å®æŠŠæ¯ä¸ªé¡¹ç›®å½“ä½œä¸€ä¸ªä¸ªç‹¬ç«‹çš„ç¬¬ä¸‰åŒ…æ¥çœ‹å¾…ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="glide" scheme="http://www.grdtechs.com/tags/glide/"/>
    
      <category term="godep" scheme="http://www.grdtechs.com/tags/godep/"/>
    
      <category term="govendor" scheme="http://www.grdtechs.com/tags/govendor/"/>
    
      <category term="vendoring" scheme="http://www.grdtechs.com/tags/vendoring/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Travis CIè‡ªåŠ¨æ„å»ºHexoé™æ€åšå®¢</title>
    <link href="http://www.grdtechs.com/2016/05/08/travis-ci-deploy-hexo-blog/"/>
    <id>http://www.grdtechs.com/2016/05/08/travis-ci-deploy-hexo-blog/</id>
    <published>2016-05-08T21:48:40.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç›®å‰ï¼Œè‡ªåŠ¨åŒ–æ„å»ºã€æŒç»­é›†æˆçš„ç†å¿µåœ¨æ•´ä¸ªè®¡ç®—è¡Œä¸šéå¸¸çš„æµè¡Œï¼Œå¤§å®¶æ›´æ„¿æ„å»ä½¿ç”¨è‡ªåŠ¨åŒ–ä»£æ›¿æ‰‹åŠ¨ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚<code>Travis CI</code>å°±æ˜¯ä¸€ä¸ªåœ¨çº¿çš„ã€åˆ†å¸ƒå¼çš„æŒç»­é›†æˆæœåŠ¡ï¼Œç”¨æ¥æ„å»ºåŠæµ‹è¯•åœ¨GitHubæ‰˜ç®¡çš„ä»£ç ã€‚åˆ©ç”¨Travis CI ä¼šåœ¨æ¯ä¸€æ¬¡pushåç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿæœºæ¥æ‰§è¡Œäº‹å…ˆå®‰æ’å¥½çš„è‡ªåŠ¨æ„å»ºä»»åŠ¡ï¼Œä»æ¥è¿›è¡Œå‘å¸ƒã€‚æœ¬æ–‡å°±è¦ç”¨<code>Travis CI</code>æ¥è‡ªåŠ¨æ„å»º<code>Hexo</code>åšå®¢ã€‚<br><a id="more"></a></p>
<h2 id="u5B89_u88C5Hexo"><a href="#u5B89_u88C5Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h2><ul>
<li>å®‰è£…cnpm</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šnpmå› ä¸ºqiangçš„åŸå› ï¼Œç»å¸¸ä¼šå‡ºé—®é¢˜ï¼Œæˆ‘æ¢æˆäº†taobaoçš„cmpné•œåƒï¼Œtaobaoçš„cnpmé•œåƒè¿™æ˜¯ä¸€ä¸ªå®Œæ•´ npmjs.org é•œåƒï¼Œä½ å¯ä»¥ç”¨æ­¤ä»£æ›¿å®˜æ–¹ç‰ˆæœ¬(åªè¯»)ï¼ŒåŒæ­¥é¢‘ç‡ç›®å‰ä¸º 10åˆ†é’Ÿ ä¸€æ¬¡ä»¥ä¿è¯å°½é‡ä¸å®˜æ–¹æœåŠ¡åŒæ­¥ã€‚</p>
</blockquote>
<p>å®‰è£…å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<ul>
<li>å®‰è£…Hexo</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install hexo-cli -g</span><br><span class="line">$ hexo init blog</span><br><span class="line">$ <span class="built_in">cd</span> blog</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨æœ¬åœ°çš„æœåŠ¡å™¨çœ‹ä¸‹æ˜¯å¦å®‰è£…æˆåŠŸ<code>hexo s</code>ï¼Œæµè§ˆå™¨æ‰“å¼€<a href="http://localhost:4000ã€‚" target="_blank" rel="external">http://localhost:4000ã€‚</a></p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒHexoå®‰è£…å®Œæ¯•ï¼Œå¦‚ä½•é…ç½®åŠå‘å¸ƒåˆ°<code>github</code>ä¸Šæ‰˜ç®¡ï¼Œè¯·å‚è€ƒ<a href="http://www.grdtechs.com/2016/01/15/hexo-blog-1/">ç”¨Hexo+githubæ­å»ºæœ¬ç«™</a>ã€‚æœ¬æ–‡é‡ç‚¹è®°å½•å¦‚ä½•ç”¨<code>Travis CI</code> è‡ªåŠ¨æ„å»º<code>Hexo</code>åšå®¢ã€‚</p>
<h2 id="u90E8_u7F72Travis_CI"><a href="#u90E8_u7F72Travis_CI" class="headerlink" title="éƒ¨ç½²Travis CI"></a>éƒ¨ç½²Travis CI</h2><p>ç›®å‰ï¼Œè‡ªåŠ¨åŒ–æ„å»ºã€æŒç»­é›†æˆçš„ç†å¿µåœ¨æ•´ä¸ªè®¡ç®—è¡Œä¸šéå¸¸çš„æµè¡Œï¼Œå¤§å®¶æ›´æ„¿æ„å»ä½¿ç”¨è‡ªåŠ¨åŒ–ä»£æ›¿æ‰‹åŠ¨ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p>
<ul>
<li>æŒç»­é›†æˆçš„æ¦‚å¿µ</li>
</ul>
<p>æŒç»­é›†æˆæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µã€‚åœ¨æŒç»­é›†æˆä¸­ï¼Œå›¢é˜Ÿæˆå‘˜é¢‘ç¹é›†æˆä»–ä»¬çš„å·¥ä½œæˆæœï¼Œæ¯äººæ¯å¤©å¯èƒ½é›†æˆä¸€æ¬¡ï¼Œç”šè‡³å¤šæ¬¡ã€‚æ¯æ¬¡é›†æˆä¼šç»è¿‡è‡ªåŠ¨æ„å»ºï¼ˆåŒ…æ‹¬è‡ªåŠ¨æµ‹è¯•ï¼‰çš„æ£€éªŒï¼Œä»¥å°½å¿«å‘ç°é›†æˆé”™è¯¯ã€‚è®¸å¤šå›¢é˜Ÿå‘ç°è¿™ç§æ–¹æ³•å¯ä»¥æ˜¾è‘—å‡å°‘é›†æˆå¼•èµ·çš„é—®é¢˜ï¼Œå¹¶å¯ä»¥åŠ å¿«å›¢é˜Ÿåˆä½œè½¯ä»¶å¼€å‘çš„é€Ÿåº¦ã€‚</p>
<p>è‡ªåŠ¨æ„å»ºå·¥å…·åˆ™æ˜¯æŒç»­é›†æˆçš„ä¸€ç§å‡ºè‰²å®è·µã€‚ä»£ç æäº¤åï¼Œç”±è½¯ä»¶è‡ªåŠ¨å®Œæˆä»£ç çš„æµ‹è¯•ã€æ„å»ºï¼Œå¹¶å°†è¿‡ç¨‹ä¸­çŠ¶æ€ä¸æ„å»ºç‰©äº§å‡ºæ‰æ˜¯æŒç»­é›†æˆçš„æ„ä¹‰ã€‚</p>
<ul>
<li>ä¸ºä»€ä¹ˆä½¿ç”¨</li>
</ul>
<p>Travis CIæœ¬èº«å·²ç»æ˜¯å¾ˆå¥½çš„è‡ªåŠ¨æ„å»ºçš„å·¥å…·ï¼Œè€Œè¿™é‡Œä½¿ç”¨çš„åŸå› ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºHexoæœ¬èº«å¹¶ä¸èƒ½è¿›è¡Œå¤šäººåˆä½œã€‚Hexoçš„hexo generateå’Œhexo deployä¼šè‡ªåŠ¨æ¸²æŸ“å¹¶æäº¤åˆ°GitHubä¸Šï¼Œæ‰€ä»¥å½“ä½ ä»åˆ«çš„ç”µè„‘ä¸Šcloneçš„æ—¶å€™ï¼Œcloneä¸‹æ¥çš„æ˜¯æ¸²æŸ“å¥½çš„htmlçš„æ–‡ç« ã€‚å°±ç®—æˆ‘åœ¨ä¸¤ä¸ªç”µè„‘ä¸ŠåŒæ—¶æ­å»ºäº†ç¯å¢ƒï¼Œä½†æ˜¯æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™åªä¼šæ¸²æŸ“æœ¬åœ°çš„markdownæ–‡ç« ï¼Œä¾ç„¶ä¸èƒ½è¿›è¡ŒåŒæ­¥ã€‚æœ‰äº›äººé€‰æ‹©äº†ä½¿ç”¨ç™¾åº¦äº‘è¿›è¡ŒåŒæ­¥ï¼Œæ¯æ¬¡å†™ä¹‹å‰ä¸‹è½½ä¸‹æ¥å¹¶è¦†ç›–ï¼Œå°±èƒ½è¿›è¡ŒåŒæ­¥ã€‚ä¸å¦è®¤ï¼Œè¿™ä¸ªæ–¹æ³•å¯¹äºä¸€ä¸ªäººå†™åšå®¢ï¼Œåœ¨å·¥ä½œå’Œå®¶çš„ç”µè„‘è¿˜ç®—æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œå› ä¸ºå§‹ç»ˆæ˜¯ä¸€ä¸ªäººè¿›è¡Œæ“ä½œã€‚è€Œæˆ‘ä»¬çš„åšå®¢æ˜¯å¤šäººå…±åŒå†™çš„ï¼Œæ‰€ä»¥è¯´ä¼šå­˜åœ¨å„ç§å†²çªé—®é¢˜ï¼Œäºæ˜¯æƒ³åˆ°äº†ç”¨Travis CIã€‚</p>
<center><img src="/imgs/travis-hexo-flowing.png" alt="travis-hexo-flowing"></center>

<p>ä»ä¸Šè¿°æµç¨‹ä¸­åˆ†æä¸‹æ€è·¯ï¼š<br>å‰æï¼šæˆ‘ä»¬åœ¨ä¹‹å‰åšå®¢æ­å»ºçš„repoä¸‹é¢ï¼Œæ–°å»ºä¸€ä¸ªblogçš„åˆ†æ”¯ï¼Œè¿™ä¸ªåˆ†æ”¯ç”¨æ¥è¿›è¡Œç¯å¢ƒä»£ç çš„å¤‡ä»½ï¼Œå¹¶ä¸”é…ç½®å‡º<code>.travis.yml</code>è¿›è¡Œè‡ªåŠ¨åŒ–æ„å»ºã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User - push -&gt; branch blog</span><br></pre></td></tr></table></figure>
<p>å°†ä»£ç pushåˆ°åœ¨GitHubä¸Šçš„åšå®¢ä¸­çš„blogåˆ†æ”¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dev repo - sync -&gt; Travis CI</span><br></pre></td></tr></table></figure>
<p>åœ¨branch blogä¸­é…ç½®<code>.travis.yml</code>æ–‡ä»¶ï¼Œåœ¨Travis CIä¸­å¼€å¯branch blogçš„åŒæ­¥å¼€å…³ï¼Œå¹¶å¯ç”¨<code>Build only if .travis.yml is present</code>é¡¹ï¼Œè¿™æ ·èƒ½åœ¨repoä¸­æœ‰å¤šä¸ªbranchæ—¶ï¼Œè®©Travis CIåªæ„å»ºæ”¾ç½®äº†<code>.travis.yml</code>æ–‡ä»¶çš„<code>branch</code>ã€‚</p>
<ul>
<li>Travis CI - build and push -&gt; Pages repo</li>
</ul>
<p><code>Travis CI</code> çš„è‡ªåŠ¨åŒ–æ„å»ºå®Œå…¨ä¾é å”¯ä¸€çš„<code>.travis.yml</code>è„šæœ¬æ–‡ä»¶ã€‚éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­æ·»åŠ æ„å»ºç¯å¢ƒã€æ„å»ºHexoã€ç”Ÿæˆåšå®¢åŠåç»­pushåˆ°Pages repoçš„å…¨éƒ¨è„šæœ¬ã€‚</p>
<ul>
<li>ç”ŸæˆSSH Key<br>è¦åšåˆ°<code>Travis CI</code>å‘<code>Pages repo</code>è‡ªåŠ¨æ¨é€å°±å¿…é¡»ç”¨åˆ°<code>Github SSH Key</code>ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å…å»Hexoéƒ¨ç½²æ—¶å€™è¾“å…¥å¯†ç çš„æ­¥éª¤ã€‚ç”ŸæˆSSH Keyçš„æ“ä½œå‚ç…§GitHubçš„å®˜ç½‘å³å¯ï¼š<a href="https://help.github.com/articles/generating-an-ssh-key/" target="_blank" rel="external">Github SSH Key</a>ã€‚<br>è¿™æ ·ä¼šå¾—åˆ°<code>id_rsa.pub</code>å’Œ<code>id_rsa</code>ä¸¤ä¸ªç§˜é’¥ï¼Œæˆ‘ä»¬å°†<code>id_rsa.pub</code>æ·»åŠ åˆ°äº†<code>github</code>ï¼Œä¸‹é¢è¦åŠ å¯†<code>id_rsa</code>è¿™ä¸ªç§é’¥å¹¶ä¸”ä¸Šä¼ åˆ°<code>Travis</code>ã€‚</li>
</ul>
<p><strong> æ³¨æ„ï¼š</strong> <font color="red">è¿™ä¸ªSSH keyä¸åº”è¯¥æ˜¯ä½ è´¦å·çš„å…¨å±€SSH Keyï¼Œè¿™æ ·Travis CIå°±è·å¾—äº†ä½ æ‰€æœ‰ä»£ç åº“çš„æäº¤æƒé™ã€‚ä»…ä»…åªéœ€è¦æŠŠSSH Keyæ·»åŠ åˆ°å½“å‰repoçš„settingä¸­çš„keyä¸‹é¢å³å¯ã€‚</font></p>
<p>å³å°†<code>id_rsa.pub</code>ç§˜é’¥æ·»åŠ åˆ°å½“å‰é¡¹ç›®<code>researchlab.github.io</code>ä¸‹<code>Settings</code>ä¸‹çš„<code>Deploy keys</code>ä¸­ï¼Œå¦‚å›¾:</p>
<center><img src="/imgs/deploy_keys.png" alt="deploy_keys"></center>

<blockquote>
<p>è®°å¾—è¦å°† <code>Allow write access</code> çš„é€‰é¡¹é€‰ä¸Šï¼Œè¿™æ · Travis CI æ‰èƒ½è·å¾— push ä»£ç çš„æƒé™ã€‚ </p>
</blockquote>
<ul>
<li>Travis CI ç¯å¢ƒ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp ~/.ssh/id_rsa / <span class="comment">#å°†ä¸Šä¸€æ­¥å¾—åˆ°çš„`id_rsa`å¤åˆ¶åˆ°å½“å‰blogæ ¹ç›®å½•ä¸‹</span></span><br><span class="line">$ vim .travis.yml <span class="comment">#åˆ›å»º.travis.yml</span></span><br><span class="line">$ gem install travis <span class="comment">#å®‰è£…Travis CI</span></span><br><span class="line">$ travis login --auto <span class="comment">#ç™»å½•Travis CIï¼Œéœ€è¦è¾“å…¥GitHubçš„è´¦å·å¯†ç </span></span><br><span class="line">$ travis encrypt-file ssh_key --add <span class="comment">#åŠ å¯†ç§é’¥å¹¶ä¸Šä¼ è‡³Travis æ³¨æ„è¿™é‡Œçš„ ssh_key è¦æ¢æˆä¸Šé¢ç§é’¥çš„åç§°ï¼Œå³: travis encrypt-file id_rsa</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>æ³¨æ„</strong>:<br>gem çš„å®˜æ–¹æºç»å¸¸è¢«qiang, æ‰€ä»¥è¦æ³¨æ„æ›´æ¢gem sources,<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gem sources <span class="comment">#æŸ¥çœ‹åŸæœ‰çš„å®˜æ–¹æº</span></span><br><span class="line">gem <span class="built_in">source</span> -r https://rubygems.org/ <span class="comment"># åˆ é™¤ rubygems å®˜æ–¹æº</span></span><br><span class="line">gem <span class="built_in">source</span> <span class="operator">-a</span> http://mirrors.aliyun.com/rubygems/   <span class="comment"># æ·»åŠ aliyun æº</span></span><br><span class="line">gem install travis --no-rdoc --no-ri --verbose  <span class="comment"># å®‰è£…Travis</span></span><br></pre></td></tr></table></figure></p>
<p><strong>ç”Ÿæˆæç¤º</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">encrypting id_rsa <span class="keyword">for</span> researchlab/researchlab.github.io</span><br><span class="line">storing result as id_rsa.enc</span><br><span class="line">storing secure env variables <span class="keyword">for</span> decryption</span><br><span class="line"></span><br><span class="line">Make sure to add id_rsa.enc to the git repository.</span><br><span class="line">Make sure not to add id_rsa to the git repository.</span><br><span class="line">Commit all changes to your .travis.yml.</span><br></pre></td></tr></table></figure>
<p>ç”ŸæˆåŠ å¯†è¿‡å¾—æ–°ç§˜é’¥<code>id_rsa.enc</code>, å¹¶è‡ªåŠ¨å°†branch blogä¸­gitçš„ä¿¡æ¯åŠè§£å¯†ç§˜é’¥çš„ç›¸å…³ä¿¡æ¯æ·»åŠ åˆ°<code>.travis.yml</code>ä¸­ã€‚<strong> ç„¶åæ‰‹åŠ¨åˆ é™¤ç§é’¥æ–‡ä»¶<code>id_rsa</code>ï¼Œ ä»¥ä¿è¯ä»£ç ä»“åº“çš„å®‰å…¨ã€‚</strong></p>
<ul>
<li>SSHçš„è®¾ç½®<br>åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ssh_configï¼Œå†…å®¹ä¸º</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">  User git</span><br><span class="line">  StrictHostKeyChecking no</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa</span><br><span class="line">  IdentitiesOnly yes</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹.travis.ymlä¸­çš„å‘½ä»¤ï¼ŒæŒ‡å®šopensslè§£å¯†åçš„ç”Ÿæˆä½ç½®ï¼Œxxxxxxxxxxéƒ¨åˆ†å°±æ˜¯ä½ çš„è§£å¯†å‚æ•°ï¼Œä¸è¦å»æ”¹åŠ¨å®ƒã€‚<br>å³å°†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- openssl aes-<span class="number">256</span>-cbc -K <span class="variable">$encrypted_xxxxxxxxxx_key</span> -iv <span class="variable">$encrypted_xxxxxxxxxx_iv</span></span><br><span class="line">	-in id_rsa.enc -out id_rsa <span class="operator">-d</span></span><br></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- openssl aes-<span class="number">256</span>-cbc -K <span class="variable">$encrypted_xxxxxxxxxx_key</span> -iv <span class="variable">$encrypted_xxxxxxxxxx_iv</span></span><br><span class="line">  -in id_rsa.enc -out ~/.ssh/id_rsa <span class="operator">-d</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹ç›®å½•æƒé™<br>ç´§æ¥ç€åœ¨.travis.ymlä¸­ä¿®æ”¹ç›®å½•æƒé™</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- chmod <span class="number">600</span> ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<ul>
<li>å°†å¯†é’¥åŠ å…¥ç³»ç»Ÿ<br>ç´§æ¥ç€åœ¨.travis.ymlä¸­å°†å¯†é’¥åŠ å…¥ç³»ç»Ÿ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="built_in">eval</span> $(ssh-agent)</span><br><span class="line">- ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹gitä¿¡æ¯</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- cp ssh_config ~/.ssh/config</span><br><span class="line">- git config --global user.name <span class="string">"username"</span></span><br><span class="line">- git config --global user.email username@example.com</span><br></pre></td></tr></table></figure>
<ul>
<li>æ·»åŠ åˆ†æ”¯ä¿¡æ¯</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">branches:</span><br><span class="line">  only:</span><br><span class="line">  - blog</span><br></pre></td></tr></table></figure>
<ul>
<li>é…ç½®Hexo</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">install:</span><br><span class="line">- npm install hexo-cli -g</span><br><span class="line">- npm install hexo --save</span><br><span class="line">- npm install</span><br><span class="line"></span><br><span class="line">script:</span><br><span class="line">- hexo clean</span><br><span class="line">- hexo g </span><br><span class="line">- hexo d</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å®Œæˆäº†<code>.travis.yml</code>çš„è®¾ç½®ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„æºæ–‡ä»¶<code>.travis.yml</code>ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">language: node_js&#10;node_js:&#10;- &#39;0.12&#39;&#10;branches:&#10;  only:&#10;  - blog&#10;before_install:&#10;- openssl aes-256-cbc -K $encrypted_xxxxxxxxxx_key-iv $encrypted_xxxxxxxxxx_iv&#10;  -in id_rsa.enc -out ~/.ssh/id_rsa -d&#10;- chmod 600 ~/.ssh/id_rsa&#10;- eval $(ssh-agent)&#10;- ssh-add ~/.ssh/id_rsa&#10;- cp ssh_config ~/.ssh/config&#10;- git config --global user.name &#34;researchlab&#34;&#10;- git config --global user.email leehongitrd@163.com &#10;- git clone -b master git@github.com:researchlab/researchlab.github.io.git deploy_git&#10;install:&#10;- npm install hexo-cli -g&#10;- npm install&#10;- npm install hexo-generator-feed --save&#10;- npm install hexo-deployer-git --save&#10;script:&#10;- hexo clean&#10;- hexo g&#10;- hexo d</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™åº”è¯¥å°†å…¶pushåˆ°blogåˆ†æ”¯,ç„¶åå°±å¯ä»¥äº†ã€‚</p>
<h2 id="u9047_u5230Authentication_failed"><a href="#u9047_u5230Authentication_failed" class="headerlink" title="é‡åˆ°Authentication failed"></a>é‡åˆ°Authentication failed</h2><p>æäº¤ä¹‹åï¼Œå‘ç°<code>Travis-ci</code> æ¯æ¬¡åˆ°<code>hexo d</code> è¿™ä¸€æ­¥æ—¶å°±æŠ¥é”™äº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">remote: Invalid username or password.</span><br><span class="line">fatal: Authentication failed <span class="keyword">for</span> <span class="string">'https://github.com/researchlab/researchlab.github.io.git/'</span></span><br><span class="line">FATAL Something<span class="string">'s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: remote: Invalid username or password.</span><br><span class="line">fatal: Authentication failed for '</span>https://github.com/researchlab/researchlab.github.io.git/<span class="string">'</span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (/home/travis/build/researchlab/researchlab.github.io/node_modules/hexo-deployer-git/node_modules/hexo-util/lib/spawn.js:37:17)</span><br><span class="line">    at ChildProcess.emit (events.js:110:17)</span><br><span class="line">    at maybeClose (child_process.js:1019:16)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (child_process.js:1091:5)</span><br><span class="line">FATAL remote: Invalid username or password.</span><br><span class="line">fatal: Authentication failed for '</span>https://github.com/researchlab/researchlab.github.io.git/<span class="string">'</span><br><span class="line">Error: remote: Invalid username or password.</span><br><span class="line">fatal: Authentication failed for '</span>https://github.com/researchlab/researchlab.github.io.git/<span class="string">'</span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (/home/travis/build/researchlab/researchlab.github.io/node_modules/hexo-deployer-git/node_modules/hexo-util/lib/spawn.js:37:17)</span><br><span class="line">    at ChildProcess.emit (events.js:110:17)</span><br><span class="line">    at maybeClose (child_process.js:1019:16)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (child_process.js:1091:5)</span><br><span class="line">The command "hexo d" exited with 2.</span><br><span class="line">cache.2</span><br><span class="line">store build cache</span><br><span class="line">0.00s</span><br><span class="line">2.99schanges detected, packing new archive</span><br><span class="line">FAILED: tar -Pzcf /home/travis/.casher/push.tgz </span><br><span class="line">tar: Cowardly refusing to create an empty archive</span><br><span class="line">Try `tar --help'</span> or `tar --usage<span class="string">' for more information.</span><br><span class="line">uploading archive</span><br><span class="line">failed to upload cache</span><br><span class="line">curl: Can'</span>t open <span class="string">'/home/travis/.casher/push.tgz'</span>!</span><br><span class="line">curl: try <span class="string">'curl --help'</span> or <span class="string">'curl --manual'</span> <span class="keyword">for</span> more information</span><br><span class="line">Done. Your build exited with <span class="number">1</span>.</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºhexo æ ¹ç›®å½•ä¸‹çš„ <code>_config.yml</code>ä¸­é…ç½®é—®é¢˜å¯¼è‡´çš„ï¼š<br>æŠŠå¦‚ä¸‹é…ç½®:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Deployment&#10;## Docs: https://hexo.io/docs/deployment.html&#10;deploy:&#10;  type: git&#10;  repository: https://github.com/researchlab/researchlab.github.io.git&#10;  branch: master</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Deployment&#10;## Docs: https://hexo.io/docs/deployment.html&#10;deploy:&#10;  type: git&#10;  repository: git@github.com:researchlab/researchlab.github.io.git&#10;  branch: master</span><br></pre></td></tr></table></figure>
<p>é—®é¢˜å³è§£å†³ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç›®å‰ï¼Œè‡ªåŠ¨åŒ–æ„å»ºã€æŒç»­é›†æˆçš„ç†å¿µåœ¨æ•´ä¸ªè®¡ç®—è¡Œä¸šéå¸¸çš„æµè¡Œï¼Œå¤§å®¶æ›´æ„¿æ„å»ä½¿ç”¨è‡ªåŠ¨åŒ–ä»£æ›¿æ‰‹åŠ¨ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚&lt;code&gt;Travis CI&lt;/code&gt;å°±æ˜¯ä¸€ä¸ªåœ¨çº¿çš„ã€åˆ†å¸ƒå¼çš„æŒç»­é›†æˆæœåŠ¡ï¼Œç”¨æ¥æ„å»ºåŠæµ‹è¯•åœ¨GitHubæ‰˜ç®¡çš„ä»£ç ã€‚åˆ©ç”¨Travis CI ä¼šåœ¨æ¯ä¸€æ¬¡pushåç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿæœºæ¥æ‰§è¡Œäº‹å…ˆå®‰æ’å¥½çš„è‡ªåŠ¨æ„å»ºä»»åŠ¡ï¼Œä»æ¥è¿›è¡Œå‘å¸ƒã€‚æœ¬æ–‡å°±è¦ç”¨&lt;code&gt;Travis CI&lt;/code&gt;æ¥è‡ªåŠ¨æ„å»º&lt;code&gt;Hexo&lt;/code&gt;åšå®¢ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Hexo" scheme="http://www.grdtechs.com/categories/Hexo/"/>
    
    
      <category term="Blog" scheme="http://www.grdtechs.com/tags/Blog/"/>
    
      <category term="Hexo" scheme="http://www.grdtechs.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>ginä¸­ä½¿ç”¨è®¾ç½®cookieè¿‡æœŸæ—¶é—´æ€»ç»“</title>
    <link href="http://www.grdtechs.com/2016/03/29/gin-setcookie/"/>
    <id>http://www.grdtechs.com/2016/03/29/gin-setcookie/</id>
    <published>2016-03-29T01:48:56.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯ä»¥æ“ä½œ<code>Cookie</code>çš„<code>Http</code>å¤´æœ‰ä¸¤ä¸ª:<code>Set-Cookie</code>å’Œ<code>Cookie</code>ã€‚<code>Set-Cookie</code>ç”±æœåŠ¡å™¨å‘é€ï¼Œå®ƒåŒ…å«åœ¨å“åº”è¯·æ±‚çš„å¤´éƒ¨ä¸­ã€‚å®ƒç”¨äºåœ¨å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª<code>Cookie</code>ã€‚<code>Cookie</code>å¤´ç”±å®¢æˆ·ç«¯å‘é€ï¼ŒåŒ…å«åœ¨<code>HTTP</code>è¯·æ±‚çš„å¤´éƒ¨ä¸­ã€‚<br><a id="more"></a></p>
<font color="red"><strong>æ³¨æ„ï¼š<br>1.åªæœ‰cookieçš„domainå’Œpathä¸è¯·æ±‚çš„URLåŒ¹é…æ‰ä¼šå‘é€è¿™ä¸ªcookie;<br>2.å®¢æˆ·ç«¯å‘é€cookieä¿¡æ¯ç»™æœåŠ¡å™¨åªå‘é€é”®-å€¼å¯¹åˆ°æœåŠ¡å™¨ï¼Œcookieçš„å±æ€§æ˜¯ä¸ä¼šå‘é€ç»™æœåŠ¡å™¨çš„ã€‚</strong></font>

<h2 id="u8BD5_u9A8C_u9700_u6C42"><a href="#u8BD5_u9A8C_u9700_u6C42" class="headerlink" title="è¯•éªŒéœ€æ±‚"></a>è¯•éªŒéœ€æ±‚</h2><p>1.æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯è®¾ç½®cookieï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶å¦‚æœcookieæ²¡æœ‰è¿‡æœŸï¼Œåˆ™æœåŠ¡å™¨å°†cookieç›¸åº”çš„value åŠ 1å¹¶é‡è®¾cookie, å¦‚æœcookie è¿‡æœŸï¼Œåˆ™é‡æ–°è®¾ç½®cookieè®©value ä»0å¼€å§‹è®¡æ•°ã€‚</p>
<h2 id="u8BD5_u9A8C_u4EE3_u7801"><a href="#u8BD5_u9A8C_u4EE3_u7801" class="headerlink" title="è¯•éªŒä»£ç "></a>è¯•éªŒä»£ç </h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	<span class="string">"strconv"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.Use(Counter()) <span class="comment">//è¿™ä¸ªæ˜¯æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ‰§è¡ŒCounter()è¿™ä¸ªæ–¹æ³•ï¼Œ</span></span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"/counter"</span>, <span class="keyword">func</span>(c *gin.Context) &#123;</span><br><span class="line">		<span class="keyword">if</span> cookie, err := c.Request.Cookie(<span class="string">"counter"</span>); err == <span class="constant">nil</span> &#123;</span><br><span class="line">			c.String(http.StatusOK, cookie.Expires.String())</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			http.SetCookie(c.Writer, &amp;http.Cookie&#123;</span><br><span class="line">				Name:    <span class="string">"counter"</span>,</span><br><span class="line">				Value:   <span class="string">""</span>,</span><br><span class="line">				Expires: time.Now().Add(<span class="number">10</span> * time.Second),</span><br><span class="line">			&#125;)</span><br><span class="line">			c.String(http.StatusOK, <span class="string">"SetCookie ok"</span>)</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println(<span class="string">"server start from 8010"</span>)</span><br><span class="line">	r.Run(<span class="string">":8010"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Counter() gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">func</span>(c *gin.Context) &#123;</span><br><span class="line">		<span class="keyword">if</span> cookie, err := c.Request.Cookie(<span class="string">"counter"</span>); err == <span class="constant">nil</span> &#123;</span><br><span class="line">			value := cookie.Value</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(value) == <span class="number">0</span> &#123;</span><br><span class="line">				cookie.Value = <span class="string">"0"</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> v, err := strconv.Atoi(value); err == <span class="constant">nil</span> &#123;</span><br><span class="line">					i := v + <span class="number">1</span></span><br><span class="line">					cookie.Value = fmt.Sprintf(<span class="string">"%d"</span>, i)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			http.SetCookie(c.Writer, cookie)</span><br><span class="line">			<span class="comment">//before request</span></span><br><span class="line">			c.Next()</span><br><span class="line">			<span class="comment">//after request</span></span><br><span class="line">			c.String(http.StatusOK, <span class="string">" counter:"</span>+cookie.Value)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u4EE3_u7801_u5206_u6790"><a href="#u4EE3_u7801_u5206_u6790" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><p>ä¸Šè¿°ä»£ç ä¸­<code>r.Use(Counter())</code>è¡¨ç¤ºå®¢æˆ·ç«¯æ¯æ¬¡å‘é€ä¸€ä¸ªè¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œéƒ½ä¼šæ‰§è¡Œ<code>Counter()</code>è¿™ä¸ªå‡½æ•°ã€‚æ¯”å¦‚å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª<code>http://localhost:8010/counter</code>çš„è¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œåˆ™å…·ä½“çš„å¤„ç†æµç¨‹ä¸ºï¼šå…ˆæ‰§è¡Œ<code>Counter()</code>å‡½æ•°ä¸­çš„<code>c.Next()</code>å‰é¢çš„ä»£ç ï¼Œå½“æ‰§è¡Œåˆ°<code>c.Next()</code>æ—¶ï¼Œ å…ˆå»æ‰§è¡Œ<code>r.GET(&quot;/counter&quot;,func(c *gin.Context) {xxx}</code>ä¸­<code>xxx</code>ç¨‹åºä½“ï¼Œå½“<code>xxx</code>ç¨‹åºä½“æ‰§è¡Œå®Œä¹‹åï¼Œå†æ‰§è¡Œ<code>Counter()</code>å‡½æ•°ä¸­<code>c.Next()</code>ä¹‹åçš„ç¨‹åºä½“ï¼Œç„¶åæ•´ä¸ªè¯·æ±‚æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>å›åˆ°ä¸Šé¢çš„è¯•éªŒéœ€æ±‚ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ²¡æœ‰cookieï¼Œæ­¤æ—¶æœåŠ¡å™¨è®¾ç½®cookieå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚æ—¶å¦‚æœè¿˜æ²¡æœ‰è¿‡æœŸåˆ™åœ¨Counterä¸­å°±èƒ½æŸ¥åˆ°cookie,æ­¤æ—¶é€šè¿‡<code>Counter()</code>é‡æ–°è®¾ç½®cookie, ä½†æ˜¯æ³¨æ„ï¼šè¿™é‡Œè®¾ç½®çš„cookieï¼Œå› ä¸ºNameä¸ä¹‹å‰çš„cookieæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ­¤æ¬¡è®¾ç½®çš„cookieçš„å±æ€§ä¼šè¦†ç›–ä¹‹å‰çš„cookieçš„å±æ€§ï¼Œå› ä¸ºæ­¤æ¬¡åªæ˜¯æ”¹å˜cookieçš„valueï¼Œè€Œæ²¡æœ‰è®¾ç½®cookieçš„å±æ€§ï¼Œæ‰€ä»¥æ­¤æ¬¡è®¾ç½®cookieæ²¡æœ‰è¿‡æœŸæ—¶é—´å¯è¨€äº†ã€‚æ‰€ä»¥ä¸Šè¿°çš„è¯•éªŒéœ€æ±‚æ˜¯ä¸åˆç†çš„ã€‚æˆ–è€…è¯´å¯ä»¥é€šè¿‡<code>redis</code>çš„æ“ä½œå»å®ç°ï¼Œä½†æ˜¯ä¸èƒ½ä»…é è®¾ç½®<code>cookie</code>æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚</p>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>æœåŠ¡å™¨å‘é€cookieç»™å®¢æˆ·ç«¯</strong><br> ä»æœåŠ¡å™¨ç«¯ï¼Œå‘é€cookieç»™å®¢æˆ·ç«¯ï¼Œæ˜¯å¯¹åº”çš„Set-Cookieã€‚åŒ…æ‹¬äº†å¯¹åº”çš„cookieçš„åç§°ï¼Œå€¼ï¼Œä»¥åŠå„ä¸ªå±æ€§ã€‚<br> ä¾‹å¦‚ï¼š<br>Set-Cookie: lu=Rg3vHJZnehYLjVg7qi3bZjzg; Expires=Tue, 15 Jan 2013 21:47:38 GMT; Path=/; Domain=.169it.com; HttpOnly<br>Set-Cookie: made_write_conn=1295214458; Path=/; Domain=.169it.com<br>Set-Cookie: reg_fb_gate=deleted; Expires=Thu, 01 Jan 1970 00:00:01 GMT; Path=/; Domain=.169it.com; HttpOnly</p>
<p><strong>ä»å®¢æˆ·ç«¯æŠŠcookieå‘é€åˆ°æœåŠ¡å™¨</strong><br> ä»å®¢æˆ·ç«¯å‘é€cookieç»™æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæ˜¯ä¸å‘é€cookieçš„å„ä¸ªå±æ€§çš„ï¼Œè€Œåªæ˜¯å‘é€å¯¹åº”çš„åç§°å’Œå€¼ã€‚<br> ä¾‹å¦‚ï¼š<br>GET /spec.html HTTP/1.1<br>Host: www.example.org<br>Cookie: name=value; name2=value2<br>Accept: <em>/</em>  </p>
<font color="red">é™¤äº†name=valueå¯¹ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®Cookieå…¶ä»–å±æ€§ä»¥æ”¯æŒæ›´ä¸°å¯Œçš„Cookieéœ€æ±‚ï¼Œ<strong>è¿™äº›å±æ€§é€šå¸¸æ˜¯æµè§ˆå™¨ç”¨æ¥åˆ¤æ–­å¦‚ä½•å¯¹å¾…cookieï¼Œä½•æ—¶åˆ é™¤ã€å±è”½æˆ–è€…å¦‚ä½•å‘é€name-valueå¯¹ç»™Serverã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºæˆ‘ä»¬è®¾ç½®äº†æŸä¸ªcookieçš„å¤šå°‘å±æ€§ï¼Œè¿™äº›Cookieå±æ€§æ˜¯ä¸ä¼šè¢«æµè§ˆå™¨å‘é€å›ç»™Serverçš„ã€‚åŒ…æ‹¬è®¾ç½®çš„è¿‡æœŸæ—¶é—´ä¹Ÿä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨ç«¯</strong></font>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å¯ä»¥æ“ä½œ&lt;code&gt;Cookie&lt;/code&gt;çš„&lt;code&gt;Http&lt;/code&gt;å¤´æœ‰ä¸¤ä¸ª:&lt;code&gt;Set-Cookie&lt;/code&gt;å’Œ&lt;code&gt;Cookie&lt;/code&gt;ã€‚&lt;code&gt;Set-Cookie&lt;/code&gt;ç”±æœåŠ¡å™¨å‘é€ï¼Œå®ƒåŒ…å«åœ¨å“åº”è¯·æ±‚çš„å¤´éƒ¨ä¸­ã€‚å®ƒç”¨äºåœ¨å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª&lt;code&gt;Cookie&lt;/code&gt;ã€‚&lt;code&gt;Cookie&lt;/code&gt;å¤´ç”±å®¢æˆ·ç«¯å‘é€ï¼ŒåŒ…å«åœ¨&lt;code&gt;HTTP&lt;/code&gt;è¯·æ±‚çš„å¤´éƒ¨ä¸­ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="gin" scheme="http://www.grdtechs.com/tags/gin/"/>
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
      <category term="setcookie" scheme="http://www.grdtechs.com/tags/setcookie/"/>
    
  </entry>
  
  <entry>
    <title>golangç±»å‹è½¬æ¢(æŒ‡å®šç²¾åº¦/å››èˆäº”å…¥)</title>
    <link href="http://www.grdtechs.com/2016/03/24/go-type-convert/"/>
    <id>http://www.grdtechs.com/2016/03/24/go-type-convert/</id>
    <published>2016-03-24T02:06:54.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>Go</code>çš„æ•°æ®ç±»å‹å¾ˆå¤šéƒ½éœ€è¦æ˜¾ç¤ºè½¬æ¢æ‰èƒ½ä½¿ç”¨,æ¯”å¦‚<code>string</code>è½¬<code>float64</code>æŒ‡å®šç²¾åº¦ç­‰ã€‚è½¬æ¢ä¸­å¸¸ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åŒ…ä¸º<code>strconv</code>å’Œ<code>math</code>åŒ…ã€‚<br><a id="more"></a></p>
<h2 id="u6574_u578B_u8F6C_u5B57_u7B26_u4E32"><a href="#u6574_u578B_u8F6C_u5B57_u7B26_u4E32" class="headerlink" title="æ•´å‹è½¬å­—ç¬¦ä¸²"></a>æ•´å‹è½¬å­—ç¬¦ä¸²</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strconv.Itoa(i) <span class="comment">//æ–¹æ³•1</span></span><br><span class="line">strconv.FormatInt(<span class="typename">int64</span>(i),<span class="number">10</span>) <span class="comment">//æ–¹æ³•2</span></span><br></pre></td></tr></table></figure>
<h2 id="u5B57_u7B26_u4E32_u8F6C_u6574_u578B"><a href="#u5B57_u7B26_u4E32_u8F6C_u6574_u578B" class="headerlink" title="å­—ç¬¦ä¸²è½¬æ•´å‹"></a>å­—ç¬¦ä¸²è½¬æ•´å‹</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strconv.Atoi(s) <span class="comment">//æ–¹æ³•1</span></span><br><span class="line">strconv.ParseInt(s,<span class="number">10</span>,<span class="number">0</span>) <span class="comment">//æ–¹æ³•2</span></span><br></pre></td></tr></table></figure>
<h2 id="bytes_u8F6Cfloat64"><a href="#bytes_u8F6Cfloat64" class="headerlink" title="bytesè½¬float64"></a>bytesè½¬float64</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> bytesToFloat64(bytes []<span class="typename">byte</span>) <span class="typename">float64</span> &#123;</span><br><span class="line">	bits := binary.LittleEndian.Uint64(bytes)</span><br><span class="line">	<span class="keyword">return</span> math.Float64frombits(bits)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="float64_u8F6Cbytes"><a href="#float64_u8F6Cbytes" class="headerlink" title="float64è½¬bytes"></a>float64è½¬bytes</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> float64ToBytes(input <span class="typename">float64</span>) []<span class="typename">byte</span> &#123;</span><br><span class="line">	bits := math.Float64bits(input)</span><br><span class="line">	bytes := <span class="built_in">make</span>([]<span class="typename">byte</span>,<span class="number">8</span>) <span class="comment">//è¿™é‡Œè¡¨ç¤º[]uint8, æ‰€ä»¥ç”¨äº† 8</span></span><br><span class="line">	binary.LittleEndian.PutUint64(bytes,bits)</span><br><span class="line">	<span class="keyword">return</span> bytes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="float64_u8F6Cstring"><a href="#float64_u8F6Cstring" class="headerlink" title="float64è½¬string"></a>float64è½¬string</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> FloatToStr(num <span class="typename">float64</span>, floatPartLen <span class="typename">int</span>) <span class="typename">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> strconv.FormatFloat(num,<span class="string">'f'</span>,floatPartLen,<span class="number">64</span>) <span class="comment">//è¿™é‡Œ64æ”¹ä¸º32ï¼Œåˆ™è¡¨ç¤ºfloat32</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="string_u8F6Cfloat64"><a href="#string_u8F6Cfloat64" class="headerlink" title="stringè½¬float64"></a>stringè½¬float64</h2><p><code>string</code>è½¬<code>float64</code> è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œéƒ½æ”¯æŒæŒ‡å®šç²¾åº¦ã€‚<strong> æ³¨æ„ï¼šæ‰€æœ‰æ•°å­—è¦åœ¨è¡¨ç°å±‚æ˜¾ç¤ºæœ€å¥½è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¼ é€ç»™è¡¨ç°å±‚ï¼Œå¦‚æœç”¨äºåç«¯è®¡ç®—åˆ™è½¬æ¢ä¸ºæ•°å­—å³å¯ã€‚æ¯”å¦‚ï¼šæ•°å­—2.10 å¦‚æœç”¨ä¿æŒ5ä½æ•°å­—ç²¾åº¦æ˜¾ç¤ºï¼š é‚£ä¹ˆ æ•°å­—2.10 æ˜¾ç¤ºä¸ºï¼š2.1, è€Œå°†2.10è½¬æ¢ä¸ºå­—ç¬¦ä¸²åŒæ—¶ä¿æŒ5ä½ç²¾åº¦ï¼Œåˆ™æ˜¾ç¤ºä¸º: 2.10000ã€‚ä½†æ˜¯å®ƒä»¬éƒ½æ˜¯è½¬æ¢ä¸ºäº†5ä½ç²¾åº¦çš„ï¼Œåªæ˜¯æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæ•°å­—2.10000 ç›´æ¥æ˜¾ç¤ºä¸º2.1äº†ï¼Œ æ‰€ä»¥è¦æ˜¾ç¤ºç²¾åº¦åˆ™è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¦ç”¨äºè®¡ç®—åˆ™è½¬æ¢ä¸ºæ•°å­—ã€‚</strong></p>
<p>æ–¹æ³•1ï¼š åªæ”¯æŒæŒ‡å®šç²¾åº¦<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> strToFloat64(str <span class="typename">string</span>, <span class="built_in">len</span> <span class="typename">int</span>) <span class="typename">float64</span> &#123;</span><br><span class="line">	lenstr := <span class="string">"%."</span> + strconv.Itoa(<span class="built_in">len</span>) + <span class="string">"f"</span></span><br><span class="line">	value,_ := strconv.ParseFloat(str,<span class="number">64</span>)</span><br><span class="line">	nstr := fmt.Sprintf(lenstr,value)</span><br><span class="line">	val,_ := strconv.ParseFloat(nstr,<span class="number">64</span>)</span><br><span class="line">	<span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ–¹æ³•2ï¼šæ”¯æŒæŒ‡å®šç²¾åº¦ï¼Œæ”¯æŒæ˜¯å¦å››èˆäº”å…¥<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> strToFloat64Round(str <span class="typename">string</span>, prec <span class="typename">int</span>, round <span class="typename">bool</span>) <span class="typename">float64</span> &#123;</span><br><span class="line">	f,_ := strconv.ParseFloat(str,<span class="number">64</span>)</span><br><span class="line">	<span class="keyword">return</span> Precision(f,prec,round)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Precision(f <span class="typename">float64</span>, prec <span class="typename">int</span>, round <span class="typename">bool</span>) <span class="typename">float64</span> &#123;</span><br><span class="line">	pow10_n := math.Pow10(prec)</span><br><span class="line">	<span class="keyword">if</span> round &#123;</span><br><span class="line">		<span class="keyword">return</span> math.Trunc(f + <span class="number">0.5</span>/pow10_n)*pow10_n) / pow10_n	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> math.Trunc((f)*pow10_n) / pow10_n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…·ä½“è¯·å‚è€ƒ[<a href="https://github.com/researchlab/golearning/blob/master/base/convert.go" target="_blank" rel="external">ç¤ºä¾‹ä»£ç </a>]</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Go&lt;/code&gt;çš„æ•°æ®ç±»å‹å¾ˆå¤šéƒ½éœ€è¦æ˜¾ç¤ºè½¬æ¢æ‰èƒ½ä½¿ç”¨,æ¯”å¦‚&lt;code&gt;string&lt;/code&gt;è½¬&lt;code&gt;float64&lt;/code&gt;æŒ‡å®šç²¾åº¦ç­‰ã€‚è½¬æ¢ä¸­å¸¸ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åŒ…ä¸º&lt;code&gt;strconv&lt;/code&gt;å’Œ&lt;code&gt;math&lt;/code&gt;åŒ…ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>golang è®¾è®¡æ¨¡å¼ä¹‹observerä½¿ç”¨æ€»ç»“</title>
    <link href="http://www.grdtechs.com/2016/02/26/observer-pattern-in-go-md/"/>
    <id>http://www.grdtechs.com/2016/02/26/observer-pattern-in-go-md/</id>
    <published>2016-02-26T00:40:11.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è§‚å¯Ÿè€…(<code>Observer</code>)è®¾è®¡æ¨¡å¼å®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä»¥ä¾¿ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨åˆ·æ–°ã€‚è§‚å¯Ÿè€…æ¨¡å¼å°†è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿçš„å¯¹è±¡åˆ†ç¦»å¼€,ä½“ç°äº†é¢å‘å¯¹è±¡è®¾è®¡ä¸­ä¸€ä¸ªå¯¹è±¡åªåšä¸€ä»¶äº‹æƒ…çš„åŸåˆ™ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¯ç»´æŠ¤æ€§å’Œé‡ç”¨æ€§ã€‚<br><a id="more"></a></p>
<h2 id="u5B9E_u73B0_u89C2_u5BDF_u8005_u6A21_u5F0F"><a href="#u5B9E_u73B0_u89C2_u5BDF_u8005_u6A21_u5F0F" class="headerlink" title="å®ç°è§‚å¯Ÿè€…æ¨¡å¼"></a>å®ç°è§‚å¯Ÿè€…æ¨¡å¼</h2><p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰å¾ˆå¤šå®ç°æ–¹å¼ï¼Œä»æ ¹æœ¬ä¸Šè¯´ï¼Œè¯¥æ¨¡å¼å¿…é¡»åŒ…å«ä¸¤ä¸ªè§’è‰²ï¼šè§‚å¯Ÿè€…(Observer)å’Œè¢«è§‚å¯Ÿå¯¹è±¡(Subject)ã€‚</p>
<p><center><img src="/imgs/observer_pattern.jpg" alt="observer_pattern"></center></p>
<ul>
<li><p>è§‚å¯Ÿè€…<br>è§‚å¯Ÿè€…ï¼ˆ<code>Observer</code>ï¼‰å°†è‡ªå·±æ³¨å†Œåˆ°è¢«è§‚å¯Ÿå¯¹è±¡ï¼ˆ<code>Subject</code>ï¼‰ä¸­ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡å°†è§‚å¯Ÿè€…å­˜æ”¾åœ¨ä¸€ä¸ªå®¹å™¨ï¼ˆ<code>Container</code>ï¼‰é‡Œã€‚</p>
</li>
<li><p>è¢«è§‚å¯Ÿ<br>è¢«è§‚å¯Ÿå¯¹è±¡(<code>Subject</code>)å‘ç”Ÿäº†æŸç§å˜åŒ–ï¼Œä»å®¹å™¨ä¸­å¾—åˆ°æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…ï¼Œå°†å˜åŒ–é€šçŸ¥è§‚å¯Ÿè€…(<code>notifyObservers</code>)ã€‚</p>
</li>
<li><p>æ’¤é”€è§‚å¯Ÿ<br>è§‚å¯Ÿè€…å‘Šè¯‰è¢«è§‚å¯Ÿè€…è¦æ’¤é”€è§‚å¯Ÿï¼Œè¢«è§‚å¯Ÿè€…ä»å®¹å™¨ä¸­å°†è§‚å¯Ÿè€…å»é™¤ã€‚<br><strong>è§‚å¯Ÿè€…å°†è‡ªå·±æ³¨å†Œåˆ°è¢«è§‚å¯Ÿè€…çš„å®¹å™¨ä¸­æ—¶ï¼Œè¢«è§‚å¯Ÿè€…ä¸åº”è¯¥è¿‡é—®è§‚å¯Ÿè€…çš„å…·ä½“ç±»å‹ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨è§‚å¯Ÿè€…çš„æ¥å£ã€‚</strong>è¿™æ ·çš„ä¼˜ç‚¹æ˜¯ï¼šå‡å®šç¨‹åºä¸­è¿˜æœ‰åˆ«çš„è§‚å¯Ÿè€…ï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªè§‚å¯Ÿè€…ä¹Ÿæ˜¯ç›¸åŒçš„æ¥å£å®ç°å³å¯ã€‚ä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯ä»¥å¯¹åº”å¤šä¸ªè§‚å¯Ÿè€…ï¼Œå½“è¢«è§‚å¯Ÿè€…å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥å°†æ¶ˆæ¯ä¸€ä¸€é€šçŸ¥ç»™æ‰€æœ‰çš„è§‚å¯Ÿè€…ã€‚åŸºäºæ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°â€”â€”è¿™ä¸€ç‚¹ä¸ºç¨‹åºæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚<br>ä¸‹é¢é€šè¿‡æ„å»ºä¸€ä¸ªè‚¡æ°‘(<code>Observer</code>)å’Œä»–ä»¬å…³æ³¨çš„æŸæ”¯å…·ä½“è‚¡ç¥¨(<code>Subject</code>)æ¡ˆä¾‹åˆ†æ,<br>é¦–å…ˆè§‚å¯Ÿè€…(<code>Observer</code>)è¦èƒ½æ³¨å†Œ/æ³¨é”€åˆ°æŸä¸ªè¢«è§‚å¯Ÿè€…(<code>Subject</code>)ä¸­ï¼ŒåŒæ—¶è¢«è§‚å¯Ÿè€…(<code>Subject</code>)å‘é€å˜åŒ–æ—¶è¦èƒ½å¤Ÿé€šçŸ¥åˆ°ä¾èµ–å®ƒçš„è§‚å¯Ÿè€…(<code>Observer</code>),ç”±æ­¤æˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªè¢«è§‚å¯Ÿè€…(<code>Subject</code>)çš„æ¥å£ï¼š</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// subjectè¢«è§‚å¯Ÿè€…æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Subject <span class="keyword">interface</span> &#123;</span><br><span class="line">	Attach(Observer)</span><br><span class="line">	Detach(Observer)</span><br><span class="line">	Notify()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>éµå¾ªè¢«è§‚å¯Ÿè€…ä¸åº”è¯¥è¿‡é—®è§‚å¯Ÿè€…çš„å…·ä½“ç±»å‹ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨è§‚å¯Ÿè€…çš„æ¥å£çš„åŸåˆ™ï¼Œå½“è¢«è§‚å¯Ÿè€…(<code>Subject</code>)å› è‡ªèº«æ”¹å˜é€šçŸ¥è§‚å¯Ÿè€…(<code>Observer</code>)æ”¹å˜æ—¶ï¼Œåº”æä¾›ä¸€ä¸ªè§‚å¯Ÿè€…(<code>Observer</code>)æ¥å£ä¾›è¢«è§‚å¯Ÿè€…(<code>Subject</code>)è°ƒç”¨:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// observerè§‚å¯Ÿè€…</span></span><br><span class="line"><span class="keyword">type</span> Observer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Update(Subject, <span class="keyword">interface</span>&#123;&#125;) <span class="comment">//æ›´æ–°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¥å£è®¾è®¡å¥½ä¹‹åï¼Œå°±éœ€è¦é€šè¿‡å…·ä½“çš„å¯¹è±¡æ¥å®ç°è¿™äº›æ¥å£ï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­å‡å®šè‚¡æ°‘å…³æ³¨çš„æ˜¯ä¸­å›½çŸ³æ²¹è¿™åªè‚¡ç¥¨ï¼Œé‚£ä¹ˆè‚¡ç¥¨å°±æ˜¯è§‚å¯Ÿè€…(<code>Observer</code>),è€Œä¸­å›½çŸ³æ²¹è‚¡ç¥¨åˆ™æ˜¯è¢«è§‚å¯Ÿè€…(<code>Subject</code>),å…·ä½“ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…·ä½“observerè§‚å¯Ÿè€…</span></span><br><span class="line"><span class="keyword">type</span> Investors <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">/*æŠ•èµ„äºº*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“subjectè¢«è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="keyword">type</span> ChinaPetroleum <span class="keyword">struct</span> &#123;</span><br><span class="line">	oblist []Observer <span class="comment">//æ³¨å†Œè€…é“¾è¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è§‚å¯Ÿè€…(&lt;code&gt;Observer&lt;/code&gt;)è®¾è®¡æ¨¡å¼å®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä»¥ä¾¿ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨åˆ·æ–°ã€‚è§‚å¯Ÿè€…æ¨¡å¼å°†è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿçš„å¯¹è±¡åˆ†ç¦»å¼€,ä½“ç°äº†é¢å‘å¯¹è±¡è®¾è®¡ä¸­ä¸€ä¸ªå¯¹è±¡åªåšä¸€ä»¶äº‹æƒ…çš„åŸåˆ™ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¯ç»´æŠ¤æ€§å’Œé‡ç”¨æ€§ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="go-pattern" scheme="http://www.grdtechs.com/categories/go-pattern/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
      <category term="observer" scheme="http://www.grdtechs.com/tags/observer/"/>
    
  </entry>
  
  <entry>
    <title>golang è®¾è®¡æ¨¡å¼ä¹‹singletonä½¿ç”¨æ€»ç»“</title>
    <link href="http://www.grdtechs.com/2016/02/25/singleton-pattern-in-go/"/>
    <id>http://www.grdtechs.com/2016/02/25/singleton-pattern-in-go/</id>
    <published>2016-02-25T17:01:43.000Z</published>
    <updated>2016-11-23T06:28:51.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>golang</code> 1.5ç‰ˆæœ¬ä¹‹åé»˜è®¤è®¾ç½®<code>GOMAXPROCS</code>å€¼ä¸ºå½“å‰è®¡ç®—æœºçœŸå®æ ¸å¿ƒæ•°ï¼Œä½¿å¾—<code>goroutines</code>ä»é»˜è®¤çš„<code>å•çº¿ç¨‹å†…å¹¶å‘æ‰§è¡Œ</code>å˜æˆäº†é»˜è®¤çš„ï¼ˆçœŸå®æ ¸å¿ƒæ•°æ”¯æŒçš„ï¼‰çš„<code>å¤šçº¿ç¨‹å†…å¹¶è¡Œ</code>æ‰§è¡Œã€‚å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ<code>goroutines</code>éœ€è¦è€ƒè™‘å¹¶è¡Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¼•å…¥çš„<code>çº¿ç¨‹å®‰å…¨é—®é¢˜</code>ã€‚<br><a id="more"></a></p>
<h2 id="u5355_u7EBF_u7A0Bsingleton_u6A21_u578B"><a href="#u5355_u7EBF_u7A0Bsingleton_u6A21_u578B" class="headerlink" title="å•çº¿ç¨‹singletonæ¨¡å‹"></a>å•çº¿ç¨‹singletonæ¨¡å‹</h2><p>å•ä¾‹æ¨¡å¼å®šä¹‰ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚å…ˆæ‘˜å–ä¸€ä¸ªåœ¨å®é™…å·¥ä½œé¡¹ç›®ä¸­ç¢°åˆ°çš„singletonæ¨¡å‹ä»£ç :<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance *singleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> GetInstance() *singleton &#123;</span><br><span class="line">	<span class="keyword">if</span> instance == <span class="constant">nil</span> &#123;</span><br><span class="line">       instance = &amp;singleton&#123;&#125;   <span class="comment">// æ²¡æœ‰è€ƒè™‘çº¿ç¨‹å®‰å…¨ </span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„<code>singleton</code>è®¾è®¡ä»£ç åœ¨è§è¿‡çš„å‡ ä¸ª<code>golang</code>é¡¹ç›®ä¸­éƒ½æ˜¯è¿™ä¹ˆå†™çš„ï¼Œå¦‚æœè¿™æ®µä»£ç æ”¾åœ¨<code>golang</code>1.5ç‰ˆæœ¬ä¹‹å‰é»˜è®¤çš„å•çº¿ç¨‹åœºæ™¯ä¸‹è¿è¡Œæ˜¾ç„¶æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ã€‚<code>golang</code>1.5ç‰ˆæœ¬ä¹‹åé»˜è®¤æ˜¯å¯åŠ¨å¤šæ ¸å¹¶è¡Œæ‰§è¡Œ<code>goroutines</code>çš„ï¼Œå¦‚æœä¸Šè¿°ä»£ç æ”¾åœ¨<code>golang</code>1.5ç‰ˆæœ¬ä¹‹åï¼Œå¦‚æœç¨‹åºå¼€å¯nä¸ª<code>goroutines</code>åˆå§‹åŒ–ä¸€ä¸ª<code>singleton</code>å¯¹è±¡, æ˜¾ç„¶ä¼šåˆå§‹åŒ–æˆåŠŸæœ€å°‘ä¸€ä¸ªæœ€å¤šnä¸ª<code>singleton</code>å¯¹è±¡ï¼Œä»è€Œä¼šå­˜åœ¨æ½œåœ¨çš„å¤šä¸ªå•ä¾‹å®ä¾‹å¯¹è±¡äº†ï¼Œä¹Ÿå°±ä¸å¯èƒ½ä¿è¯è¿™ä¸ª<code>singleton</code>å¯¹è±¡å…¨å±€å”¯ä¸€æ€§äº†ï¼Œé‚£åç»§é‡‡ç”¨<code>singleton</code>å¯¹è±¡è¿›è¡Œå…¨å±€å”¯ä¸€æ€§æ“ä½œæ—¶åŠ¿å¿…ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å¦‚æœåœºæ™¯ä¸­ä½†ä¸ª<code>goroutines</code>æ‰§è¡Œæ—¶é—´çŸ­çš„è¯ï¼Œä¼šä½¿å¾—è°ƒè¯•æ›´éš¾ã€‚</p>
<h2 id="u91C7_u7528_u4E92_u65A5_u9501_u673A_u5236"><a href="#u91C7_u7528_u4E92_u65A5_u9501_u673A_u5236" class="headerlink" title="é‡‡ç”¨äº’æ–¥é”æœºåˆ¶"></a>é‡‡ç”¨äº’æ–¥é”æœºåˆ¶</h2><p>é¢å¯¹ä¸Šè¿°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸€èˆ¬ä¼šè€ƒè™‘åˆ°ç”¨é”æœºåˆ¶(<code>Mutex</code>)æ¥è§£å†³å› çº¿ç¨‹å®‰å…¨å¼•å…¥çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œé‡‡ç”¨é”æœºåˆ¶å¦‚ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mu Sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> GetInstance() *singleton &#123;</span><br><span class="line">    mu.Lock()                    <span class="comment">// singletonå®ä¾‹å¯¹è±¡æ“ä½œä¹‹åï¼Œé”å°±æ˜¯å¤šä½™çš„äº† </span></span><br><span class="line">    <span class="keyword">defer</span> mu.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> instance == <span class="constant">nil</span> &#123;</span><br><span class="line">        instance = &amp;singleton&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¼•å…¥é”æœºåˆ¶<code>Sync.Mutex</code>åï¼Œèƒ½å¤Ÿä¿è¯å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ<code>goroutines</code>åˆ›å»ºçš„<code>singleton</code>å®ä¾‹å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯å½“è¿™ä¸ª<code>singleton</code>å®ä¾‹å¯¹è±¡è¢«åˆå§‹åŒ–åˆ›å»ºä¹‹åï¼Œå†æ¬¡å¹¶è¡Œæ¥åˆ›å»º<code>singleton</code>å®ä¾‹å¯¹è±¡æ—¶ï¼Œå…¶å®å·²ç»ä¸å†éœ€è¦é”äº†ï¼Œå› ä¸ºå·²ç»å­˜åœ¨äº†ä¸€ä¸ªåˆ›å»ºå¥½çš„<code>singleton</code>å®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›å³å¯;ä½†æ˜¯å› ä¸ºé”æœºåˆ¶çš„å­˜åœ¨ï¼Œä½¿å¾—å†æ¬¡åˆ›å»º<code>singleton</code>å®ä¾‹å¯¹è±¡æ—¶ï¼Œè¿˜æ˜¯éœ€è¦å…ˆè·å–é”ï¼Œç„¶ååœ¨åˆ¤æ–­å¤„ç†ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œä¸­è¿™ç§é”ç«äº‰ä½¿å¾—å¤šçº¿ç¨‹çš„å¹¶è¡Œæ‰§è¡Œå˜æˆäº†å¤šçº¿ç¨‹çš„ä¸²è¡Œæ‰§è¡Œï¼Œè¿™æ˜¾ç„¶ä¼šä½¿ç¨‹åºä¸§å¤±å¹¶è¡Œæ‰§è¡Œå¸¦æ¥çš„æ€§èƒ½æå‡ã€‚åœ¨ä¸€ä¸ªé«˜åº¦å¹¶è¡Œçš„ç¨‹åºä¸­ï¼Œè¿™æ ·æ˜¾ç¤ºä¼šæ˜¯æŠ‘åˆ¶ç¨‹åºæ€§èƒ½æå‡çš„ä¸€ä¸ªç“¶é¢ˆã€‚</p>
<h2 id="u91C7_u7528_u53CC_u91CD_u68C0_u67E5_u9501_u673A_u5236"><a href="#u91C7_u7528_u53CC_u91CD_u68C0_u67E5_u9501_u673A_u5236" class="headerlink" title="é‡‡ç”¨åŒé‡æ£€æŸ¥é”æœºåˆ¶"></a>é‡‡ç”¨åŒé‡æ£€æŸ¥é”æœºåˆ¶</h2><p>åœ¨<code>C++</code>ç­‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¸ºäº†åŒæ—¶ä¿è¯æœ€å°é”å’Œçº¿ç¨‹å®‰å…¨é€šå¸¸é‡‡ç”¨çš„æ–¹æ³•æ˜¯<code>åŒé‡æ£€æŸ¥é”(Check-Lock-Check)</code>æœºåˆ¶ï¼Œä¹Ÿè¡¨è¿°ä¸º<code>DCL(Double Check Lock)</code>ã€‚<code>åŒé‡æ£€æŸ¥é”</code>æœºåˆ¶çš„ä¼ªä»£ç ä¸€èˆ¬æ˜¯ä¸‹é¢çš„è¿™ç§å½¢å¼:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> check() &#123;</span><br><span class="line">    lock() &#123;</span><br><span class="line">       <span class="keyword">if</span> check() &#123;</span><br><span class="line">           <span class="comment">// é”å®‰å…¨ä»£ç  </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶å®å¯¹è¿™ä¸ª<code>singleton</code>å®ä¾‹å¯¹è±¡æ¥è¯´ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹çš„æ—¶å€™æ‰éœ€è¦åŒæ­¥ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘åŒæ­¥ï¼Œå…ˆcheckä¸€ä¸‹ï¼Œåˆ¤æ–­<code>singleton</code>å®ä¾‹å¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºæ˜¯ç¬¬ä¸€ä½¿ç”¨è¿™ä¸ª<code>singleton</code>å®ä¾‹å¯¹è±¡ï¼Œé‚£å°±é”ä½å®ƒï¼Œnewä¸€ä¸ª<code>singleton</code>å®ä¾‹ï¼Œä¸‹æ¬¡å¦ä¸€ä¸ªçº¿ç¨‹æ¥<code>GetInstance</code>çš„æ—¶å€™ï¼Œçœ‹åˆ°è¿™ä¸ª<code>singleton</code>å®ä¾‹å¯¹è±¡ä¸ä¸ºç©ºï¼Œå°±è¡¨ç¤ºå·²ç»åˆ›å»ºè¿‡ä¸€ä¸ªå®ä¾‹äº†ï¼Œé‚£å°±å¯ä»¥ç›´æ¥å¾—åˆ°è¿™ä¸ªå®ä¾‹ï¼Œé¿å…å†æ¬¡é”ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ª checkçš„ä½œç”¨ã€‚ </p>
<p>ç¬¬äºŒä¸ªcheckæ˜¯è§£å†³é”ç«äº‰æƒ…å†µä¸‹çš„é—®é¢˜ï¼Œå‡è®¾ç°åœ¨ä¸¤ä¸ªçº¿ç¨‹æ¥è¯·æ±‚<code>GetInstance</code>ï¼ŒAã€Bçº¿ç¨‹åŒæ—¶å‘ç°<code>singleton</code>å®ä¾‹å¯¹è±¡ä¸ºç©ºï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡checkæ–¹æ³•ä¸Šæ²¡æœ‰åŠ é”ï¼Œç„¶åAçº¿ç¨‹ç‡å…ˆè·å¾—é”ï¼Œè¿›å…¥åŒæ­¥ä»£ç å—ï¼Œnewäº†ä¸€ä¸ª<code>singleton</code>å®ä¾‹å¯¹è±¡ï¼Œä¹‹åé‡Šæ”¾é”ï¼Œæ¥ç€Bçº¿ç¨‹è·å¾—äº†è¿™ä¸ªé”ï¼Œå‘ç°<code>singleton</code>å®ä¾‹å¯¹è±¡å·²ç»è¢«åˆ›å»ºäº†ï¼Œå°±ç›´æ¥é‡Šæ”¾é”ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—ã€‚æ‰€ä»¥è¿™å°±æ˜¯<code>Check-Lock-Check</code>; å°†ä¸Šé¢çš„<code>singleton</code>å®ä¾‹ç”¨<code>Check-Lock-Check</code>æœºåˆ¶å®ç°å¦‚ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> GetInstance() *singleton &#123;</span><br><span class="line">    <span class="keyword">if</span> instance == <span class="constant">nil</span> &#123; </span><br><span class="line">        mu.Lock()</span><br><span class="line">        <span class="keyword">defer</span> mu.Unlock()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> instance == <span class="constant">nil</span> &#123;</span><br><span class="line">	            instance = &amp;singleton&#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ä¸Šé¢çš„<code>Check-Lock-Check</code>æœºåˆ¶,çš„ç¡®å¯ä»¥è§£å†³é”ç«Ÿäº‰çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ä¸ç®¡æ˜¯å¦<code>singleton</code>å®ä¾‹å¯¹è±¡æ˜¯å¦å·²åˆ›å»ºï¼Œæ¯æ¬¡éƒ½è¦æ‰§è¡Œä¸¤æ¬¡checkæ‰æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ¤æ–­ï¼Œé‚£æœ‰æ²¡æœ‰æ–¹æ³•ä½¿å¾—åªè¦ä¸€æ¬¡checkå°±å¯ä»¥å®Œæˆå¯¹<code>singleton</code>å®ä¾‹å¯¹è±¡æ˜¯å¦å­˜åœ¨çš„æ£€æŸ¥å‘¢ï¼Ÿ æœ‰ï¼é€šè¿‡<code>golang</code>çš„<code>sync/atomic</code>åŒ…æä¾›çš„åŸå­æ€§æ“ä½œå¯ä»¥æ›´é«˜æ•ˆçš„å®Œæˆè¿™ä¸ªæ£€æŸ¥ï¼Œæ”¹è¿›ä»£ç å¦‚ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"sync"</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"sync/atomic"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> initialized <span class="typename">uint32</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> GetInstance() *singleton &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> atomic.LoadUInt32(&amp;initialized) == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> instance</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> mu.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> initialized == <span class="number">0</span> &#123;</span><br><span class="line">         instance = &amp;singleton&#123;&#125;</span><br><span class="line">         atomic.StoreUint32(&amp;initialized, <span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ”¹è¿›ä¹‹åçš„ä»£ç é€šè¿‡è®¾ç½®ä¸€ä¸ªæ ‡å¿—æ“ä½œï¼Œä½¿å¾—<code>singleton</code>å®ä¾‹å¯¹è±¡åˆ›å»ºä¹‹åï¼Œç›´æ¥é€šè¿‡åŸå­æ“ä½œè¯»å–æ ‡å¿—å­—æ®µçš„å€¼åˆ¤æ–­è¿”å›å·²ç»å­˜åœ¨çš„å®ä¾‹ï¼Œè¿é”æ“ä½œåŠå…¶åé¢çš„ä»£ç éƒ½ç•¥è¿‡äº†ã€‚</p>
<h2 id="u91C7_u7528atomic_u8FDB_u4E00_u6B65_u7B80_u5316"><a href="#u91C7_u7528atomic_u8FDB_u4E00_u6B65_u7B80_u5316" class="headerlink" title="é‡‡ç”¨atomicè¿›ä¸€æ­¥ç®€åŒ–"></a>é‡‡ç”¨atomicè¿›ä¸€æ­¥ç®€åŒ–</h2><p>ä¸Šé¢é€šè¿‡<code>Check-Lock-Check</code>æœºåˆ¶æ”¹è¿›ä¹‹åä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå¯åšçš„äº†ï¼Œå…ˆä¸æ€¥ï¼Œæ¥çœ‹çœ‹<code>golang</code>åŸç”Ÿæ ‡å‡†åŒ…<code>sync</code>åŒ…ä¸­å¯¹<code>Once</code>å®ç°çš„æºç ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Once is an object that will perform exactly one action.</span></span><br><span class="line"><span class="keyword">type</span> Once <span class="keyword">struct</span> &#123;</span><br><span class="line">	m    Mutex</span><br><span class="line">	done <span class="typename">uint32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do calls the function f if and only if Do is being called for the</span></span><br><span class="line"><span class="comment">// first time for this instance of Once. In other words, given</span></span><br><span class="line"><span class="comment">//	var once Once</span></span><br><span class="line"><span class="comment">// if once.Do(f) is called multiple times, only the first call will invoke f,</span></span><br><span class="line"><span class="comment">// even if f has a different value in each invocation.  A new instance of</span></span><br><span class="line"><span class="comment">// Once is required for each function to execute.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Do is intended for initialization that must be run exactly once.  Since f</span></span><br><span class="line"><span class="comment">// is niladic, it may be necessary to use a function literal to capture the</span></span><br><span class="line"><span class="comment">// arguments to a function to be invoked by Do:</span></span><br><span class="line"><span class="comment">//	config.once.Do(func() &#123; config.init(filename) &#125;)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Because no call to Do returns until the one call to f returns, if f causes</span></span><br><span class="line"><span class="comment">// Do to be called, it will deadlock.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// If f panics, Do considers it to have returned; future calls of Do return</span></span><br><span class="line"><span class="comment">// without calling f.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">func</span> (o *Once) Do(f <span class="keyword">func</span>()) &#123;</span><br><span class="line">	<span class="keyword">if</span> atomic.LoadUint32(&amp;o.done) == <span class="number">1</span> &#123; <span class="comment">// &lt;-- Check</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Slow-path.</span></span><br><span class="line">	o.m.Lock()                           <span class="comment">// &lt;-- Lock</span></span><br><span class="line">	<span class="keyword">defer</span> o.m.Unlock()</span><br><span class="line">	<span class="keyword">if</span> o.done == <span class="number">0</span> &#123;                     <span class="comment">// &lt;-- Check</span></span><br><span class="line">		<span class="keyword">defer</span> atomic.StoreUint32(&amp;o.done, <span class="number">1</span>)</span><br><span class="line">		f()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰å…¶å®æ˜¯å€Ÿé‰´äº†<code>golang</code>åŸç”Ÿæ ‡å‡†åŒ…<code>sync</code>ä¸­å¯¹<code>Once</code>å®ç°å¯¹æºç ï¼Œé‚£æ—¢ç„¶æ ‡å‡†åŒ…ä¸­å·²ç»å®ç°äº†è¿™ä¸ª<code>Check-Lock-Check</code>æœºåˆ¶ï¼Œé‚£æˆ‘ä»¬ç›´æ¥è°ƒç”¨<code>sync</code>åŒ…æä¾›<code>once.Do()</code>æ–¹æ³•å¯¹æŸä¸ªæ–¹æ³•åªè¿›è¡Œä¸€æ¬¡æ€§è°ƒç”¨ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">once.Do(<span class="keyword">func</span>() &#123;</span><br><span class="line">	 <span class="comment">// perform safe initialization here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‚£ä¹ˆä¸‹é¢æ˜¯æ ¹æ®<code>sync</code>åŒ…æä¾›çš„<code>sync.Once</code>æ”¹è¿›çš„è·å–<code>singleton</code>å®ä¾‹å¯¹è±¡æœ€ç»ˆä¼˜åŒ–ç‰ˆæœ¬:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> singleton <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance *singleton</span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> GetInstance() *singleton &#123;</span><br><span class="line">    once.Do(<span class="keyword">func</span>() &#123;</span><br><span class="line">        instance = &amp;singleton&#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å› æ­¤ä½¿ç”¨<code>sync</code>åŒ…æä¾›çš„<code>sync.Once</code>å®ç°è·å–<code>singleton</code>å®ä¾‹å¯¹è±¡å¯ä»¥è¯´æ˜¯æœ€å®‰å…¨æœ‰æ•ˆåˆç®€æ´çš„æ–¹æ³•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;&lt;code&gt;golang&lt;/code&gt; 1.5ç‰ˆæœ¬ä¹‹åé»˜è®¤è®¾ç½®&lt;code&gt;GOMAXPROCS&lt;/code&gt;å€¼ä¸ºå½“å‰è®¡ç®—æœºçœŸå®æ ¸å¿ƒæ•°ï¼Œä½¿å¾—&lt;code&gt;goroutines&lt;/code&gt;ä»é»˜è®¤çš„&lt;code&gt;å•çº¿ç¨‹å†…å¹¶å‘æ‰§è¡Œ&lt;/code&gt;å˜æˆäº†é»˜è®¤çš„ï¼ˆçœŸå®æ ¸å¿ƒæ•°æ”¯æŒçš„ï¼‰çš„&lt;code&gt;å¤šçº¿ç¨‹å†…å¹¶è¡Œ&lt;/code&gt;æ‰§è¡Œã€‚å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ&lt;code&gt;goroutines&lt;/code&gt;éœ€è¦è€ƒè™‘å¹¶è¡Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¼•å…¥çš„&lt;code&gt;çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/code&gt;ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="go-pattern" scheme="http://www.grdtechs.com/categories/go-pattern/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
      <category term="singleton" scheme="http://www.grdtechs.com/tags/singleton/"/>
    
  </entry>
  
  <entry>
    <title>golang å¹¶å‘å®‰å…¨æ€§æ¡ˆä¾‹åˆ†æ</title>
    <link href="http://www.grdtechs.com/2016/02/24/go-concurrency-security/"/>
    <id>http://www.grdtechs.com/2016/02/24/go-concurrency-security/</id>
    <published>2016-02-24T21:47:55.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><code>golang</code> åœ¨1.5ç‰ˆæœ¬ä¹‹å‰é»˜è®¤åªä½¿ç”¨ä¸€ä¸ªæ ¸å¿ƒæ¥è·‘æ‰€æœ‰çš„<code>goroutines</code>,å³<code>GOMAXPROCS</code>é»˜è®¤è®¾ç½®ä¸º1, ,å³æ˜¯ä¸²è¡Œæ‰§è¡Œ<code>goroutines</code>,åœ¨1.5ç‰ˆæœ¬åï¼Œ<code>GOMAXPROCS</code>é»˜è®¤è®¾ç½®ä¸ºå½“å‰è®¡ç®—æœºçœŸå®çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³æ˜¯åœ¨å¹¶è¡Œæ‰§è¡Œ<code>goroutines</code>ã€‚<br><a id="more"></a></p>
<h2 id="u5E76_u884C_u6267_u884C_u5B89_u5168_u6027_u6848_u4F8B_u5206_u6790"><a href="#u5E76_u884C_u6267_u884C_u5B89_u5168_u6027_u6848_u4F8B_u5206_u6790" class="headerlink" title="å¹¶è¡Œæ‰§è¡Œå®‰å…¨æ€§æ¡ˆä¾‹åˆ†æ"></a>å¹¶è¡Œæ‰§è¡Œå®‰å…¨æ€§æ¡ˆä¾‹åˆ†æ</h2><p>åˆ©ç”¨è®¡ç®—æœºå¤šæ ¸å¤„ç†çš„ç‰¹æ€§ï¼Œå¹¶è¡Œæ‰§è¡Œèƒ½æˆå€çš„æé«˜ç¨‹åºçš„æ€§èƒ½,ä½†åŒæ—¶ä¹Ÿå¸¦å…¥äº†æ•°æ®å®‰å…¨æ€§é—®é¢˜ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªåœ¨çº¿é“¶è¡Œè½¬è´¦çš„æ¡ˆä¾‹:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">		Cash <span class="typename">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (u *User) sendCash(to *User, amount <span class="typename">int</span>) <span class="typename">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> u.Cash &lt; amount &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="constant">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* è®¾ç½®å»¶è¿ŸSleepï¼Œå½“å¤šä¸ªgoroutineså¹¶è¡Œæ‰§è¡Œæ—¶,ä¾¿äºè¿›è¡Œæ•°æ®å®‰å…¨åˆ†æ */</span></span><br><span class="line">	time.Sleep(<span class="number">500</span> * time.Millisecond)</span><br><span class="line">	u.Cash = u.Cash - amount</span><br><span class="line">	to.Cash = to.Cash + amount</span><br><span class="line">	<span class="keyword">return</span> <span class="constant">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	me := User&#123;Cash: <span class="number">500</span>&#125;</span><br><span class="line">	you := User&#123;Cash: <span class="number">500</span>&#125;</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">		me.sendCash(&amp;you, <span class="number">50</span>) <span class="comment">//è½¬è´¦</span></span><br><span class="line">		fmt.Fprintf(w, <span class="string">"I have $%d\n"</span>, me.Cash)</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"You have $%d\n"</span>, you.Cash)</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"Total transferred: $%d\n"</span>, (you.Cash - <span class="number">500</span>))</span><br><span class="line">	&#125;)</span><br><span class="line">	http.ListenAndServe(<span class="string">":8080"</span>, <span class="constant">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„Go Webåº”ç”¨ï¼Œå®šä¹‰Useræ•°æ®ç»“æ„ï¼ŒsendCashæ˜¯åœ¨ä¸¤ä¸ªUserä¹‹é—´è½¬è´¦çš„æœåŠ¡ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯net/http åŒ…ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„HttpæœåŠ¡å™¨ï¼Œç„¶åå°†è¯·æ±‚è·¯ç”±åˆ°è½¬è´¦50å…ƒçš„sendCashæ–¹æ³•ï¼Œåœ¨æ­£å¸¸æ“ä½œä¸‹ï¼Œä»£ç ä¼šå¦‚æˆ‘ä»¬é¢„æ–™ä¸€æ ·è¿è¡Œï¼Œæ¯æ¬¡è½¬ç§»50ç¾é‡‘ï¼Œä¸€æ—¦ä¸€ä¸ªç”¨æˆ·çš„è´¦æˆ·ä½™é¢è¾¾åˆ°0ç¾é‡‘ï¼Œå°±ä¸èƒ½å†è¿›è¡Œè½¬å‡ºé’ç¥¨äº†ï¼Œå› ä¸ºæ²¡æœ‰é’±äº†ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¾ˆå¿«åœ°å‘é€å¾ˆå¤šè¯·æ±‚ï¼Œè¿™ä¸ªç¨‹åºä¼šç»§ç»­è½¬å‡ºå¾ˆå¤šé’±ï¼Œå¯¼è‡´è´¦æˆ·ä½™é¢ä¸ºè´Ÿæ•°ã€‚</p>
<p>è¿™æ˜¯è¯¾æœ¬ä¸Šç»å¸¸è°ˆåˆ°çš„ç«äº‰æƒ…å†µrace conditionï¼Œåœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œè´¦æˆ·ä½™é¢çš„æ£€æŸ¥æ˜¯ä¸ä»è´¦æˆ·ä¸­å–é’±æ“ä½œåˆ†ç¦»çš„ï¼Œæˆ‘ä»¬å‡æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚åˆšåˆšå®Œæˆè´¦æˆ·ä½™é¢æ£€æŸ¥ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å–é’±ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å‡å°‘è´¦æˆ·ä½™é¢æ•°å€¼ï¼›è€Œå¦å¤–ä¸€ä¸ªè¯·æ±‚çº¿ç¨‹åŒæ—¶ä¹Ÿæ£€æŸ¥è´¦æˆ·ä½™é¢ï¼Œå‘ç°è´¦æˆ·ä½™é¢è¿˜æ²¡æœ‰å‰©ä¸ºé›¶ï¼ˆç»“æœä¸¤ä¸ªè¯·æ±‚éƒ½ä¸€èµ·å–é’±ï¼Œå¯¼è‡´è´¦æˆ·ä½™é¢ä¸ºè´Ÿæ•°ï¼‰ï¼Œè¿™æ˜¯å…¸å‹çš„â€check-then-actâ€ç«äº‰æƒ…å†µã€‚è¿™æ˜¯å¾ˆæ™®éå­˜åœ¨çš„ å¹¶å‘ bugã€‚</p>
<h2 id="u7528_u9501_u89E3_u51B3_u7ADF_u6001_u6570_u636E_u5B89_u5168_u95EE_u9898"><a href="#u7528_u9501_u89E3_u51B3_u7ADF_u6001_u6570_u636E_u5B89_u5168_u95EE_u9898" class="headerlink" title="ç”¨é”è§£å†³ç«Ÿæ€æ•°æ®å®‰å…¨é—®é¢˜"></a>ç”¨é”è§£å†³ç«Ÿæ€æ•°æ®å®‰å…¨é—®é¢˜</h2><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬è‚¯å®šä¸èƒ½ç§»é™¤æ£€æŸ¥æ“ä½œï¼Œè€Œæ˜¯ç¡®ä¿æ£€æŸ¥å’Œå–é’±ä¸¤ä¸ªåŠ¨ä½œä¹‹é—´æ²¡æœ‰ä»»ä½•å…¶ä»–æ“ä½œå‘ç”Ÿï¼Œå…¶ä»–è¯­è¨€æ˜¯ä½¿ç”¨é”ï¼Œå½“è´¦æˆ·è¿›è¡Œæ›´æ–°æ—¶ï¼Œé”ä½ç¦æ­¢åŒæ—¶æœ‰å…¶ä»–çº¿ç¨‹æ“ä½œï¼Œç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªè¿›ç¨‹æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ’æ–¥é”Mutexã€‚,ä¸‹é¢ç”¨<code>golang</code>è‡ªå¸¦çš„<code>sync</code>åŒ…å®ç°å¯¹è½¬è´¦åˆ¤æ–­åŠæ•°æ®æ“ä½œè¿‡ç¨‹çš„åŠ é”ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">		Cash <span class="typename">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transferLock *sync.Mutex</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (u *User) sendCash(to *User, amount <span class="typename">int</span>) <span class="typename">bool</span> &#123;</span><br><span class="line"></span><br><span class="line">	transferLock.Lock() <span class="comment">//å¯¹è½¬è´¦æ“ä½œè¿›è¡ŒåŠ é”</span></span><br><span class="line">	<span class="keyword">defer</span> transferLock.Unlock() <span class="comment">//è½¬è´¦ç»“æŸåè§£é”é‡Šæ”¾èµ„æº</span></span><br><span class="line">	<span class="keyword">if</span> u.Cash &lt; amount &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="constant">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* è®¾ç½®å»¶è¿ŸSleepï¼Œå½“å¤šä¸ªgoroutineså¹¶è¡Œæ‰§è¡Œæ—¶,ä¾¿äºè¿›è¡Œæ•°æ®å®‰å…¨åˆ†æ */</span></span><br><span class="line">	time.Sleep(<span class="number">500</span> * time.Millisecond)</span><br><span class="line">	u.Cash = u.Cash - amount</span><br><span class="line">	to.Cash = to.Cash + amount</span><br><span class="line">	<span class="keyword">return</span> <span class="constant">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	me := User&#123;Cash: <span class="number">500</span>&#125;</span><br><span class="line">	you := User&#123;Cash: <span class="number">500</span>&#125;</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">		me.sendCash(&amp;you, <span class="number">50</span>) <span class="comment">//è½¬è´¦</span></span><br><span class="line">		fmt.Fprintf(w, <span class="string">"I have $%d\n"</span>, me.Cash)</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"You have $%d\n"</span>, you.Cash)</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"Total transferred: $%d\n"</span>, (you.Cash - <span class="number">500</span>))</span><br><span class="line">	&#125;)</span><br><span class="line">	http.ListenAndServe(<span class="string">":8080"</span>, <span class="constant">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="u5229_u7528Channel_2C_u66F4_u597D_u7684_u5B9E_u73B0_u5E76_u53D1"><a href="#u5229_u7528Channel_2C_u66F4_u597D_u7684_u5B9E_u73B0_u5E76_u53D1" class="headerlink" title="åˆ©ç”¨Channel,æ›´å¥½çš„å®ç°å¹¶å‘"></a>åˆ©ç”¨Channel,æ›´å¥½çš„å®ç°å¹¶å‘</h2><p>ä½†æ˜¯é”çš„é—®é¢˜å¾ˆæ˜¾ç„¶é™ä½äº†<code>ç¨‹åºå¹¶å‘çš„æ€§èƒ½</code>ï¼Œé”æ˜¯å¹¶å‘è®¾è®¡çš„æœ€å¤§æ•Œäººï¼Œåœ¨Goä¸­æ¨èä½¿ç”¨é€šé“<code>Channel</code>ï¼Œèƒ½å¤Ÿä½¿ç”¨äº‹ä»¶å¾ªç¯event loopæœºåˆ¶æ›´çµæ´»åœ°å®ç°å¹¶å‘;é€šè¿‡å§”æ‰˜ä¸€ä¸ªåå°åç¨‹ç›‘å¬é€šé“ï¼Œå½“é€šé“ä¸­æœ‰æ•°æ®æ—¶ï¼Œç«‹å³è¿›è¡Œè½¬è´¦æ“ä½œï¼Œå› ä¸ºåç¨‹æ˜¯é¡ºåºåœ°è¯»å–é€šé“ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å·§å¦™åœ°å›é¿äº†ç«äº‰æƒ…å†µï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨ä»»ä½•çŠ¶æ€å˜é‡é˜²æ­¢<code>å¹¶å‘</code>ç«äº‰äº†ã€‚ å…·ä½“ç¤ºä¾‹:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Cash <span class="typename">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Transfer <span class="keyword">struct</span> &#123;</span><br><span class="line">	Sender    *User</span><br><span class="line">	Recipient *User</span><br><span class="line">	Amount    <span class="typename">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> sendCashHandler(transferchan <span class="keyword">chan</span> Transfer) &#123;</span><br><span class="line">	<span class="keyword">var</span> val Transfer</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		val = &lt;-transferchan</span><br><span class="line">		val.Sender.sendCash(val.Recipient, val.Amount)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (u *User) sendCash(to *User, amount <span class="typename">int</span>) <span class="typename">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> u.Cash &lt; amount &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="constant">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* è®¾ç½®å»¶è¿ŸSleepï¼Œå½“å¤šä¸ªgoroutineså¹¶è¡Œæ‰§è¡Œæ—¶,ä¾¿äºè¿›è¡Œæ•°æ®å®‰å…¨åˆ†æ */</span></span><br><span class="line">	time.Sleep(<span class="number">500</span> * time.Millisecond)</span><br><span class="line">	u.Cash = u.Cash - amount</span><br><span class="line">	to.Cash = to.Cash + amount</span><br><span class="line">	<span class="keyword">return</span> <span class="constant">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	me := User&#123;Cash: <span class="number">500</span>&#125;</span><br><span class="line">	you := User&#123;Cash: <span class="number">500</span>&#125;</span><br><span class="line">	transferchan := <span class="built_in">make</span>(<span class="keyword">chan</span> Transfer)</span><br><span class="line">	<span class="keyword">go</span> sendCashHandler(transferchan)</span><br><span class="line">	http.HandleFunc(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">		transfer := Transfer&#123;Sender: &amp;me, Recipient: &amp;you, Amount: <span class="number">50</span>&#125;</span><br><span class="line">		transferchan &lt;- transfer</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"I have $%d\n"</span>, me.Cash)</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"You have $%d\n"</span>, you.Cash)</span><br><span class="line">		fmt.Fprintf(w, <span class="string">"Total transferred: $%d\n"</span>, (you.Cash - <span class="number">500</span>))</span><br><span class="line">	&#125;)</span><br><span class="line">	http.ListenAndServe(<span class="string">":8080"</span>, <span class="constant">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢è¿™æ®µä»£ç åˆ›å»ºäº†æ¯”è¾ƒå¯é çš„ç³»ç»Ÿä»è€Œé¿å…äº†<code>å¹¶å‘</code>ç«äº‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šå¸¦æ¥å¦å¤–ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼š<code>DoS(Denial of ServiceæœåŠ¡æ‹’ç»)</code>ï¼Œå¦‚æœæˆ‘ä»¬çš„è½¬è´¦æ“ä½œæ…¢ä¸‹æ¥ï¼Œé‚£ä¹ˆä¸æ–­è¿›æ¥çš„è¯·æ±‚éœ€è¦ç­‰å¾…è¿›è¡Œè½¬è´¦æ“ä½œçš„é‚£ä¸ªåç¨‹ä»é€šé“ä¸­è¯»å–æ–°æ•°æ®ï¼Œä½†æ˜¯è¿™ä¸ªçº¿ç¨‹å¿™äºç…§é¡¾è½¬è´¦æ“ä½œï¼Œæ²¡æœ‰é—²åŠŸå¤«è¯»å–é€šé“ä¸­æ–°æ•°æ®ï¼Œè¿™ä¸ªæƒ…å†µä¼šå¯¼è‡´ç³»ç»Ÿå®¹æ˜“é­å—<code>DoSæ”»å‡»</code>ï¼Œå¤–ç•Œåªè¦å‘é€å¤§é‡è¯·æ±‚å°±èƒ½è®©ç³»ç»Ÿåœæ­¢å“åº”ã€‚</p>
<h2 id="u796D_u51FAselect__u8FDB_u4E00_u6B65_u63D0_u5347_u6027_u80FD"><a href="#u796D_u51FAselect__u8FDB_u4E00_u6B65_u63D0_u5347_u6027_u80FD" class="headerlink" title="ç¥­å‡ºselect è¿›ä¸€æ­¥æå‡æ€§èƒ½"></a>ç¥­å‡ºselect è¿›ä¸€æ­¥æå‡æ€§èƒ½</h2><p>ä¸€äº›åŸºç¡€æœºåˆ¶æ¯”å¦‚buffered channelå¯ä»¥å¤„ç†è¿™ç§æƒ…å†µï¼Œä½†æ˜¯buffered channelæ˜¯æœ‰å†…å­˜ä¸Šé™çš„ï¼Œä¸è¶³å¤Ÿä¿å­˜æ‰€æœ‰è¯·æ±‚æ•°æ®ï¼Œä¼˜åŒ–è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨Goæ°å‡ºçš„<code>select</code>è¯­å¥ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http.HandleFunc(<span class="string">"/"</span>, <span class="keyword">func</span>(w http.ResponseWriter, r *http.Request) &#123;</span><br><span class="line">	 transfer := Transfer&#123;Sender: &amp;me, Recipient: &amp;you, Amount: <span class="number">50</span>&#125;</span><br><span class="line">	 <span class="comment">/*è½¬è´¦*/</span></span><br><span class="line">	 result := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="typename">int</span>)</span><br><span class="line">	 <span class="keyword">go</span> <span class="keyword">func</span>(transferchan <span class="keyword">chan</span>&lt;- Transfer, transfer Transfer, result <span class="keyword">chan</span>&lt;- <span class="typename">int</span>) &#123;</span><br><span class="line">	      transferchan &lt;- transfer</span><br><span class="line">	      result &lt;- <span class="number">1</span></span><br><span class="line">	 &#125;(transferchan, transfer, result)</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*ç”¨selectæ¥å¤„ç†è¶…æ—¶æœºåˆ¶*/</span>	 </span><br><span class="line">	 <span class="keyword">select</span> &#123;</span><br><span class="line">	   <span class="keyword">case</span> &lt;-result:</span><br><span class="line">	    fmt.Fprintf(w, <span class="string">"I have $%d\n"</span>, me.Cash)</span><br><span class="line">	    fmt.Fprintf(w, <span class="string">"You have $%d\n"</span>, you.Cash)</span><br><span class="line">	    fmt.Fprintf(w, <span class="string">"Total transferred: $%d\n"</span>, (you.Cash - <span class="number">500</span>))</span><br><span class="line">	  <span class="keyword">case</span> &lt;-time.After(time.Second * <span class="number">10</span>): <span class="comment">//è¶…æ—¶å¤„ç†</span></span><br><span class="line">	    fmt.Fprintf(w, <span class="string">"Your request has been received, but is processing slowly"</span>)</span><br><span class="line">	 &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæå‡äº†äº‹ä»¶å¾ªç¯ï¼Œç­‰å¾…ä¸èƒ½è¶…è¿‡10ç§’ï¼Œç­‰å¾…è¶…è¿‡timeoutæ—¶é—´ï¼Œä¼šè¿”å›ä¸€ä¸ªæ¶ˆæ¯ç»™Userå‘Šè¯‰å®ƒä»¬è¯·æ±‚å·²ç»æ¥å—ï¼Œå¯èƒ½ä¼šèŠ±ç‚¹æ—¶é—´å¤„ç†ï¼Œè¯·è€å¿ƒç­‰å€™å³å¯ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•æˆ‘ä»¬é™ä½äº†<code>DoSæ”»å‡»</code>å¯èƒ½ï¼Œä¸€ä¸ªçœŸæ­£å¥å£®çš„èƒ½å¤Ÿ<code>å¹¶å‘</code>å¤„ç†è½¬è´¦ä¸”æ²¡æœ‰ä½¿ç”¨ä»»ä½•é”çš„ç³»ç»Ÿè¯ç”Ÿäº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;&lt;code&gt;golang&lt;/code&gt; åœ¨1.5ç‰ˆæœ¬ä¹‹å‰é»˜è®¤åªä½¿ç”¨ä¸€ä¸ªæ ¸å¿ƒæ¥è·‘æ‰€æœ‰çš„&lt;code&gt;goroutines&lt;/code&gt;,å³&lt;code&gt;GOMAXPROCS&lt;/code&gt;é»˜è®¤è®¾ç½®ä¸º1, ,å³æ˜¯ä¸²è¡Œæ‰§è¡Œ&lt;code&gt;goroutines&lt;/code&gt;,åœ¨1.5ç‰ˆæœ¬åï¼Œ&lt;code&gt;GOMAXPROCS&lt;/code&gt;é»˜è®¤è®¾ç½®ä¸ºå½“å‰è®¡ç®—æœºçœŸå®çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³æ˜¯åœ¨å¹¶è¡Œæ‰§è¡Œ&lt;code&gt;goroutines&lt;/code&gt;ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="concurrency" scheme="http://www.grdtechs.com/tags/concurrency/"/>
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>golang å¹¶å‘concurrency ä½¿ç”¨æ€»ç»“</title>
    <link href="http://www.grdtechs.com/2016/02/17/go-concurrency-summarize/"/>
    <id>http://www.grdtechs.com/2016/02/17/go-concurrency-summarize/</id>
    <published>2016-02-17T13:47:51.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>goèƒ½å¤„ç†é«˜å¹¶å‘çš„æ ¹æœ¬åŸå› åœ¨äºæ‰§è¡Œgoåç¨‹åªéœ€æå°‘çš„æ ˆå†…å­˜(å¤§æ¦‚4~5KB),å¹¶ä¸”èƒ½æ ¹æ®éœ€è¦åŠ¨æ€å¢é•¿å’Œç¼©å‡å ç”¨çš„èµ„æºã€‚<br><a id="more"></a></p>
<h2 id="u9AD8_u5E76_u53D1_u7684_u672C_u8D28goroutine"><a href="#u9AD8_u5E76_u53D1_u7684_u672C_u8D28goroutine" class="headerlink" title="é«˜å¹¶å‘çš„æœ¬è´¨goroutine"></a>é«˜å¹¶å‘çš„æœ¬è´¨goroutine</h2><p>ç®€å•è€Œè¨€,<code>goroutine</code>å°±æ˜¯ä¸€æ®µä»£ç ï¼Œä¸€ä¸ªå‡½æ•°å…¥å£ï¼Œä»¥åŠåœ¨å †ä¸Šä¸ºå…¶åˆ†é…çš„ä¸€ä¸ªå †æ ˆã€‚æ‰€ä»¥å®ƒéå¸¸å»‰ä»·ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾çš„åˆ›å»ºä¸Šä¸‡ä¸ª<code>goroutine</code>ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯è¢«æ“ä½œç³»ç»Ÿæ‰€è°ƒåº¦æ‰§è¡Œ,è€Œæ˜¯é€šè¿‡ç³»ç»Ÿçš„çº¿ç¨‹æ¥å¤šè·¯æ´¾é£è¿™äº›å‡½æ•°çš„æ‰§è¡Œï¼Œä½¿å¾—æ¯ä¸ªç”¨goå…³é”®å­—æ‰§è¡Œçš„å‡½æ•°å¯ä»¥è¿è¡Œæˆä¸ºä¸€ä¸ªå•ä½åç¨‹ã€‚å½“ä¸€ä¸ªåç¨‹é˜»å¡çš„æ—¶å€™ï¼Œè°ƒåº¦å™¨å°±ä¼šè‡ªåŠ¨æŠŠå…¶ä»–åç¨‹å®‰æ’åˆ°å¦å¤–çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œï¼Œä»è€Œå®ç°äº†ç¨‹åºæ— ç­‰å¾…å¹¶è¡ŒåŒ–è¿è¡Œã€‚è€Œä¸”è°ƒåº¦çš„å¼€é”€éå¸¸å°ï¼Œä¸€é¢—CPUè°ƒåº¦çš„è§„æ¨¡ä¸ä¸‹äºæ¯ç§’ç™¾ä¸‡æ¬¡ï¼Œè¿™ä½¿å¾—åœ¨ç¨‹åºä¸­èƒ½å¤Ÿåˆ›å»ºå¤§é‡çš„<code>goroutine</code>ï¼Œå®ç°é«˜å¹¶å‘çš„åŒæ—¶ï¼Œä¾æ—§èƒ½ä¿æŒé«˜æ€§èƒ½ã€‚<br><code>goroutine</code>æ˜¯é€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜,goä¸­æ˜¯é€šè¿‡<code>Channel</code>æ¥å®ç°é€šä¿¡çš„ï¼Œ<code>Channel</code>æœ¬èº«å°±åƒä¸€æ ¹ç®¡é“ï¼Œgoå°±é€šè¿‡è¿™æ ¹ç®¡é“è¿›è¡Œæ•°æ®çš„ä¼ é€’,å®ç°æ¶ˆæ¯é€šä¿¡ã€‚å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="typename">bool</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="keyword">func</span>() &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Go concurrency"</span>)</span><br><span class="line">	c &lt;- <span class="constant">true</span></span><br><span class="line">	<span class="built_in">close</span>(c)</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>  v := <span class="keyword">range</span> c &#123;</span><br><span class="line">	fmt.Println(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>ä¸Šé¢çš„ä»£ç é¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>bool</code>çš„<code>Channel</code>å¯¹è±¡<code>c</code>,ç„¶åé€šè¿‡<code>go</code>å…³é”®å­—æ‰§è¡Œä¸€ä¸ª<code>goroutine</code>,ç´§æ¥ç€æ‰§è¡Œä¸€ä¸ª<code>for</code>å¾ªç¯;<code>for</code>ä¼šå¾ªç¯å»è¯»å–<code>c</code>ä¸­çš„å€¼ï¼Œå¦‚æœè¯»å–åˆ°å€¼ï¼Œåˆ™æ‰§è¡Œ<code>for</code>å¾ªç¯ä½“ï¼ˆæ‰“å°vçš„å€¼ï¼‰ï¼Œæ²¡è¯»å–åˆ°åˆ™<code>for</code>è¢«é˜»å¡ç­‰å¾…,ç›´åˆ°è¯»å–åˆ°<code>c</code>ä¸­çš„å€¼å†å»æ‰§è¡Œ<code>for</code>å¾ªç¯ä½“ç„¶åç»§ç»­å¾ªç¯è¯»å–<code>c</code>ï¼Œå¦‚æœæ‰§è¡Œäº†<code>close(c)</code>æŠŠ<code>Channel</code>å¯¹è±¡<code>c</code>å…³é—­äº†ï¼Œé‚£<code>for</code>å¾ªç¯å°±é€€å‡ºä¸æ‰§è¡Œäº†ã€‚ è¿™å°±æ˜¯é€šè¿‡<code>Channel</code>é€šä¿¡æ‰§è¡Œ<code>goroutine</code>çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚</li>
<li><p>ä¸Šé¢é€šè¿‡makeè¿™æ ·åˆå§‹åŒ–çš„<code>Channel</code>å¯¹è±¡<code>c</code>æ˜¯æ—¢å¯ä»¥å†™åˆå¯ä»¥è¢«è¯»å–çš„åŒå‘é€šé“, æœ‰æ—¶å€™ä¸ºäº†é¿å…è¢«è¯¯è¯»è¯¯å†™æ“ä½œï¼Œå¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªå•å‘çš„<code>Channel</code>å¯¹è±¡ã€‚é€šè¿‡è®¾ç½®<code>Channel</code>çš„é•¿åº¦å¯ä»¥åˆ†ä¸ºæœ‰ç¼“å†²å’Œæ— ç¼“å†²ä¸¤ç§<code>Channel</code>,æ— ç¼“å†²åŒºçš„<code>Channel</code>,åœ¨ç­‰å¾…è¯»æˆ–ç­‰å¾…å†™çš„è¿‡ç¨‹ä¸­éƒ½ä¼šå¼•èµ·<code>åŒæ­¥é˜»å¡</code>ï¼Œè€Œæœ‰ç¼“å†²åŒºçš„<code>Channel</code>,å¯ä»¥çœ‹ä½œ<code>å¼‚æ­¥æ‰§è¡Œ</code>,ä¹Ÿå¯ä»¥è®¤ä¸ºæ§åˆ¶ä¸º<code>åŒæ­¥æ‰§è¡Œ</code>ï¼Œåªæœ‰å½“ç¼“å†²åŒºè¢«å ç”¨å®Œäº†ä¹‹åæ‰ä¼šå¼•èµ·<code>é˜»å¡</code>ã€‚</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="typename">int</span>, <span class="number">3</span>)  <span class="comment">//åˆå§‹åŒ–ç¼“å†²åŒºé•¿åº¦ä¸º3çš„Channel</span></span><br><span class="line"><span class="keyword">var</span> send <span class="keyword">chan</span>&lt;- <span class="typename">int</span> = c <span class="comment">//åªå†™å…¥çš„Channel</span></span><br><span class="line"><span class="keyword">var</span> recv &lt;-<span class="keyword">chan</span> <span class="typename">int</span> = c <span class="comment">//åªè¯»å–çš„Channel</span></span><br></pre></td></tr></table></figure>
<p>  <strong> æ³¨æ„: </strong>  åªè¯»æˆ–åªå†™çš„å•å‘<code>Channel</code> éƒ½éœ€è¦å€ŸåŠ©å…¶å®ƒ<code>Channel</code>æ‰æœ‰å®é™…æ„ä¹‰ï¼Œå®šä¹‰ä¸€ä¸ªåªå†™å…¥ä½†æ˜¯è¯»å–ä¸å‡ºæ¥çš„<code>Channel</code>æ²¡æœ‰ä»»ä½•ç”¨å¤„ã€‚å•å‘<code>Channel</code>ç”¨ä½œå‡½æ•°å½¢å‚ç”¨äºé˜²æ­¢å‚æ•°åœ¨å‡½æ•°å†…éƒ¨è¢«è¯¯è¯»è¯¯å†™æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p>
</li>
</ul>
<h2 id="u5F00_u542F_u591A_u6838_u5E76_u884C_u5E76_u53D1_u6267_u884C"><a href="#u5F00_u542F_u591A_u6838_u5E76_u884C_u5E76_u53D1_u6267_u884C" class="headerlink" title="å¼€å¯å¤šæ ¸å¹¶è¡Œå¹¶å‘æ‰§è¡Œ"></a>å¼€å¯å¤šæ ¸å¹¶è¡Œå¹¶å‘æ‰§è¡Œ</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œgoæ‰€æœ‰çš„<code>goroutines</code>æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åŒæ—¶åˆ©ç”¨å¤šæ ¸è¿›è¡Œå¹¶è¡Œæ‰§è¡Œï¼Œæˆ–è€…é€šè¿‡åˆ‡æ¢æ—¶é—´ç‰‡è®©å‡ºCPUè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚ä¸‹é¢çœ‹ä¸€æ®µç¤ºä¾‹ï¼š<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	runtime.GOMAXPROCS(runtime.NumCPU())</span><br><span class="line">	wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">	wg.Add(<span class="number">3</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> GoPrint(&amp;wg)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> GoPrint(wg *sync.WaitGroup) &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		fmt.Printf(<span class="string">"%d "</span>, i)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç›®å‰åªæœ‰æ˜¾ç¤ºè®¾ç½®äº†<code>runtime.GOMAXPROCS</code>,goæ‰ä¼šå¼€å¯å¤šæ ¸å¹¶è¡Œæ‰§è¡Œ<code>goroutines</code>, å¦‚æœåœ¨<code>GoPrint</code>æ–¹æ³•ä¸­ä¸åŠ å…¥<code>time.Sleep</code>ï¼Œè¾“å‡ºçš„ç»“æœå°†ä¼šæ˜¯<code>0 1 2 0 1 2 0 1 2</code>ï¼Œå¦‚æœå½“å‰<code>goroutine</code>ä¸å‘ç”Ÿé˜»å¡ï¼Œå®ƒæ˜¯ä¸ä¼šè®©å‡ºCPUç»™å…¶ä»–<code>goroutine</code>çš„, æ‰€ä»¥åœ¨<code>GoPrint</code>ä¸­ä¸åŠ <code>time.Sleep</code>,è¾“å‡ºä¼šæ˜¯ä¸€ä¸ªä¸€ä¸ª<code>goroutine</code>è¿›è¡Œçš„ï¼Œè€Œsleepå‡½æ•°åˆ™é˜»å¡æ‰äº† å½“å‰<code>goroutine</code>, å½“å‰<code>goroutine</code>ä¸»åŠ¨è®©å…¶ä»–<code>goroutine</code>æ‰§è¡Œ, æ‰€ä»¥å½¢æˆäº†é€»è¾‘ä¸Šçš„å¹¶è¡Œ, ä¹Ÿå°±æ˜¯å¹¶å‘ã€‚</p>
<h2 id="go_u5E76_u53D1_u6267_u884C_u5B89_u5168_u95EE_u9898"><a href="#go_u5E76_u53D1_u6267_u884C_u5B89_u5168_u95EE_u9898" class="headerlink" title="goå¹¶å‘æ‰§è¡Œå®‰å…¨é—®é¢˜"></a>goå¹¶å‘æ‰§è¡Œå®‰å…¨é—®é¢˜</h2><p>goå¹¶å‘æ‰§è¡Œå½“å¤šä¸ª<code>goroutine</code>åŒæ—¶è®¿é—®ä¸€ä¸ªå…±æœ‰çš„èµ„æºæ—¶ï¼Œåœ¨ä¸åŠ é”çš„æƒ…å†µå¾ˆå®¹æ˜“å‡ºè¡Œæ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ï¼Œçœ‹ä¸€ç¤ºä¾‹:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> sell_tickets(wg *sync.WaitGroup, i <span class="typename">int</span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> total_tickets &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">		mutex.Lock()</span><br><span class="line">		<span class="comment">// å¦‚æœæœ‰ç¥¨å°±å–</span></span><br><span class="line">		<span class="keyword">if</span> total_tickets &gt; <span class="number">0</span> &#123;</span><br><span class="line">			time.Sleep(time.Duration(rand.Intn(<span class="number">5</span>)) * time.Millisecond)</span><br><span class="line">			<span class="comment">// å–ä¸€å¼ ç¥¨</span></span><br><span class="line">			total_tickets--</span><br><span class="line">			fmt.Println(<span class="string">"id:"</span>, i, <span class="string">" ticket:"</span>, total_tickets)</span><br><span class="line">		&#125;</span><br><span class="line">		mutex.Unlock()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªå¤š<code>goroutine</code>å¹¶å‘ä¹°ç¥¨çš„é—®é¢˜ï¼Œæ¯”å¦‚å½“å¼€å¯5ä¸ª<code>goroutine</code>æ¥å–100å¼ ç¥¨ï¼Œå¦‚æœä¸åŠ é”ï¼Œåˆ™æœ‰å¯èƒ½ä¼šå‡ºè¡Œå¤šå‡ºä¸€äº›ä¸å­˜åœ¨çš„ç¥¨çš„é—®é¢˜ã€‚æ‰€ä»¥å½“å¹¶å‘è®¿é—®å…¬æœ‰èµ„æºæ—¶è¦æ³¨æ„åŠ é”ä¿æŠ¤å…¬æœ‰èµ„æºå±æ€§ä¿®æ”¹çš„å”¯ä¸€æ€§å’Œè®¿é—®æ—¶æ•°æ®åŒæ­¥é—®é¢˜ã€‚<br><a href="https://github.com/researchlab/golearning/blob/master/concurrency/concurrency_sync_mutex.go" target="_blank" rel="external">ç¤ºä¾‹ä»£ç </a></p>
<h2 id="u6279_u91CF_u5904_u7406_u591A_u4E2AChannel_u64CD_u4F5C"><a href="#u6279_u91CF_u5904_u7406_u591A_u4E2AChannel_u64CD_u4F5C" class="headerlink" title="æ‰¹é‡å¤„ç†å¤šä¸ªChannelæ“ä½œ"></a>æ‰¹é‡å¤„ç†å¤šä¸ªChannelæ“ä½œ</h2><p>goé€šè¿‡<code>Select</code>å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ª<code>Channel</code>,<code>Select</code>é»˜è®¤æ˜¯é˜»å¡çš„ï¼Œåªæœ‰å½“ç›‘å¬çš„<code>Channel</code>ä¸­æœ‰å‘é€æˆ–æ¥æ”¶å¯ä»¥è¿›è¡Œæ—¶æ‰ä¼šè¿è¡Œ,å½“åŒæ—¶æœ‰å¤šä¸ªå¯ç”¨çš„<code>Channel</code>,<code>Select</code>æŒ‰éšæœºé¡ºåºè¿›è¡Œå¤„ç†,<code>Select</code>å¯ä»¥æ–¹ä¾¿å¤„ç†å¤š<code>Channel</code>åŒæ—¶å“åº”ï¼Œåœ¨goroutineé˜»å¡çš„æƒ…å†µä¹Ÿå¯ä»¥æ–¹ä¾¿å€ŸåŠ©<code>Select</code>è¶…æ—¶æœºåˆ¶æ¥è§£é™¤é˜»å¡åƒµå±€ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> getHttpRes(url <span class="typename">string</span>) (<span class="typename">string</span>, error) &#123;</span><br><span class="line">	res := <span class="built_in">make</span>(<span class="keyword">chan</span> *http.Response, <span class="number">1</span>)</span><br><span class="line">	httpError := <span class="built_in">make</span>(<span class="keyword">chan</span> *error)</span><br><span class="line">	<span class="keyword">go</span> <span class="keyword">func</span>() &#123;</span><br><span class="line">		resp, err := http.Get(url)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="constant">nil</span> &#123;</span><br><span class="line">			httpError &lt;- &amp;err</span><br><span class="line">		&#125;</span><br><span class="line">		res &lt;- resp</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> r := &lt;-res:</span><br><span class="line">			result, err := ioutil.ReadAll(r.Body)</span><br><span class="line">			<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">			<span class="keyword">return</span> <span class="typename">string</span>(result), err</span><br><span class="line">		<span class="keyword">case</span> err := &lt;-httpError:</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"err"</span>, *err</span><br><span class="line">		<span class="keyword">case</span> &lt;-time.After(<span class="number">2000</span> * time.Millisecond):</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"Timed out"</span>, errors.New(<span class="string">"Timed out"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‘èµ·httpè¯·æ±‚ä¹‹åé€šå¸¸ä¼šæœ‰ä¸‰ç§çŠ¶å†µ:1.è®¿é—®æˆåŠŸï¼Œè¿”å›å†…å®¹å€¼;2.è®¿é—®å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯;3.è®¿é—®è¶…æ—¶ï¼Œè¿”å›è¶…æ—¶ã€‚ä¸Šé¢çš„ä»£ç ä¸­åˆ©ç”¨<code>Select</code>å¾ˆæ–¹ä¾¿çš„å¤„ç†äº†goå¹¶å‘æ‰§è¡Œä¸­å¤šå¯ç”¨<code>Channel</code>çš„å¤„ç†é—®é¢˜ï¼Œé€šè¿‡è®¾ç½®è¶…æ—¶ï¼Œå¸®åŠ©ç¨‹åºè·³å‡ºè¶…æ—¶ç­‰å¾…çš„åƒµå±€ã€‚<br><a href="https://github.com/researchlab/golearning/blob/master/concurrency/select_timeout.go" target="_blank" rel="external">ç¤ºä¾‹ä»£ç </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;goèƒ½å¤„ç†é«˜å¹¶å‘çš„æ ¹æœ¬åŸå› åœ¨äºæ‰§è¡Œgoåç¨‹åªéœ€æå°‘çš„æ ˆå†…å­˜(å¤§æ¦‚4~5KB),å¹¶ä¸”èƒ½æ ¹æ®éœ€è¦åŠ¨æ€å¢é•¿å’Œç¼©å‡å ç”¨çš„èµ„æºã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="concurrency" scheme="http://www.grdtechs.com/tags/concurrency/"/>
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>golang reflectä½¿ç”¨æ€»ç»“</title>
    <link href="http://www.grdtechs.com/2016/02/17/go-reflect-summarize/"/>
    <id>http://www.grdtechs.com/2016/02/17/go-reflect-summarize/</id>
    <published>2016-02-17T08:57:59.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åå°„æ˜¯ä¸€ç§æ£€æŸ¥å­˜å‚¨åœ¨æ¥å£å˜é‡ä¸­çš„<code>&lt;å€¼,ç±»å‹&gt;</code>å¯¹çš„æœºåˆ¶ï¼Œå€ŸåŠ©goåå°„åŒ…æä¾›çš„<code>reflect.TypeOf</code>å’Œ<code>reflect.ValueOf</code>å¯ä»¥æ–¹ä¾¿çš„è®¿é—®åˆ°ä¸€ä¸ªæ¥å£å€¼çš„<code>reflect.Type</code>å’Œ<code>reflect.Value</code>éƒ¨åˆ†ï¼Œä»è€Œå¯è¿›ä¸€æ­¥å¾—åˆ°è¿™ä¸ªæ¥å£çš„ç»“æ„ç±»å‹å’Œå¯¹å…¶è¿›è¡Œå€¼çš„ä¿®æ”¹æ“ä½œã€‚<br><a id="more"></a></p>
<h2 id="u53CD_u5C04_u7684_u4F7F_u7528"><a href="#u53CD_u5C04_u7684_u4F7F_u7528" class="headerlink" title="åå°„çš„ä½¿ç”¨"></a>åå°„çš„ä½¿ç”¨</h2><ol>
<li><p><strong>è·å–æ¥å£å¯¹è±¡çš„å­—æ®µ,ç±»å‹å’Œæ–¹æ³•ä¿¡æ¯</strong><br>å…ˆå®šä¹‰ä¸ªé€šç”¨çš„ç»“æ„ä½“</p>
<pre><code>type User struct{
    Id int
    Name string
    Age int
}
</code></pre><p>å°†æ¥å£å¯¹è±¡ç±»å‹ä¿¡æ¯æ˜ å°„ä¸ºåå°„ç±»å‹ä¿¡æ¯</p>
<pre><code class="golang"><span class="keyword">func</span> Info(o <span class="keyword">interface</span>{}) {
    t := reflect.TypeOf(o)         <span class="comment">//è·å–æ¥å£çš„ç±»å‹</span>
    fmt.Println(<span class="string">"Type:"</span>, t.Name()) <span class="comment">//t.Name() è·å–æ¥å£çš„åç§°</span>

    <span class="keyword">if</span> t.Kind() != refelct.Struct { <span class="comment">//é€šè¿‡Kind()æ¥åˆ¤æ–­åå°„å‡ºçš„ç±»å‹æ˜¯å¦ä¸ºéœ€è¦çš„ç±»å‹</span>
        fmt.Println(<span class="string">"err: type invalid!"</span>)        
        <span class="keyword">return</span>
    }        

    v := reflect.ValueOf(o) <span class="comment">//è·å–æ¥å£çš„å€¼ç±»å‹</span>
    fmt.Println(<span class="string">"Fields:"</span>)

    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ { <span class="comment">//NumFieldå–å‡ºè¿™ä¸ªæ¥å£æ‰€æœ‰çš„å­—æ®µæ•°é‡</span>
    f := t.Field(i)                                   <span class="comment">//å–å¾—ç»“æ„ä½“çš„ç¬¬iä¸ªå­—æ®µ</span>
    val := v.Field(i).Interface()                     <span class="comment">//å–å¾—å­—æ®µçš„å€¼</span>
    fmt.Printf(<span class="string">"%6s: %v = %v\n"</span>, f.Name, f.Type, val) <span class="comment">//ç¬¬iä¸ªå­—æ®µçš„åç§°,ç±»å‹,å€¼</span>
    }

    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumMethod(); i++{
        m := t.Method(i)
        fmt.Printf(<span class="string">"%6s: %v\n"</span>, m.Name,m.Type) <span class="comment">//è·å–æ–¹æ³•çš„åç§°å’Œç±»å‹       </span>
    }
}
</code></pre>
<p>è·å–æ¥å£å¯¹è±¡çš„ç±»å‹åç§°ï¼Œé€šè¿‡<code>refelct.TypeOf()</code>è·å–æ¥å£å¯¹è±¡çš„ç±»å‹,å¹¶é€šè¿‡<code>Name()</code>æ–¹æ³•è·å–æ¥å£çš„åç§°ã€‚<br>è·å–å¯¹è±¡ä¸­æ‰€æœ‰å­—æ®µçš„åç§°,ç±»å‹å’Œå€¼,é€šè¿‡<code>reflect.ValueOf()</code>è·å–æ¥å£å¯¹è±¡çš„å€¼ç±»å‹å–å¾—å­—æ®µçš„åç§°å’Œç±»å‹,ç„¶åé€šè¿‡<code>v.Field(i).Interface()</code>å–å¾—ç¬¬iä¸ªå­—æ®µçš„å€¼ã€‚<br>è¿˜å¯ä»¥é€šè¿‡<code>NumMethod()</code>å¾ªç¯è·å–æ¥å£å¯¹è±¡æ‰€æœ‰æ–¹æ³•çš„åç§°å’Œç±»å‹ã€‚<br><a href="https://github.com/researchlab/golearning/blob/master/reflect/01reflect.go" target="_blank" rel="external">ç¤ºä¾‹ä»£ç </a></p>
</li>
<li><p><strong>åå°„æ¥å£å¯¹è±¡ä¸­çš„åŒ¿åæˆ–åµŒå…¥å­—æ®µä¿¡æ¯</strong><br>å…ˆå†æ·»åŠ ä¸€ä¸ªManagerç»“æ„,Userä½œä¸ºå®ƒçš„åŒ¿åå­—æ®µ</p>
<pre><code>type Manager struct{
    User
    title string
}
</code></pre><p>åˆå§‹åŒ–Managerçš„ä¸¤ç§æ–¹æ³•ï¼š</p>
<pre><code>m0 := Manager{User: User{1,&quot;Mike&quot;,11},title: &quot;Man&quot;}
m1 := Manager{User{1,&quot;Mike&quot;,11},&quot;Man&quot;} //è¿™ç§åˆå§‹åŒ–,èµ‹å€¼é¡ºåºå¿…é¡»å’Œç»“æ„ä½“ä¸­çš„å£°æ˜é¡ºåºç›¸åŒ! 
</code></pre><p>ç°åœ¨å¦‚ä½•æ¥å–å‡ºManagerä¸­çš„åŒ¿åå­—æ®µUserï¼Ÿ</p>
<pre><code>t := refelct.TypeOf(m)
fmt.Printf(&quot;%#v\n&quot;, t.Field(0))
</code></pre><p>å¦‚ä¸Šè¿°ä»£ç ï¼Œé€šè¿‡<code>t := refelct.TypeOf(m)</code>å°†Managerçš„å­—æ®µç±»å‹å–å‡ºæ¥,åœ¨åå°„ä¸­å¯¹è±¡å­—æ®µæ˜¯é€šè¿‡ç´¢å¼•å–åˆ°çš„ï¼Œæ‰€ä»¥å¯é€šè¿‡<code>t.Field(0)</code>,</p>
<pre><code>#reflect.StructField{Name:&quot;User&quot;, PkgPath:&quot;&quot;, Type:(*reflect.rtype)(0xedd20), Tag:&quot;&quot;, Offset:0x0, Index:[]int{0}, Anonymous:true}
</code></pre><p>è¿˜å¯ä»¥é€šè¿‡<code>FieldByIndex</code>å’Œ<code>FieldByName</code>ä¸¤ç§æ–¹æ³•å–å¾—åŒ¿åç»“æ„ä½“ä¸­çš„å­—æ®µå±æ€§</p>
<ol>
<li>ç»™<code>FieldByIndex()</code>ä¼ å…¥ä¸€ä¸ªintå‹çš„sliceç´¢å¼•,å¦‚<code>FieldByIndex([]int{0,0})</code>å³å–å¾—Userç»“æ„ä½“ä¸­çš„Idå­—æ®µã€‚</li>
<li>é€šè¿‡<code>FieldByName(&quot;Id&quot;)</code>ä¹Ÿå¯ä»¥å–å¾—Userç»“æ„ä½“ä¸­Idå­—æ®µã€‚</li>
</ol>
</li>
</ol>
<h2 id="u901A_u8FC7_u53CD_u5C04_u4FEE_u6539_u5BF9_u8C61"><a href="#u901A_u8FC7_u53CD_u5C04_u4FEE_u6539_u5BF9_u8C61" class="headerlink" title="é€šè¿‡åå°„ä¿®æ”¹å¯¹è±¡"></a>é€šè¿‡åå°„ä¿®æ”¹å¯¹è±¡</h2><p>ä¸Šé¢é€šè¿‡<code>reflect.TypeOf</code>å’Œ<code>reflect.ValueOf</code>å·²ç»å¯ä»¥å¾—åˆ°æ¥å£å¯¹è±¡çš„ç±»å‹,å­—æ®µå’Œæ–¹æ³•ç­‰å±æ€§äº†ï¼Œæ€ä¹ˆé€šè¿‡åå°„æ¥ä¿®æ”¹å¯¹è±¡çš„å­—æ®µå€¼ï¼Ÿ</p>
<pre><code>x := 100
v := refelct.ValueOf(&amp;x) //ä¼ å…¥åœ°å€
v.Elem().SetInt(200) //æˆåŠŸä¿®æ”¹xå€¼ä¸º200
</code></pre><p>è¦ä¿®æ”¹å˜é‡xçš„å€¼ï¼Œé¦–å…ˆå°±è¦é€šè¿‡<code>reflect.ValueOf</code>æ¥è·å–xçš„å€¼ç±»å‹,<code>refelct.ValueOf</code>è¿”å›çš„å€¼ç±»å‹æ˜¯å˜é‡xä¸€ä»½å€¼æ‹·è´,è¦ä¿®æ”¹å˜é‡xå°±è¦ä¼ é€’xçš„åœ°å€,ä»è€Œè¿”å›xçš„åœ°å€å¯¹è±¡,æ‰å¯ä»¥è¿›è¡Œå¯¹xå˜é‡å€¼å¯¹ä¿®æ”¹æ“ä½œã€‚åœ¨å¾—åˆ°xå˜é‡çš„åœ°å€å€¼ç±»å‹ä¹‹åå…ˆè°ƒç”¨<code>Elem()</code>è¿”å›åœ°å€æŒ‡é’ˆæŒ‡å‘çš„å€¼çš„Valueå°è£…ã€‚ç„¶åé€šè¿‡<code>Set</code>æ–¹æ³•è¿›è¡Œä¿®æ”¹èµ‹å€¼ã€‚<br>é€šè¿‡åå°„å¯ä»¥å¾ˆå®¹æ˜“çš„ä¿®æ”¹å˜é‡çš„å€¼ï¼Œæ€ä¹ˆæ¥ä¿®æ”¹ç»“æ„ä½“ä¸­çš„å­—æ®µå€¼ï¼Ÿ</p>
<pre><code>func SetInfo(o interface{}) {
        v := reflect.ValueOf(o)

        if v.Kind() == reflect.Ptr &amp;&amp; !v.Elem().CanSet() { //åˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡é’ˆç±»å‹ å…ƒç´ æ˜¯å¦å¯ä»¥ä¿®æ”¹
            fmt.Println(&quot;cannot set&quot;)
                return
        } else {
            v = v.Elem() //å®é™…å–å¾—çš„å¯¹è±¡
        }

        //åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨
        f := v.FieldByName(&quot;Name&quot;)
        if !f.IsValid() {
            fmt.Println(&quot;wuxiao&quot;)
                return
        }

        //è®¾ç½®å­—æ®µ
        if f := v.FieldByName(&quot;Name&quot;); f.Kind() == reflect.String {
            f.SetString(&quot;BY&quot;)
        }
}
</code></pre><p>è¦æˆåŠŸä¿®æ”¹ç»“æ„ä½“ä¸­çš„æŸä¸ªå­—æ®µ,ä¸»è¦è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>é¦–å…ˆè¦åå°„å‡ºè¿™ä¸ªå­—æ®µçš„åœ°å€å€¼ç±»å‹;</li>
<li>åˆ¤æ–­åå°„è¿”å›ç±»å‹æ˜¯å¦ä¸º<code>reflect.Ptr</code>æŒ‡é’ˆç±»å‹ï¼ˆé€šè¿‡æŒ‡é’ˆæ‰èƒ½æ“ä½œå¯¹è±¡åœ°å€ä¸­çš„å€¼)åŒæ—¶è¿˜è¦åˆ¤æ–­è¿™ä¸ªå…ƒç´ æ˜¯å¦å¯ä»¥ä¿®æ”¹;</li>
<li>é€šè¿‡<code>FieldByName</code>çš„è¿”å›å€¼åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</li>
<li>é€šè¿‡<code>Kind()</code>å’Œ<code>Set</code>æ¥ä¿®æ”¹å­—æ®µçš„å€¼<br><a href="https://github.com/researchlab/golearning/blob/master/reflect/02reflect.go" target="_blank" rel="external">ç¤ºä¾‹ä»£ç </a></li>
</ol>
<h2 id="u901A_u8FC7_u53CD_u5C04_u201C_u52A8_u6001_u201D_u8C03_u7528_u65B9_u6CD5"><a href="#u901A_u8FC7_u53CD_u5C04_u201C_u52A8_u6001_u201D_u8C03_u7528_u65B9_u6CD5" class="headerlink" title="é€šè¿‡åå°„â€œåŠ¨æ€â€è°ƒç”¨æ–¹æ³•"></a>é€šè¿‡åå°„â€œåŠ¨æ€â€è°ƒç”¨æ–¹æ³•</h2><p>ç°åœ¨å·²ç»å¯ä»¥é€šè¿‡åå°„è·å–å¹¶ä¿®æ”¹æ¥å£å¯¹è±¡çš„å­—æ®µï¼Œç±»å‹ç­‰ä¿¡æ¯äº†ï¼Œé‚£æ€ä¹ˆé€šè¿‡åå°„â€œåŠ¨æ€â€è°ƒç”¨æ¥å£å¯¹è±¡ç­‰æ–¹æ³•ï¼Ÿ<br>å…ˆä¸º<code>User</code>ç»“æ„ä½“å¼•å…¥ä¸€ä¸ª<code>Hello</code>æ–¹æ³•ï¼š</p>
<pre><code>func (u User) Hello(m User) (int, string) {
    fmt.Println(&quot;Hello&quot;, m.Name, &quot;, I&apos;m &quot;, u.Name)
    return m.Age + u.Age, u.Name
}
</code></pre><p>ä¸‹é¢é€šè¿‡åå°„æ¥è°ƒç”¨<code>Hello</code>è¿™ä¸ªæ–¹æ³•ï¼š</p>
<pre><code>func GetInfo(u interface{}) {
    m := User{2, &quot;Json&quot;, 12}

    v := reflect.ValueOf(u)

    if v.Kind() != reflect.Struct {
        fmt.Println(&quot;type invalid&quot;)
        return
    }

    mv := v.MethodByName(&quot;Hello&quot;) //è·å–å¯¹åº”çš„æ–¹æ³•
    if !mv.IsValid() {            //åˆ¤æ–­æ–¹æ³•æ˜¯å¦å­˜åœ¨
        fmt.Println(&quot;Func Hello not exist&quot;)
        return
    }

    args := []reflect.Value{reflect.ValueOf(m)} //åˆå§‹åŒ–ä¼ å…¥ç­‰å‚æ•°ï¼Œä¼ å…¥ç­‰ç±»å‹åªèƒ½æ˜¯[]reflect.Valueç±»å‹
    res := mv.Call(args)
    fmt.Println(res[0], res[1])

}
</code></pre><p>é€šè¿‡<code>MethodByName</code>å…ˆè·å–å¯¹è±¡çš„<code>Hello</code>æ–¹æ³•,ç„¶åå‡†å¤‡è¦ä¼ å…¥çš„å‚æ•°,è¿™é‡Œä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯<code>[]refelct.Value</code>ç±»å‹,ä¼ å…¥çš„å‚æ•°å€¼å¿…é¡»å¼ºåˆ¶è½¬æ¢ä¸ºåå°„å€¼ç±»å‹<code>refelct.Value</code>ã€‚<br>æœ€åé€šè¿‡è°ƒç”¨<code>Call</code>æ–¹æ³•å°±å¯ä»¥å®ç°é€šè¿‡åå°„â€åŠ¨æ€â€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ã€‚<br><a href="https://github.com/researchlab/golearning/blob/master/reflect/03reflect.go" target="_blank" rel="external">ç¤ºä¾‹ä»£ç </a></p>
<h2 id="u5C0F_u7ED3"><a href="#u5C0F_u7ED3" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul>
<li>é€šè¿‡åå°„åŒ…æä¾›<code>refelct.TypeOf</code>å’Œ<code>refelct.ValueOf</code>æ–¹æ³•è·å¾—æ¥å£å¯¹è±¡çš„ç±»å‹ï¼Œå€¼å’Œæ–¹æ³•ç­‰ã€‚</li>
<li>é€šè¿‡åå°„ä¿®æ”¹å­—æ®µå€¼ç­‰æ—¶å€™éœ€è¦ä¼ å…¥åœ°å€ç±»å‹ï¼Œå¹¶ä¸”éœ€è¦æ£€æŸ¥åå°„è¿”å›å€¼ç±»å‹æ˜¯å¦ä¸º<code>refelct.Ptr</code>ï¼Œæ£€æŸ¥å­—æ®µæ˜¯å¦<code>CanSet</code>,æ£€æŸ¥å­—æ®µæ˜¯å­˜åœ¨,ç„¶åé€šè¿‡<code>Kind()</code>æ¥å¸®åŠ©èµ‹å€¼ç›¸åº”å¯¹ç±»å‹å€¼ã€‚</li>
<li>æœ€åæ€»ç»“äº†é€šè¿‡<code>MethodByName</code>ç­‰æ–¹æ³•å¦‚ä½•â€œåŠ¨æ€â€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œç¤ºä¾‹ä»£ç ä¹Ÿæ¼”ç¤ºäº†å¦‚ä½•ä¼ å…¥å’Œæ¥æ”¶å¤šä¸ªå‚æ•°å€¼ã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åå°„æ˜¯ä¸€ç§æ£€æŸ¥å­˜å‚¨åœ¨æ¥å£å˜é‡ä¸­çš„&lt;code&gt;&amp;lt;å€¼,ç±»å‹&amp;gt;&lt;/code&gt;å¯¹çš„æœºåˆ¶ï¼Œå€ŸåŠ©goåå°„åŒ…æä¾›çš„&lt;code&gt;reflect.TypeOf&lt;/code&gt;å’Œ&lt;code&gt;reflect.ValueOf&lt;/code&gt;å¯ä»¥æ–¹ä¾¿çš„è®¿é—®åˆ°ä¸€ä¸ªæ¥å£å€¼çš„&lt;code&gt;reflect.Type&lt;/code&gt;å’Œ&lt;code&gt;reflect.Value&lt;/code&gt;éƒ¨åˆ†ï¼Œä»è€Œå¯è¿›ä¸€æ­¥å¾—åˆ°è¿™ä¸ªæ¥å£çš„ç»“æ„ç±»å‹å’Œå¯¹å…¶è¿›è¡Œå€¼çš„ä¿®æ”¹æ“ä½œã€‚&lt;br&gt;
    
    </summary>
    
      <category term="golang" scheme="http://www.grdtechs.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
      <category term="reflect" scheme="http://www.grdtechs.com/tags/reflect/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘]GO BOOTCAMP ç¬¬ä¸ƒç« ï¼šæ¥å£</title>
    <link href="http://www.grdtechs.com/2016/01/25/go-interfaces/"/>
    <id>http://www.grdtechs.com/2016/01/25/go-interfaces/</id>
    <published>2016-01-25T15:12:56.000Z</published>
    <updated>2016-11-23T06:28:51.134Z</updated>
    
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¥å£è¢«å®šä¹‰ä¸ºä¸€ç»„æ–¹æ³•çš„é›†åˆ, æ¥å£å¯ä»¥æ¥æ”¶ä»»ä½•å…¶å®ç°çš„æ–¹æ³•çš„å€¼.<br><a id="more"></a><br>ä¸‹é¢åˆ©ç”¨æ¥å£çš„ç‰¹æ€§ï¼Œé‡æ„äº†ä¹‹å‰çš„ä¸€ä¸ªæ¡ˆä¾‹,è¿™æ¬¡é€šè¿‡ç»™<code>Greet</code>æ–¹æ³•æä¾›ä¸€ä¸ªæ¥å£ç±»å‹å‚æ•°<code>Namer</code>ï¼Œä½¿å¾—<code>Greet</code>æ–¹æ³•æ›´é€šç”¨. <code>Namer</code>æ˜¯å®šä¹‰çš„æ–°æ¥å£ï¼ŒåªåŒ…å«ä¸€ä¸ªæ–¹æ³•<code>Name()</code>,æ‰€ä»¥<code>Greet()</code>å¯ä»¥æ¥æ”¶ä»»æ„æœ‰<code>Name()</code>æ–¹æ³•å®šä¹‰çš„å€¼.</p>
<p>ä¸º<code>User</code>ç»“æ„ä½“å®ç°è¿™ä¸ªæ¥å£ï¼Œå®šä¹‰äº†ä¸€ä¸ª<code>Name()</code>æ–¹æ³•ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªæ‰§è¡Œ<code>User</code>çš„æŒ‡é’ˆç»™<code>Greet</code>æ–¹æ³•æ¥è°ƒç”¨<code>Greet</code>.<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	FirstName, LastName <span class="typename">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (u *User) Name() <span class="typename">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"%s %s"</span>, u.FirstName, u.LastName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Namer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Name() <span class="typename">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Greet(n Namer) <span class="typename">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"Dear %s"</span>, n.Name())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	u := &amp;User&#123;<span class="string">"Matt"</span>, <span class="string">"Aimonetti"</span>&#125;</span><br><span class="line">	fmt.Println(Greet(u))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–°çš„ç±»å‹å®ç°ç›¸åŒçš„æ¥å£ï¼Œ<code>Greet</code>å‡½æ•°åŒæ ·å¯ä»¥ä½¿ç”¨<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	FirstName, LastName <span class="typename">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (u *User) Name() <span class="typename">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"%s %s"</span>, u.FirstName, u.LastName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Customer <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id       <span class="typename">int</span></span><br><span class="line">	FullName <span class="typename">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (c *Customer) Name() <span class="typename">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> c.FullName</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Namer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Name() <span class="typename">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Greet(n Namer) <span class="typename">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"Dear %s"</span>, n.Name())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	u := &amp;User&#123;<span class="string">"Matt"</span>, <span class="string">"Aimonetti"</span>&#125;</span><br><span class="line">	fmt.Println(Greet(u))</span><br><span class="line">	c := &amp;Customer&#123;<span class="number">42</span>, <span class="string">"Francesc"</span>&#125;</span><br><span class="line">	fmt.Println(Greet(c))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="u63A5_u53E3_u6EE1_u8DB3_u9690_u5F0F_u5B9E_u73B0"><a href="#u63A5_u53E3_u6EE1_u8DB3_u9690_u5F0F_u5B9E_u73B0" class="headerlink" title="æ¥å£æ»¡è¶³éšå¼å®ç°"></a>æ¥å£æ»¡è¶³éšå¼å®ç°</h2><p>ä¸€ä¸ªç±»å‹å¯ä»¥é€šè¿‡å®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•æ¥å®ç°æ¥å£.</p>
<p>ä¸éœ€è¦æ˜¾ç¤ºçš„å–å£°æ˜æˆ–è€…å®ç°æŸä¸ªæ¥å£.</p>
<p>éšå¼æ¥å£è§£å¶å®ç°å®šä¹‰æ¥å£çš„åŒ…ï¼Œä¸éœ€è¦é¢å¤–çš„ä¾èµ–.</p>
<p>æ¨èåˆç†å®šä¹‰æ¥å£ï¼Œå°±ä¸éœ€è¦é¢å¤–æ ‡è®°å®šä¹‰çš„æ–°æ¥å£.<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Reader <span class="keyword">interface</span> &#123;</span><br><span class="line">	Read(b []<span class="typename">byte</span>) (n <span class="typename">int</span>, err error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Write(b []<span class="typename">byte</span>) (n <span class="typename">int</span>, err error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReadWriter <span class="keyword">interface</span> &#123;</span><br><span class="line">	Reader</span><br><span class="line">	Writer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	<span class="keyword">var</span> w Writer</span><br><span class="line"></span><br><span class="line">	<span class="comment">// os.Stdout implements Writer</span></span><br><span class="line">	w = os.Stdout</span><br><span class="line"></span><br><span class="line">	fmt.Fprintf(w, <span class="string">"hello, writer\n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="u9519_u8BEF"><a href="#u9519_u8BEF" class="headerlink" title="é”™è¯¯"></a>é”™è¯¯</h2><p>é”™è¯¯å¯ä»¥è¢«æè¿°ä»»æ„çš„é”™è¯¯å­—ç¬¦ä¸². å¯ä»¥æ•è·å‰ç½®å®šä¹‰ï¼Œå†…ç½®æ¥å£ç±»å‹ï¼Œé”™è¯¯ç­‰ï¼Œ é”™è¯¯è¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error() <span class="typename">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥ä½¿ç”¨<code>fmt</code>åŒ…æ¥æ‰“å°é”™è¯¯ä¿¡æ¯<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyError <span class="keyword">struct</span> &#123;</span><br><span class="line">    When time.Time</span><br><span class="line">    What <span class="typename">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (e *MyError) Error() <span class="typename">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"at %v, %s"</span>,</span><br><span class="line">        e.When, e.What)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> run() error &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;MyError&#123;</span><br><span class="line">        time.Now(),</span><br><span class="line">        <span class="string">"it didn't work"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">    <span class="keyword">if</span> err := run(); err != <span class="constant">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong> ç»ƒä¹ é¢˜ </strong><br>è‡ªå®šä¹‰ä¸€ä¸ª<code>Sqrt</code>å‡½æ•°ï¼Œè®©èµ·è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<br>åˆ›å»ºä¸€ä¸ªæ–°ç±»å‹<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ErrNegativeSqrt <span class="typename">float64</span></span><br></pre></td></tr></table></figure></p>
<p>å®šä¹‰ä¸€ä¸ªError()<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> (e ErrNegativeSqrt) Error() <span class="typename">string</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœç›´æ¥æ‰“å°é”™è¯¯<code>fmt.Print(e)</code> å¯èƒ½ä½¿å¾—ç¨‹åºé™·å…¥æ— é™å¾ªç¯ï¼Œå¯ä»¥é€šè¿‡<code>fmt.Print(float64(e))</code> æ¥é¿å…è¿™ç§æƒ…å†µ.</p>
<p><strong> è§£å†³æ–¹æ¡ˆ </strong><br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ErrNegativeSqrt <span class="typename">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> (e ErrNegativeSqrt) Error() <span class="typename">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">"cannot Sqrt negative number: %g"</span>, <span class="typename">float64</span>(e))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> Sqrt(x <span class="typename">float64</span>) (<span class="typename">float64</span>, error) &#123;</span><br><span class="line">	<span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, ErrNegativeSqrt(x)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	z := <span class="number">1.0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		z = z - ((z*z)-x)/(<span class="number">2</span>*z)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> z, <span class="constant">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	fmt.Println(Sqrt(<span class="number">2</span>))</span><br><span class="line">	fmt.Println(Sqrt(-<span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong> Tip: </strong><br>å½“å£°æ˜ä¸€ä¸ªæµ®ç‚¹æ•°å£°æ˜æ—¶ï¼Œå¯ä»¥çœç•¥å°æ•°ç‚¹åé¢çš„å€¼, å¦‚ä¸‹é¢é‚£æ ·, ä½†æ˜¯ï¼Œä¸æ¨è!<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">z := <span class="number">1.</span></span><br><span class="line"><span class="comment">// same as</span></span><br><span class="line"><span class="comment">// z := 1.0</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u524D_u8A00&quot;&gt;&lt;a href=&quot;#u524D_u8A00&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æ¥å£è¢«å®šä¹‰ä¸ºä¸€ç»„æ–¹æ³•çš„é›†åˆ, æ¥å£å¯ä»¥æ¥æ”¶ä»»ä½•å…¶å®ç°çš„æ–¹æ³•çš„å€¼.&lt;br&gt;
    
    </summary>
    
      <category term="go-bootcamp" scheme="http://www.grdtechs.com/categories/go-bootcamp/"/>
    
    
      <category term="golang" scheme="http://www.grdtechs.com/tags/golang/"/>
    
  </entry>
  
</feed>
